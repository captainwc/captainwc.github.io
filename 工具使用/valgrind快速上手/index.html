<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Valgrindå¿«é€Ÿä¸Šæ‰‹ | SHUAIKAI&#39;s Blog</title>
    <link rel="icon" href= /images/favicon.png />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />

    <link rel="stylesheet" href="/css/custom.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">ä¸»é¡µ</a></li>
      
      <li><a href="/series/">ä¸“æ </a></li>
      
      <li><a href="/categories/">åˆ†ç±»</a></li>
      
      <li><a href="/tags/">æ ‡ç­¾</a></li>
      
      <li><a href="/archives/">å½’æ¡£</a></li>
      
      <li><a href="/search/">æœç´¢</a></li>
      
      <li><a href="/about/">å…³äº</a></li>
      
    </ul>
    <hr/>
    </nav>


<div class="article-meta">
    <h1><span class="article-meta-title">Valgrindå¿«é€Ÿä¸Šæ‰‹</span></h1>

    <div class="article-meta-info">
        

        
        

        
        
        
        

        
        
        
        
        
        
        
        
        

        
        
        
        
        
        
        
        
        

        
        
        
        
        
        
        
        
        

        ğŸ—“ï¸ 2025-04-08 ğŸ–ï¸ <a href="/series/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/">å¿«é€Ÿä¸Šæ‰‹</a> ğŸ—‚ï¸ <a href="/categories/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/">å·¥å…·ä½¿ç”¨</a> ğŸ·ï¸ <a href="/tags/valgrind/">#valgrind</a>
    </div>
</div>

<main>

    

<div class="left-sidebar-btn" id="leftSidebarBtn"><i class="fa-solid fa-list"></i></div>
<div class="left-sidebar-panel" id="leftSidebarPanel">
    
        <div class="sidebar-content">
            
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">ğŸ·ï¸ æ ‡ç­¾</div>
                <div class="tag-blocks">
                    
                    <a href="/tags/valgrind" class="tag-block">
                        valgrind
                    </a>
                    
                </div>
            </div>
            

            
            
            
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">ğŸ–ï¸ ç³»åˆ—æ–‡ç« </div>
                
                
                <div class="series-group">
                    <div class="series-name">å¿«é€Ÿä¸Šæ‰‹</div>
                    <ul class="article-list">
                        
                        
                        <li class="article-item">
                            <a href="/cpp/libclang-py%E4%BD%BF%E7%94%A8/" class="article-link">
                                
                                <span class="article-title">libclang-pyä½¿ç”¨ä»‹ç»</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/tmux%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-link">
                                
                                <span class="article-title">tmux å¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/mermaid%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-link">
                                
                                <span class="article-title">Mermaidå¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%94%A8%E6%B3%95/" class="article-link">
                                
                                <span class="article-title">linuxå‘½ä»¤è¡Œå¤§è®°å¿†æ¢å¤æœ¯</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/plantuml%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-link">
                                
                                <span class="article-title">PlantUMLå¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E7%AC%94%E8%AE%B0/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/" class="article-link">
                                
                                <span class="article-title">C++ç½‘ç»œç¼–ç¨‹å…¥é—¨æ¦‚å¿µåŠapiæ€»ç»“</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/gdb%E6%95%99%E7%A8%8B/" class="article-link">
                                
                                <span class="article-title">gdbå¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                    </ul>
                </div>
                
            </div>
            

            
            
            
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">ğŸ—‚ï¸ åˆ†ç±»æ–‡ç« </div>
                
                
                <div class="category-group">
                    <div class="category-name">å·¥å…·ä½¿ç”¨</div>
                    <ul class="article-list">
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/ssh%E5%8F%8D%E5%90%91%E9%9A%A7%E9%81%93%E4%B8%AD%E8%BD%AC%E6%9C%BA%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="article-link">
                                
                                <span class="article-title">SSHåå‘éš§é“ä¸­è½¬æœº-è¿œç¨‹è¿æ¥æœ¬åœ°æœåŠ¡å™¨</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/tmux%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-link">
                                
                                <span class="article-title">tmux å¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/mermaid%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-link">
                                
                                <span class="article-title">Mermaidå¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%94%A8%E6%B3%95/" class="article-link">
                                
                                <span class="article-title">linuxå‘½ä»¤è¡Œå¤§è®°å¿†æ¢å¤æœ¯</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/plantuml%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/" class="article-link">
                                
                                <span class="article-title">PlantUMLå¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/gdb%E6%95%99%E7%A8%8B/" class="article-link">
                                
                                <span class="article-title">gdbå¿«é€Ÿä¸Šæ‰‹</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/word%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E9%85%8D%E7%BD%AE/" class="article-link">
                                
                                <span class="article-title">word é¡µçœ‰é¡µè„šè®¾ç½®</span>
                            </a>
                        </li>
                        
                        
                    </ul>
                </div>
                
            </div>
            
        </div>
    </div>

    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('leftSidebarBtn');
            const panel = document.getElementById('leftSidebarPanel');
            let hoverTimeout;

            
            btn.addEventListener('mouseenter', () => {
                clearTimeout(hoverTimeout);
                panel.classList.add('show');
            });

            panel.addEventListener('mouseenter', () => clearTimeout(hoverTimeout));

            [btn, panel].forEach(el => {
                el.addEventListener('mouseleave', () => {
                    hoverTimeout = setTimeout(() => {
                        panel.classList.remove('show');
                    }, 200);
                });
            });
        });
    </script>
    

    <style>
        

         
        .left-sidebar-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 980;
            cursor: pointer;
            padding: 6px 10px;
            background: #EFEFEF;
            border-radius: 8px;
            transition: background 0.3s;
            color: #999;
            opacity: 0.7;
        }

        .left-sidebar-btn:hover {
            background: #BEC2B3;
        }

        .left-sidebar-panel {
            border-radius: 8px;
            display: none;
            position: fixed;
            top: 66px;
            left: 20px;
            max-width: 360px;
            min-width: 280px;
            max-height: 80vh;
            overflow-y: auto;
            background: white;
            border: 1px solid #eee;
            padding: 10px 5px 10px 15px;
            z-index: 970;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .left-sidebar-panel.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        

        .sidebar-content {
            padding: 15px 12px;
        }

        .sidebar-section {
            margin-bottom: 1.2rem;
        }

        .sidebar-section-title {
            font-size: 1rem;
            color: #2d3842;
            margin: 0 0 0.6rem 0;
            padding-bottom: 0.3rem;
            font-family: "LXGW WenKai";
            font-weight: bold;

             
            
            border-bottom: 2px dashed #cfcfcf;
            
        }

         
        .tag-blocks {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .tag-block {
            display: inline-block;
            background: #F6F6F6;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .tag-block:hover {
            background: #2e59a7;
            color: white;
            transform: translateY(-1px);
        }

         
        .series-group,
        .category-group {
            margin-bottom: 0.8rem;
        }

        .series-name,
        .category-name {
            font-size: 0.9rem;
            color: #666;
            margin: 0 0 0.4rem 0;
            font-weight: bold;
            font-family: "LXGW WenKai";
        }

         
        .article-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .article-item {
            margin-bottom: 0.3rem;
        }

        .article-link {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.4rem;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .article-link:hover {
            background: #f8f9fa;
            border-left-color: #2e59a7;
            transform: translateX(3px);
        }

        .article-date {
            font-size: 0.8rem;
            color: #999;
            font-family: "LXGW WenKai";
            flex-shrink: 0;
            width: 45px;
            text-align: left;
        }

        .article-title {
            flex: 1;
            font-size: 0.9rem;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

         
        

        .left-sidebar-panel::-webkit-scrollbar {
            display: none;
        }

        .left-sidebar-panel {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        

         
        @media (max-width: 768px) {
        
        }
    </style>

    


<div class="toc-btn" id="tocBtn"><i class="fa-solid fa-bars-staggered"></i></div>
<div class="toc-panel" id="tocPanel"></div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        
        const btn = document.getElementById('tocBtn');
        const panel = document.getElementById('tocPanel');
        let hoverTimeout;

        
        btn.addEventListener('mouseenter', () => {
            clearTimeout(hoverTimeout);
            generateToc(panel);
            panel.classList.add('show');

            
            requestAnimationFrame(() => {
                const headers = Array.from(document.querySelectorAll('h2, h3, h4, h5, h6'));
                let activeHeader = null;
                let minDistance = Infinity;

                
                headers.forEach(header => {
                    const rect = header.getBoundingClientRect();
                    const distance = Math.abs(rect.top);
                    if (distance < minDistance) {
                        minDistance = distance;
                        activeHeader = header;
                    }
                });

                
                if (activeHeader) {
                    const activeLink = panel.querySelector(`a[href="#${activeHeader.id}"]`);
                    if (activeLink) {
                        
                        const panelHeight = panel.offsetHeight;
                        const linkOffset = activeLink.offsetTop;
                        const centerPosition = linkOffset - (panelHeight / 2) + (activeLink.offsetHeight / 2);
                        
                        panel.scrollTo({
                            top: centerPosition,
                            behavior: 'auto'
                        });
                    }
                }
            });
        });

        panel.addEventListener('mouseenter', () => clearTimeout(hoverTimeout));

        [btn, panel].forEach(el => {
            el.addEventListener('mouseleave', () => {
                hoverTimeout = setTimeout(() => {
                    panel.classList.remove('show');
                }, 200);
            });
        });
        

        
        function generateToc(container) {
            if (container.children.length > 0) return;

            const headers = Array.from(document.querySelectorAll('h2, h3, h4, h5, h6'));
            const counts = [0, 0, 0, 0, 0]; 

            headers.forEach(header => {
                const level = parseInt(header.tagName[1]) - 2;
                if (level < 0) return;

                counts[level]++;
                for (let i = level + 1; i < counts.length; i++) counts[i] = 0;
                const number = counts.slice(0, level + 1).join('.');

                
                const numberSpan = document.createElement('span');
                numberSpan.className = 'toc-number';
                numberSpan.textContent = number;

                
                const link = document.createElement('a');
                link.href = `#${header.id}`;
                link.style.paddingLeft = `${level * 12}px`;

                
                link.appendChild(numberSpan);
                link.appendChild(document.createTextNode(header.textContent));

                container.appendChild(link);
            });
        }
    });
</script>

<style>
    

     
    .toc-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 980;
        cursor: pointer;
        padding: 6px 10px;
        background: #EFEFEF;
        border-radius: 8px;
        transition: background 0.3s;
        color: #999;
        opacity: 0.7;
    }

    .toc-btn:hover {
        background: #BEC2B3;
    }

    .toc-panel {
        border-radius: 8px;
        display: none;
        position: fixed;
        top: 66px;
        right: 20px;
        max-width: 360px;
        min-width: 200px;
        max-height: 80vh;
        overflow-y: auto;
        background: white;
        border: 1px solid #eee;
        padding: 10px 5px 10px 15px;
        z-index: 970;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        list-style: none;
    }

    .toc-panel.show {
        display: block;
        animation: fadeIn 0.3s ease-out;
    }

     
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateX(10px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    

     
    .toc-number {
        vertical-align: middle;
        margin-right: 6px;
        font-family: "LXGW WenKai";
        font-size: 0.85rem;
    }

     
        

    .toc-panel a {
        
            display: block;
            padding: 4px 0;
            text-decoration: none;
            color: #333;
            white-space: nowrap;
        }

        

        .toc-panel a:hover {
        

                color: #007bff;
            }

        
</style>


    
    
    
        <h1 id="valgrind-ä½¿ç”¨è¯¦è§£">Valgrind ä½¿ç”¨è¯¦è§£</h1>

          <link rel="stylesheet" href="/css/vendors/admonitions.e8f9d71468684b38dcc32a3631441f47b6ee45ce52f3bcc31201e76cc2b0a193.css" integrity="sha256-6PnXFGhoSzjcwyo2MUQfR7buRc5S87zDEgHnbMKwoZM=" crossorigin="anonymous">
  <div class="admonition idea">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/></svg>
      <span>è½¬è½½è‡ª</span>
    </div>
      <div class="admonition-content">
        <p><a href="https://blog.csdn.net/qq_14821541/article/details/71533788"  target="_blank" rel="noopener noreferrer" >Valgrind ä½¿ç”¨è¯¦è§£-CSDNåšå®¢</a>
</p>
      </div>
  </div>

  <div class="admonition note">
    <div class="admonition-header">
      <svg t="1742459666649" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6550" width="200" height="200"><path d="M575.99996 576.00028l319.9998-319.9998-127.99992-127.99992L448.00004 448.00036 575.99996 576.00028zM959.99972 192.00052l63.99996 0c0-193.983879-191.99988-191.99988-191.99988-191.99988l0 63.99996 63.99996 63.99996L959.99972 192.00052zM895.99976 832.00012c0 35.327978-28.671982 63.99996-63.99996 63.99996L192.0002 896.00008c-35.327978 0-63.99996-28.671982-63.99996-63.99996L128.00024 192.00052c0-35.327978 28.671982-63.99996 63.99996-63.99996l383.99976 0 127.99992-127.99992L128.00024 0.00064C57.280284 0.00064 0.00032 57.280604 0.00032 128.00056l0 767.99952c0 70.719956 57.279964 127.99992 127.99992 127.99992l767.99952 0c70.719956 0 127.99992-57.279964 127.99992-127.99992L1023.99968 320.00044l-127.99992 127.99992L895.99976 832.00012zM320.00012 512.00032l0 191.99988 191.99988 0 0-63.99996L384.00008 512.00032 320.00012 512.00032z" p-id="6551"></path></svg>

      <span>Note</span>
    </div>
      <div class="admonition-content">
        <p>åŸåšæ–‡çš„æ’ç‰ˆæ¯”è¾ƒæ··ä¹±ï¼Œæ‰¾ä¸ç€çœŸæ­£çš„åŸå‡ºå¤„äº†ï¼Œæ‰€ä»¥æ‹·è¿‡æ¥å¯¹å…¶è¿›è¡Œäº†æ ‡é¢˜çš„ä¿®æ”¹ï¼Œåç»­å¯èƒ½ä¼šå¯¹é½è¿›è¡Œæ¸è¿›ä¿®æ”¹ã€‚åšæ–‡å¾ˆè¯¦ç»†ï¼Œç»™äº†å¾ˆå¤šé€‰é¡¹ï¼Œè¿™é‡Œçš„å»ºè®®æ˜¯ï¼š</p>
<ul>
<li>åŸºæœ¬ç”¨æ³• <code>valgrind -tool=xxx ./&lt;excutable&gt;</code>ã€‚toolæœ‰<code>memcheck, cachegrind, helgrind, callgrind, massif, lackey ...</code>(ç›´æ¥è¡¥å…¨å³å¯æŸ¥çœ‹)</li>
<li>ç„¶åå…·ä½“çš„å“ªä¸ªå·¥å…·æ€ä¹ˆç”¨ï¼Œç›´æ¥æœæˆ–è€…é—®aiå³å¯ã€‚</li>
</ul>
      </div>
  </div>
<h2 id="valgrindåŒ…å«çš„å·¥å…·">ValgrindåŒ…å«çš„å·¥å…·</h2>
<p>Valgrindæ”¯æŒå¾ˆå¤šå·¥å…·:memcheckï¼Œaddrcheckï¼Œcachegrindï¼ŒMassifï¼Œhelgrindå’ŒCallgrindç­‰ã€‚åœ¨è¿è¡ŒValgrindæ—¶ï¼Œä½ å¿…é¡»æŒ‡æ˜æƒ³ç”¨çš„å·¥å…·,å¦‚æœçœç•¥å·¥å…·åï¼Œé»˜è®¤è¿è¡Œmemcheckã€‚</p>
<h3 id="memcheck">memcheck</h3>
<p>memcheckæ¢æµ‹ç¨‹åºä¸­å†…å­˜ç®¡ç†å­˜åœ¨çš„é—®é¢˜ã€‚å®ƒæ£€æŸ¥æ‰€æœ‰å¯¹å†…å­˜çš„è¯»/å†™æ“ä½œï¼Œå¹¶æˆªå–æ‰€æœ‰çš„malloc/new/free/deleteè°ƒç”¨ã€‚å› æ­¤memcheckå·¥å…·èƒ½å¤Ÿæ¢æµ‹åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<p>1ï¼‰ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜</p>
<p>2ï¼‰è¯»/å†™å·²ç»è¢«é‡Šæ”¾çš„å†…å­˜</p>
<p>3ï¼‰è¯»/å†™å†…å­˜è¶Šç•Œ</p>
<p>4ï¼‰è¯»/å†™ä¸æ°å½“çš„å†…å­˜æ ˆç©ºé—´</p>
<p>5ï¼‰å†…å­˜æ³„æ¼</p>
<p>6ï¼‰ä½¿ç”¨malloc/new/new[]å’Œfree/delete/delete[]ä¸åŒ¹é…ã€‚</p>
<p>7ï¼‰srcå’Œdstçš„é‡å </p>
<h3 id="cachegrind">cachegrind</h3>
<p>cachegrindæ˜¯ä¸€ä¸ªcacheå‰–æå™¨ã€‚å®ƒæ¨¡æ‹Ÿæ‰§è¡ŒCPUä¸­çš„L1, D1å’ŒL2 cacheï¼Œå› æ­¤å®ƒèƒ½å¾ˆç²¾ç¡®çš„æŒ‡å‡ºä»£ç ä¸­çš„cacheæœªå‘½ä¸­ã€‚å¦‚æœä½ éœ€è¦ï¼Œå®ƒå¯ä»¥æ‰“å°å‡ºcacheæœªå‘½ä¸­çš„æ¬¡æ•°ï¼Œå†…å­˜å¼•ç”¨å’Œå‘ç”Ÿcacheæœªå‘½ä¸­çš„æ¯ä¸€è¡Œä»£ç ï¼Œæ¯ä¸€ä¸ªå‡½æ•°ï¼Œæ¯ä¸€ä¸ªæ¨¡å—å’Œæ•´ä¸ªç¨‹åºçš„æ‘˜è¦ã€‚å¦‚æœä½ è¦æ±‚æ›´ç»†è‡´çš„ä¿¡æ¯ï¼Œå®ƒå¯ä»¥æ‰“å°å‡ºæ¯ä¸€è¡Œæœºå™¨ç çš„æœªå‘½ä¸­æ¬¡æ•°ã€‚åœ¨x86å’Œamd64ä¸Šï¼Œ cachegrindé€šè¿‡CPUIDè‡ªåŠ¨æ¢æµ‹æœºå™¨çš„cacheé…ç½®ï¼Œæ‰€ä»¥åœ¨å¤šæ•°æƒ…å†µä¸‹å®ƒä¸å†éœ€è¦æ›´å¤šçš„é…ç½®ä¿¡æ¯äº†ã€‚</p>
<h3 id="helgrind">helgrind</h3>
<p>helgrindæŸ¥æ‰¾å¤šçº¿ç¨‹ç¨‹åºä¸­çš„ç«äº‰æ•°æ®ã€‚helgrindæŸ¥æ‰¾å†…å­˜åœ°å€ï¼Œé‚£äº›è¢«å¤šäºä¸€æ¡çº¿ç¨‹è®¿é—®çš„å†…å­˜åœ°å€ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨ä¸€è‡´çš„é”å°±ä¼šè¢«æŸ¥å‡ºã€‚è¿™è¡¨ç¤ºè¿™äº›åœ°å€åœ¨å¤šçº¿ç¨‹é—´è®¿é—®çš„æ—¶å€™æ²¡æœ‰è¿›è¡ŒåŒæ­¥ï¼Œå¾ˆå¯èƒ½ä¼šå¼•èµ·å¾ˆéš¾æŸ¥æ‰¾çš„æ—¶åºé—®é¢˜ã€‚</p>
<p>å®ƒä¸»è¦ç”¨æ¥æ£€æŸ¥å¤šçº¿ç¨‹ç¨‹åºä¸­å‡ºç°çš„ç«äº‰é—®é¢˜ã€‚Helgrind å¯»æ‰¾å†…å­˜ä¸­è¢«å¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œè€Œåˆæ²¡æœ‰ä¸€è´¯åŠ é”çš„åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸå¾€å¾€æ˜¯çº¿ç¨‹ä¹‹é—´å¤±å»åŒæ­¥çš„åœ°æ–¹ï¼Œè€Œä¸”ä¼šå¯¼è‡´éš¾ä»¥å‘æ˜çš„é”™è¯¯ã€‚Helgrindå®ç°äº†åä¸ºâ€Eraserâ€ çš„ç«äº‰æ£€æµ‹ç®—æ³•ï¼Œå¹¶åšäº†è¿›ä¸€æ­¥æ”¹è¿›ï¼Œå‡å°‘äº†æŠ¥å‘Šé”™è¯¯çš„æ¬¡æ•°ã€‚</p>
<h3 id="callgrind">Callgrind</h3>
<p>Callgrindæ”¶é›†ç¨‹åºè¿è¡Œæ—¶çš„ä¸€äº›æ•°æ®ï¼Œå‡½æ•°è°ƒç”¨å…³ç³»ç­‰ä¿¡æ¯ï¼Œè¿˜å¯ä»¥æœ‰é€‰æ‹©åœ°è¿›è¡Œcache æ¨¡æ‹Ÿã€‚åœ¨è¿è¡Œç»“æŸæ—¶ï¼Œå®ƒä¼šæŠŠåˆ†ææ•°æ®å†™å…¥ä¸€ä¸ªæ–‡ä»¶ã€‚callgrind_annotateå¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹è½¬åŒ–æˆå¯è¯»çš„å½¢å¼ã€‚</p>
<p>ä¸€èˆ¬ç”¨æ³•:</p>
<p><code>valgrind --tool=callgrind ./sec_infod</code></p>
<p>ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆcallgrind.out.[pid], å¦‚æœæˆ‘ä»¬æƒ³ç»“æŸç¨‹åº, å¯ä»¥</p>
<p><code>killall callgrind</code></p>
<p>ç„¶åæˆ‘ä»¬å¯ä»¥ç”¨</p>
<p><code>callgrind_annotate --auto=yes callgrind.out.[pid] &gt; log</code></p>
<p><code>vim log</code></p>
<h3 id="massif">Massif</h3>
<p>å †æ ˆåˆ†æå™¨ï¼Œå®ƒèƒ½æµ‹é‡ç¨‹åºåœ¨å †æ ˆä¸­ä½¿ç”¨äº†å¤šå°‘å†…å­˜ï¼Œå‘Šè¯‰æˆ‘ä»¬å †å—ï¼Œå †ç®¡ç†å—å’Œæ ˆçš„å¤§å°ã€‚Massifèƒ½å¸®åŠ©æˆ‘ä»¬å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œåœ¨å¸¦æœ‰è™šæ‹Ÿå†…å­˜çš„ç°ä»£ç³»ç»Ÿä¸­ï¼Œå®ƒè¿˜èƒ½å¤ŸåŠ é€Ÿæˆ‘ä»¬ç¨‹åºçš„è¿è¡Œï¼Œå‡å°‘ç¨‹åºåœç•™åœ¨äº¤æ¢åŒºä¸­çš„å‡ ç‡ã€‚</p>
<h3 id="lackey">lackey</h3>
<p>lackeyæ˜¯ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œä»¥å…¶ä¸ºæ¨¡ç‰ˆå¯ä»¥åˆ›å»ºä½ è‡ªå·±çš„å·¥å…·ã€‚åœ¨ç¨‹åºç»“æŸåï¼Œå®ƒæ‰“å°å‡ºä¸€äº›åŸºæœ¬çš„å…³äºç¨‹åºæ‰§è¡Œç»Ÿè®¡æ•°æ®ã€‚</p>
<h2 id="valgrindçš„å‚æ•°">Valgrindçš„å‚æ•°</h2>
<p>ç”¨æ³•: <code>valgrind [options] prog-and-args [options]</code>: å¸¸ç”¨é€‰é¡¹ï¼Œé€‚ç”¨äºæ‰€æœ‰Valgrindå·¥å…·</p>
<p>&ndash;tool=<name>ï¼šæœ€å¸¸ç”¨çš„é€‰é¡¹ã€‚è¿è¡Œ valgrindä¸­åä¸ºtoolnameçš„å·¥å…·ã€‚é»˜è®¤memcheckã€‚</p>
<p>-h &ndash;helpï¼šæ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹çš„å¸®åŠ©ï¼ŒåŒ…æ‹¬å†…æ ¸å’Œé€‰å®šçš„å·¥å…·ä¸¤è€…ã€‚</p>
<p>&ndash;versionï¼šæ˜¾ç¤ºvalgrindå†…æ ¸çš„ç‰ˆæœ¬ï¼Œæ¯ä¸ªå·¥å…·éƒ½æœ‰å„è‡ªçš„ç‰ˆæœ¬ã€‚</p>
<p>-q &ndash;quietï¼šå®‰é™åœ°è¿è¡Œï¼Œåªæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>&ndash;verboseï¼šæ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚</p>
<p>&ndash;trace-children=&lt;yes|no&gt;ï¼šè·Ÿè¸ªå­çº¿ç¨‹? [default: no]</p>
<p>&ndash;track-fds=&lt;yes|no&gt;ï¼šè·Ÿè¸ªæ‰“å¼€çš„æ–‡ä»¶æè¿°ï¼Ÿ[default: no]</p>
<p>&ndash;time-stamp=&lt;yes|no&gt;ï¼šå¢åŠ æ—¶é—´æˆ³åˆ°LOGä¿¡æ¯? [default: no]</p>
<p>&ndash;log-fd=<number>ï¼šè¾“å‡ºLOGåˆ°æè¿°ç¬¦æ–‡ä»¶ [2=stderr]</p>
<p>&ndash;log-file=<file>ï¼šå°†è¾“å‡ºçš„ä¿¡æ¯å†™å…¥åˆ°filename.PIDçš„æ–‡ä»¶é‡Œï¼ŒPIDæ˜¯è¿è¡Œç¨‹åºçš„è¿›è¡ŒID</p>
<p>&ndash;log-file-exactly=<file>: è¾“å‡ºLOGä¿¡æ¯åˆ° file</p>
<p>&ndash;xml=yesï¼šå°†ä¿¡æ¯ä»¥xmlæ ¼å¼è¾“å‡ºï¼Œåªæœ‰memcheckå¯ç”¨</p>
<p>&ndash;num-callers=<number>ï¼šshow <number> callers in stack traces [12]</p>
<p>&ndash;error-exitcode=<number>ï¼šå¦‚æœå‘ç°é”™è¯¯åˆ™è¿”å›é”™è¯¯ä»£ç  [0=disable]</p>
<p>&ndash;db-attach=&lt;yes|no&gt;ï¼š å½“å‡ºç°é”™è¯¯ï¼Œvalgrindä¼šè‡ªåŠ¨å¯åŠ¨è°ƒè¯•å™¨gdbã€‚[default: no]</p>
<p>&ndash;db-command=<command>ï¼šå¯åŠ¨è°ƒè¯•å™¨çš„å‘½ä»¤è¡Œé€‰é¡¹[gdb -nw %f %p]</p>
<p>&ndash;leak-check=&lt;no|summary|full&gt;ï¼šè¦æ±‚å¯¹leakç»™å‡ºè¯¦ç»†ä¿¡æ¯? Leakæ˜¯æŒ‡ï¼Œå­˜åœ¨ä¸€å—æ²¡æœ‰è¢«å¼•ç”¨çš„å†…å­˜ç©ºé—´ï¼Œæˆ–æ²¡æœ‰è¢«é‡Šæ”¾çš„å†…å­˜ç©ºé—´ï¼Œå¦‚summaryï¼Œåªåé¦ˆä¸€äº›æ€»ç»“ä¿¡æ¯ï¼Œå‘Šè¯‰ä½ æœ‰å¤šå°‘ä¸ªmallocï¼Œå¤šå°‘ä¸ªfree ç­‰ï¼›å¦‚æœæ˜¯fullå°†è¾“å‡ºæ‰€æœ‰çš„leaksï¼Œä¹Ÿå°±æ˜¯å®šä½åˆ°æŸä¸€ä¸ªmalloc/freeã€‚ [default: summary]</p>
<p>&ndash;show-reachable=&lt;yes|no&gt;ï¼šå¦‚æœä¸ºnoï¼Œåªè¾“å‡ºæ²¡æœ‰å¼•ç”¨çš„å†…å­˜leaksï¼Œæˆ–æŒ‡å‘mallocè¿”å›çš„å†…å­˜å—ä¸­éƒ¨æŸå¤„çš„leaks [default: no]</p>
<p>æ›´è¯¦ç»†çš„å‚æ•°æŒ‡ä»¤è§é™„å½•Aã€‚</p>
<h2 id="valgrindçš„ä½¿ç”¨">Valgrindçš„ä½¿ç”¨</h2>
<p>é¦–å…ˆï¼Œåœ¨ç¼–è¯‘ç¨‹åºçš„æ—¶å€™<strong>æ‰“å¼€è°ƒè¯•æ¨¡å¼</strong>ï¼ˆgccç¼–è¯‘å™¨çš„-gé€‰é¡¹ï¼‰ã€‚å¦‚æœæ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼Œå³ä½¿æœ€å¥½çš„valgrindå·¥å…·ä¹Ÿå°†ä¸èƒ½å¤ŸçŒœæµ‹ç‰¹å®šçš„ä»£ç æ˜¯å±äºå“ªä¸€ä¸ªå‡½æ•°ã€‚æ‰“å¼€è°ƒè¯•é€‰é¡¹è¿›è¡Œç¼–è¯‘åå†ç”¨valgrindæ£€æŸ¥ï¼Œvalgrindå°†ä¼šç»™ä½ çš„ä¸ªè¯¦ç»†çš„æŠ¥å‘Šï¼Œæ¯”å¦‚å“ªä¸€è¡Œä»£ç å‡ºç°äº†å†…å­˜æ³„æ¼ã€‚</p>
<p>å½“æ£€æŸ¥çš„æ˜¯C++ç¨‹åºçš„æ—¶å€™ï¼Œè¿˜åº”è¯¥è€ƒè™‘å¦ä¸€ä¸ªé€‰é¡¹ <code>-fno-inline</code>ã€‚å®ƒä½¿å¾—å‡½æ•°è°ƒç”¨é“¾å¾ˆæ¸…æ™°ï¼Œè¿™æ ·å¯ä»¥å‡å°‘ä½ åœ¨æµè§ˆå¤§å‹C++ç¨‹åºæ—¶çš„æ··ä¹±ã€‚æ¯”å¦‚åœ¨ä½¿ç”¨è¿™ä¸ªé€‰é¡¹çš„æ—¶å€™ï¼Œç”¨memcheckæ£€æŸ¥openofficeå°±å¾ˆå®¹æ˜“ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½ä¸ä¼šåšè¿™é¡¹å·¥ä½œï¼Œä½†æ˜¯ä½¿ç”¨è¿™ä¸€é€‰é¡¹ä½¿å¾—valgrindç”Ÿæˆæ›´ç²¾ç¡®çš„é”™è¯¯æŠ¥å‘Šå’Œå‡å°‘æ··ä¹±ã€‚</p>
<p>ä¸€äº›ç¼–è¯‘ä¼˜åŒ–é€‰é¡¹(æ¯”å¦‚-O2æˆ–è€…æ›´é«˜çš„ä¼˜åŒ–é€‰é¡¹)ï¼Œå¯èƒ½ä¼šä½¿å¾—memcheckæäº¤é”™è¯¯çš„æœªåˆå§‹åŒ–æŠ¥å‘Šï¼Œå› æ­¤ï¼Œä¸ºäº†ä½¿å¾—valgrindçš„æŠ¥å‘Šæ›´ç²¾ç¡®ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™æœ€å¥½ä¸è¦ä½¿ç”¨ä¼˜åŒ–é€‰é¡¹ã€‚</p>
<p>å¦‚æœç¨‹åºæ˜¯é€šè¿‡è„šæœ¬å¯åŠ¨çš„ï¼Œå¯ä»¥ä¿®æ”¹è„šæœ¬é‡Œå¯åŠ¨ç¨‹åºçš„ä»£ç ï¼Œæˆ–è€…ä½¿ç”¨&ndash;trace-children=yesé€‰é¡¹æ¥è¿è¡Œè„šæœ¬ã€‚</p>
<p>ä¸‹é¢æ˜¯ç”¨memcheckæ£€æŸ¥sample.cçš„ä¾‹å­</p>
<p>è¿™é‡Œç”¨åˆ°çš„ç¤ºä¾‹ç¨‹åºæ–‡ä»¶åä¸ºï¼šsample.cï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼‰,é€‰ç”¨çš„ç¼–è¯‘å™¨ä¸ºgccã€‚</p>
<p>ç”Ÿæˆå¯æ‰§è¡Œç¨‹åº</p>
<p><code>gcc â€“g sample.c â€“o sample</code></p>
<p><code>valgrind --tool=memcheck ./sample</code></p>
<p>ä»¥ä¸‹æ˜¯è¿è¡Œä¸Šè¿°å‘½ä»¤åçš„è¾“å‡ºï¼š</p>
<ul>
<li>
<p>å·¦è¾¹æ˜¾ç¤ºç±»ä¼¼è¡Œå·çš„æ•°å­—ï¼ˆ10297ï¼‰è¡¨ç¤ºçš„æ˜¯ Process IDã€‚</p>
</li>
<li>
<p>æœ€ä¸Šé¢çš„è¡¨ç¤ºçš„æ˜¯ valgrind çš„ç‰ˆæœ¬ä¿¡æ¯ã€‚</p>
</li>
<li>
<p>ä¸­é—´è¡¨ç¤º valgrind é€šè¿‡è¿è¡Œè¢«æµ‹è¯•ç¨‹åºï¼Œå‘ç°çš„å†…å­˜é—®é¢˜</p>
</li>
<li>
<p>æœ€ä¸‹é¢æ˜¯å¯¹å‘ç°çš„å†…å­˜é—®é¢˜å’Œå†…å­˜æ³„æ¼é—®é¢˜çš„æ€»ç»“ã€‚å†…å­˜æ³„æ¼çš„å¤§å°ï¼ˆ40 bytesï¼‰ä¹Ÿèƒ½å¤Ÿè¢«æ£€æµ‹å‡ºæ¥ã€‚</p>
</li>
</ul>
<h2 id="valgrindçš„ç¤ºä¾‹">Valgrindçš„ç¤ºä¾‹</h2>
<h3 id="ä¾‹1ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜">ä¾‹1ï¼ä½¿ç”¨æœªåˆå§‹åŒ–çš„å†…å­˜</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++">#include &lt;stdio.h&gt;                                                              
int main()
{ 
    int x;
    if(x == 0)
    { 
        printf(&quot;X is zero&quot;);
    }
    return 0;
}
</code></pre>
<pre><code>Valgrindæç¤ºå¦‚ä¸‹
==14222== Conditional jump or move depends on uninitialised value(s)
==14222== at 0x400484: main (sample2.c:6)
X is zero==14222==
==14222== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 5 from 1)
==14222== malloc/free: in use at exit: 0 bytes in 0 blocks.
==14222== malloc/free: 0 allocs, 0 frees, 0 bytes allocated.
==14222== For counts of detected errors, rerun with: -v
==14222== All heap blocks were freed -- no leaks are possible.
</code></pre>
<h3 id="ä¾‹2å†…å­˜è¯»å†™è¶Šç•Œ">ä¾‹2ï¼å†…å­˜è¯»å†™è¶Šç•Œ</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++">#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
int main(int argc,char *argv[])
{ 
    int len=5;
    int i;
    int *pt=(int*)malloc(len*sizeof(int));
    int *p=pt;
    for(i=0;i&lt;len;i++)
    {p++;}
    *p=5;
    printf(â€œ%dâ€,*p);
    return;
}
</code></pre>
<pre><code>Valgrindæç¤ºå¦‚ä¸‹
==23045== Invalid write of size 4
==23045== at 0x40050A: main (sample2.c:11)
==23045== Address 0x4C2E044 is 0 bytes after a block of size 20 alloc'd
==23045== at 0x4A05809: malloc (vg_replace_malloc.c:149)
==23045== by 0x4004DF: main (sample2.c:7)
==23045==
==23045== Invalid read of size 4
==23045== at 0x400514: main (sample2.c:12)
==23045== Address 0x4C2E044 is 0 bytes after a block of size 20 alloc'd
==23045== at 0x4A05809: malloc (vg_replace_malloc.c:149)
==23045== by 0x4004DF: main (sample2.c:7)
5==23045==
==23045== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 5 from 1)
==23045== malloc/free: in use at exit: 20 bytes in 1 blocks.
==23045== malloc/free: 1 allocs, 0 frees, 20 bytes allocated.
==23045== For counts of detected errors, rerun with: -v
==23045== searching for pointers to 1 not-freed blocks.
==23045== checked 66,584 bytes.
==23045==
==23045== LEAK SUMMARY:
==23045== definitely lost: 20 bytes in 1 blocks.
==23045== possibly lost: 0 bytes in 0 blocks.
==23045== still reachable: 0 bytes in 0 blocks.
==23045== suppressed: 0 bytes in 0 blocks.
==23045== Use --leak-check=full to see details of leaked memory.
</code></pre>
<h3 id="ä¾‹3srcå’Œdstå†…å­˜è¦†ç›–">ä¾‹3ï¼srcå’Œdstå†…å­˜è¦†ç›–</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++"> #include &lt;stdlib.h&gt;

 #include &lt;stdio.h&gt;

 #include &lt;string.h&gt;

 int main(int argc,char *argv[])

 { char x[50];

 int i;

 for(i=0;i&lt;50;i++)

 {x[i]=i;}

 strncpy(x+20,x,20); //Good

 strncpy(x+20,x,21); //Overlap

 x[39]=â€™\\0â€™;

 strcpy(x,x+20); //Good

 x[39]=40;

 x[40]=â€™\\0â€™;

 strcpy(x,x+20); //Overlap

 return 0;

 }
</code></pre>
<p>Valgrindæç¤ºå¦‚ä¸‹</p>
<pre><code> ==24139== Source and destination overlap in strncpy(0x7FEFFFC09, 0x7FEFFFBF5, 21)

 ==24139== at 0x4A0724F: strncpy (mc_replace_strmem.c:116)

 ==24139== by 0x400527: main (sample3.c:10)

 ==24139==

 ==24139== Source and destination overlap in strcpy(0x7FEFFFBE0, 0x7FEFFFBF4)

 ==24139== at 0x4A06E47: strcpy (mc_replace_strmem.c:106)

 ==24139== by 0x400555: main (sample3.c:15)

 ==24139==

 ==24139== ERROR SUMMARY: 2 errors from 2 contexts (suppressed: 5 from 1)

 ==24139== malloc/free: in use at exit: 0 bytes in 0 blocks.

 ==24139== malloc/free: 0 allocs, 0 frees, 0 bytes allocated.

 ==24139== For counts of detected errors, rerun with: -v

 ==24139== All heap blocks were freed -- no leaks are possible.
</code></pre>
<h3 id="ä¾‹4åŠ¨æ€å†…å­˜ç®¡ç†é”™è¯¯">ä¾‹4ï¼åŠ¨æ€å†…å­˜ç®¡ç†é”™è¯¯</h3>
<p>å¸¸è§çš„å†…å­˜åˆ†é…æ–¹å¼åˆ†ä¸‰ç§ï¼šé™æ€å­˜å‚¨ï¼Œæ ˆä¸Šåˆ†é…ï¼Œå †ä¸Šåˆ†é…ã€‚å…¨å±€å˜é‡å±äºé™æ€å­˜å‚¨ï¼Œå®ƒä»¬æ˜¯åœ¨ç¼–è¯‘æ—¶å°±è¢«åˆ†é…äº†å­˜å‚¨ç©ºé—´ï¼Œå‡½æ•°å†…çš„å±€éƒ¨å˜é‡å±äºæ ˆä¸Šåˆ†é…ï¼Œè€Œæœ€çµæ´»çš„å†…å­˜ä½¿ç”¨æ–¹å¼å½“å±å †ä¸Šåˆ†é…ï¼Œä¹Ÿå«åšå†…å­˜åŠ¨æ€åˆ†é…äº†ã€‚å¸¸ç”¨çš„å†…å­˜åŠ¨æ€åˆ†é…å‡½æ•°åŒ…æ‹¬ï¼šmalloc, alloc, realloc, newç­‰ï¼ŒåŠ¨æ€é‡Šæ”¾å‡½æ•°åŒ…æ‹¬free, deleteã€‚</p>
<p>ä¸€æ—¦æˆåŠŸç”³è¯·äº†åŠ¨æ€å†…å­˜ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå·±å¯¹å…¶è¿›è¡Œå†…å­˜ç®¡ç†ï¼Œè€Œè¿™åˆæ˜¯æœ€å®¹æ˜“çŠ¯é”™è¯¯çš„ã€‚å¸¸è§çš„å†…å­˜åŠ¨æ€ç®¡ç†é”™è¯¯åŒ…æ‹¬ï¼š</p>
<p>l ç”³è¯·å’Œé‡Šæ”¾ä¸ä¸€è‡´</p>
<p>ç”±äº C++ å…¼å®¹ Cï¼Œè€Œ C ä¸ C++ çš„å†…å­˜ç”³è¯·å’Œé‡Šæ”¾å‡½æ•°æ˜¯ä¸åŒçš„ï¼Œå› æ­¤åœ¨ C++ ç¨‹åºä¸­ï¼Œå°±æœ‰ä¸¤å¥—åŠ¨æ€å†…å­˜ç®¡ç†å‡½æ•°ã€‚ä¸€æ¡ä¸å˜çš„è§„åˆ™å°±æ˜¯é‡‡ç”¨ C æ–¹å¼ç”³è¯·çš„å†…å­˜å°±ç”¨ C æ–¹å¼é‡Šæ”¾ï¼›ç”¨ C++ æ–¹å¼ç”³è¯·çš„å†…å­˜ï¼Œç”¨ C++ æ–¹å¼é‡Šæ”¾ã€‚ä¹Ÿå°±æ˜¯ç”¨ malloc/alloc/realloc æ–¹å¼ç”³è¯·çš„å†…å­˜ï¼Œç”¨ free é‡Šæ”¾ï¼›ç”¨ new æ–¹å¼ç”³è¯·çš„å†…å­˜ç”¨ delete é‡Šæ”¾ã€‚åœ¨ä¸Šè¿°ç¨‹åºä¸­ï¼Œç”¨ malloc æ–¹å¼ç”³è¯·äº†å†…å­˜å´ç”¨ delete æ¥é‡Šæ”¾ï¼Œè™½ç„¶è¿™åœ¨å¾ˆå¤šæƒ…å†µä¸‹ä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†è¿™ç»å¯¹æ˜¯æ½œåœ¨çš„é—®é¢˜ã€‚</p>
<p>l ç”³è¯·å’Œé‡Šæ”¾ä¸åŒ¹é…</p>
<p>ç”³è¯·äº†å¤šå°‘å†…å­˜ï¼Œåœ¨ä½¿ç”¨å®Œæˆåå°±è¦é‡Šæ”¾å¤šå°‘ã€‚å¦‚æœæ²¡æœ‰é‡Šæ”¾ï¼Œæˆ–è€…å°‘é‡Šæ”¾äº†å°±æ˜¯å†…å­˜æ³„éœ²ï¼›å¤šé‡Šæ”¾äº†ä¹Ÿä¼šäº§ç”Ÿé—®é¢˜ã€‚ä¸Šè¿°ç¨‹åºä¸­ï¼ŒæŒ‡é’ˆpå’ŒptæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜ï¼Œå´è¢«å…ˆåé‡Šæ”¾ä¸¤æ¬¡ã€‚</p>
<p>l é‡Šæ”¾åä»ç„¶è¯»å†™</p>
<p>æœ¬è´¨ä¸Šè¯´ï¼Œç³»ç»Ÿä¼šåœ¨å †ä¸Šç»´æŠ¤ä¸€ä¸ªåŠ¨æ€å†…å­˜é“¾è¡¨ï¼Œå¦‚æœè¢«é‡Šæ”¾ï¼Œå°±æ„å‘³ç€è¯¥å—å†…å­˜å¯ä»¥ç»§ç»­è¢«åˆ†é…ç»™å…¶ä»–éƒ¨åˆ†ï¼Œå¦‚æœå†…å­˜è¢«é‡Šæ”¾åå†è®¿é—®ï¼Œå°±å¯èƒ½è¦†ç›–å…¶ä»–éƒ¨åˆ†çš„ä¿¡æ¯ï¼Œè¿™æ˜¯ä¸€ç§ä¸¥é‡çš„é”™è¯¯ï¼Œä¸Šè¿°ç¨‹åºç¬¬16è¡Œä¸­å°±åœ¨é‡Šæ”¾åä»ç„¶å†™è¿™å—å†…å­˜ã€‚</p>
<p>ä¸‹é¢çš„ä¸€æ®µç¨‹åºï¼Œå°±åŒ…æ‹¬äº†å†…å­˜åŠ¨æ€ç®¡ç†ä¸­å¸¸è§çš„é”™è¯¯ã€‚</p>
<pre><code class="language-c++"> #include &lt;stdlib.h&gt;

 #include &lt;stdio.h&gt;

 int main(int argc,char *argv[])

 { char *p=(char*)malloc(10);

 char *pt=p;

 int i;

 for(i=0;i&lt;10;i++)

 {p[i]=â€™zâ€™;}

 delete p;

 p[1]=â€™aâ€™;

 free(pt);

 return 0;

 }
</code></pre>
<p>Valgrindæç¤ºå¦‚ä¸‹</p>
<pre><code> ==25811== Mismatched free() / delete / delete []

 ==25811== at 0x4A05130: operator delete(void*) (vg_replace_malloc.c:244)

 ==25811== by 0x400654: main (sample4.c:9)

 ==25811== Address 0x4C2F030 is 0 bytes inside a block of size 10 alloc'd

 ==25811== at 0x4A05809: malloc (vg_replace_malloc.c:149)

 ==25811== by 0x400620: main (sample4.c:4)

 ==25811==

 ==25811== Invalid write of size 1

 ==25811== at 0x40065D: main (sample4.c:10)

 ==25811== Address 0x4C2F031 is 1 bytes inside a block of size 10 free'd

 ==25811== at 0x4A05130: operator delete(void*) (vg_replace_malloc.c:244)

 ==25811== by 0x400654: main (sample4.c:9)

 ==25811==

 ==25811== Invalid free() / delete / delete[]

 ==25811== at 0x4A0541E: free (vg_replace_malloc.c:233)

 ==25811== by 0x400668: main (sample4.c:11)

 ==25811== Address 0x4C2F030 is 0 bytes inside a block of size 10 free'd

 ==25811== at 0x4A05130: operator delete(void*) (vg_replace_malloc.c:244)

 ==25811== by 0x400654: main (sample4.c:9)

 ==25811==

 ==25811== ERROR SUMMARY: 3 errors from 3 contexts (suppressed: 5 from 1)

 ==25811== malloc/free: in use at exit: 0 bytes in 0 blocks.

 ==25811== malloc/free: 1 allocs, 2 frees, 10 bytes allocated.

 ==25811== For counts of detected errors, rerun with: -v

 ==25811== All heap blocks were freed -- no leaks are possible.
</code></pre>
<h3 id="ä¾‹5å†…å­˜æ³„æ¼">ä¾‹5ï¼å†…å­˜æ³„æ¼</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++"> #include &lt;stdlib.h&gt;

 int main()

 {

 char *x = (char*)malloc(20);

 char *y = (char*)malloc(20);

 x=y;

 free(x);

 free(y);

 return 0;

 }
</code></pre>
<p>Valgrindæç¤ºå¦‚ä¸‹</p>
<pre><code> ==19013== Invalid free() / delete / delete[]

 ==19013== at 0x4A0541E: free (vg_replace_malloc.c:233)

 ==19013== by 0x4004F5: main (sample5.c:8)

 ==19013== Address 0x4C2E078 is 0 bytes inside a block of size 20 free'd

 ==19013== at 0x4A0541E: free (vg_replace_malloc.c:233)

 ==19013== by 0x4004EC: main (sample5.c:7)

 ==19013==

 ==19013== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 5 from 1)

 ==19013== malloc/free: in use at exit: 20 bytes in 1 blocks.

 ==19013== malloc/free: 2 allocs, 2 frees, 40 bytes allocated.

 ==19013== For counts of detected errors, rerun with: -v

 ==19013== searching for pointers to 1 not-freed blocks.

 ==19013== checked 66,584 bytes.

 ==19013==

 ==19013== LEAK SUMMARY:

 ==19013== definitely lost: 20 bytes in 1 blocks.

 ==19013== possibly lost: 0 bytes in 0 blocks.

 ==19013== still reachable: 0 bytes in 0 blocks.

 ==19013== suppressed: 0 bytes in 0 blocks.

 ==19013== Use --leak-check=full to see details of leaked memory.
</code></pre>
<h3 id="ä¾‹6éæ³•å†™è¯»">ä¾‹6ï¼éæ³•å†™/è¯»</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++"> int main()

 {

 int i, *x;

 x = (int *)malloc(10*sizeof(int));

 for (i=0; i&lt;11; i++)

 x[i] = i;

 free(x);

 }
</code></pre>
<p>Valgrindæç¤ºå¦‚ä¸‹</p>
<pre><code> ==21483== Invalid write of size 4

 ==21483== at 0x4004EA: main (sample6.c:6)

 ==21483== Address 0x4C2E058 is 0 bytes after a block of size 40 alloc'd

 ==21483== at 0x4A05809: malloc (vg_replace_malloc.c:149)

 ==21483== by 0x4004C9: main (sample6.c:4)

 ==21483==

 ==21483== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 5 from 1)

 ==21483== malloc/free: in use at exit: 0 bytes in 0 blocks.

 ==21483== malloc/free: 1 allocs, 1 frees, 40 bytes allocated.

 ==21483== For counts of detected errors, rerun with: -v

 ==21483== All heap blocks were freed -- no leaks are possible.
</code></pre>
<h3 id="ä¾‹7æ— æ•ˆæŒ‡é’ˆ">ä¾‹7ï¼æ— æ•ˆæŒ‡é’ˆ</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++"> #include &lt;stdlib.h&gt;

 int main()

 {

 char *x = malloc(10);

 x[10] = 'a';

 free(x);

 return 0;

 }
</code></pre>
<p>Valgrindæç¤ºå¦‚ä¸‹</p>
<pre><code> ==15262== Invalid write of size 1

 ==15262== at 0x4004D6: main (sample7.c:5)

 ==15262== Address 0x4C2E03A is 0 bytes after a block of size 10 alloc'd

 ==15262== at 0x4A05809: malloc (vg_replace_malloc.c:149)

 ==15262== by 0x4004C9: main (sample7.c:4)

 ==15262==

 ==15262== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 5 from 1)

 ==15262== malloc/free: in use at exit: 0 bytes in 0 blocks.

 ==15262== malloc/free: 1 allocs, 1 frees, 10 bytes allocated.

 ==15262== For counts of detected errors, rerun with: -v

 ==15262== All heap blocks were freed -- no leaks are possible.
</code></pre>
<h3 id="ä¾‹8é‡å¤é‡Šæ”¾">ä¾‹8ï¼é‡å¤é‡Šæ”¾</h3>
<p>ä»£ç å¦‚ä¸‹</p>
<pre><code class="language-c++"> #include &lt;stdlib.h&gt;

 int main()

 {

 char *x = malloc(10);

 free(x);

 free(x);

 return 0;

 }
</code></pre>
<p>Valgrindæç¤ºå¦‚ä¸‹</p>
<pre><code> ==15005== Invalid free() / delete / delete[]

 ==15005== at 0x4A0541E: free (vg_replace_malloc.c:233)

 ==15005== by 0x4004DF: main (sample8.c:6)

 ==15005== Address 0x4C2E030 is 0 bytes inside a block of size 10 free'd

 ==15005== at 0x4A0541E: free (vg_replace_malloc.c:233)

 ==15005== by 0x4004D6: main (sample8.c:5)

 ==15005==

 ==15005== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 5 from 1)

 ==15005== malloc/free: in use at exit: 0 bytes in 0 blocks.

 ==15005== malloc/free: 1 allocs, 2 frees, 10 bytes allocated.

 ==15005== For counts of detected errors, rerun with: -v

 ==15005== All heap blocks were freed -- no leaks are possible.
</code></pre>
<h2 id="valgrindçš„å±€é™">Valgrindçš„å±€é™</h2>
<p>Valgrindä¸å¯¹é™æ€æ•°ç»„(åˆ†é…åœ¨æ ˆä¸Š)è¿›è¡Œè¾¹ç•Œæ£€æŸ¥ã€‚å¦‚æœåœ¨ç¨‹åºä¸­å£°æ˜äº†ä¸€ä¸ªæ•°ç»„:</p>
<pre><code class="language-c++"> int main()

 {

 char x[10];

 x[11] = 'a';

 }
</code></pre>
<p>Valgrindåˆ™ä¸ä¼šè­¦å‘Šä½ ï¼Œä½ å¯ä»¥æŠŠæ•°ç»„æ”¹ä¸ºåŠ¨æ€åœ¨å †ä¸Šåˆ†é…çš„æ•°ç»„ï¼Œè¿™æ ·å°±å¯èƒ½è¿›è¡Œè¾¹ç•Œæ£€æŸ¥äº†ã€‚è¿™ä¸ªæ–¹æ³•å¥½åƒæœ‰ç‚¹å¾—ä¸å¿å¤±çš„æ„Ÿè§‰ã€‚</p>
<p>Valgrindå ç”¨äº†æ›´å¤šçš„å†…å­˜&ndash;å¯è¾¾ä¸¤å€äºä½ ç¨‹åºçš„æ­£å¸¸ä½¿ç”¨é‡ã€‚å¦‚æœä½ ç”¨Valgrindæ¥æ£€æµ‹ä½¿ç”¨å¤§é‡å†…å­˜çš„ç¨‹åºå°±ä¼šé‡åˆ°é—®é¢˜ï¼Œå®ƒå¯èƒ½ä¼šç”¨å¾ˆé•¿çš„æ—¶é—´æ¥è¿è¡Œæµ‹è¯•ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™éƒ½ä¸æ˜¯é—®é¢˜ï¼Œå³ä½¿é€Ÿåº¦æ…¢ä¹Ÿä»…æ˜¯æ£€æµ‹æ—¶é€Ÿåº¦æ…¢ï¼Œå¦‚æœä½ ç”¨Valgrindæ¥æ£€æµ‹ä¸€ä¸ªæ­£å¸¸è¿è¡Œæ—¶é€Ÿåº¦å°±å¾ˆæ…¢çš„ç¨‹åºï¼Œè¿™ä¸‹é—®é¢˜å°±å¤§äº†ã€‚ Valgrindä¸å¯èƒ½æ£€æµ‹å‡ºä½ åœ¨ç¨‹åºä¸­çŠ¯ä¸‹çš„æ‰€æœ‰é”™è¯¯&ndash;å¦‚æœä½ ä¸æ£€æŸ¥ç¼“å†²åŒºæº¢å‡ºï¼ŒValgrindä¹Ÿä¸ä¼šå‘Šè¯‰ä½ ä»£ç å†™äº†å®ƒä¸åº”è¯¥å†™çš„å†…å­˜ã€‚</p>
<h2 id="é™„å½•aå‚æ•°æŒ‡ä»¤">é™„å½•Aï¼šå‚æ•°æŒ‡ä»¤</h2>
<h3 id="åŸºæœ¬é€‰é¡¹">åŸºæœ¬é€‰é¡¹ï¼š</h3>
<p>è¿™äº›é€‰é¡¹å¯¹æ‰€æœ‰å·¥å…·éƒ½æœ‰æ•ˆã€‚</p>
<p>-h &ndash;help</p>
<p>æ˜¾ç¤ºæ‰€æœ‰é€‰é¡¹çš„å¸®åŠ©ï¼ŒåŒ…æ‹¬å†…æ ¸å’Œé€‰å®šçš„å·¥å…·ä¸¤è€…ã€‚</p>
<p>&ndash;help-debug</p>
<p>å’Œ&ndash;helpç›¸åŒï¼Œå¹¶ä¸”è¿˜èƒ½æ˜¾ç¤ºé€šå¸¸åªæœ‰Valgrindçš„å¼€å‘äººå‘˜ä½¿ç”¨çš„è°ƒè¯•é€‰é¡¹ã€‚</p>
<p>&ndash;version</p>
<p>æ˜¾ç¤ºValgrindå†…æ ¸çš„ç‰ˆæœ¬å·ã€‚å·¥å…·å¯ä»¥æœ‰ä»–ä»¬è‡ªå·²çš„ç‰ˆæœ¬å·ã€‚è¿™æ˜¯ä¸€ç§ä¿è¯å·¥å…·åªåœ¨å®ƒä»¬å¯ä»¥è¿è¡Œçš„å†…æ ¸ä¸Šå·¥ä½œçš„ä¸€ç§è®¾ç½®ã€‚è¿™æ ·å¯ä»¥å‡å°‘åœ¨å·¥å…·å’Œå†…æ ¸ä¹‹é—´ç‰ˆæœ¬å…¼å®¹æ€§å¯¼è‡´å¥‡æ€ªé—®é¢˜çš„æ¦‚ç‡ã€‚</p>
<p>-q &ndash;quiet</p>
<p>å®‰é™çš„è¿è¡Œï¼Œåªæ‰“å°é”™è¯¯ä¿¡æ¯ã€‚åœ¨è¿›è¡Œå›å½’æµ‹è¯•æˆ–è€…æœ‰å…¶å®ƒçš„è‡ªåŠ¨åŒ–æµ‹è¯•æœºåˆ¶æ—¶ä¼šéå¸¸æœ‰ç”¨ã€‚</p>
<p>-v &ndash;verbose</p>
<p>æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚åœ¨å„ä¸ªæ–¹é¢æ˜¾ç¤ºä½ çš„ç¨‹åºçš„é¢å¤–ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šå…±äº«å¯¹è±¡åŠ è½½ï¼Œä½¿ç”¨çš„é‡ç½®ï¼Œæ‰§è¡Œå¼•æ“å’Œå·¥å…·çš„è¿›ç¨‹ï¼Œå¼‚å¸¸è¡Œä¸ºçš„è­¦å‘Šä¿¡æ¯ã€‚é‡å¤è¿™ä¸ªæ ‡è®°å¯ä»¥å¢åŠ è¯¦ç»†çš„çº§åˆ«ã€‚</p>
<p>-d</p>
<p>è°ƒè¯•Valgrindè‡ªèº«å‘å‡ºçš„ä¿¡æ¯ã€‚é€šå¸¸åªæœ‰Valgrindå¼€å‘äººå‘˜å¯¹æ­¤æ„Ÿå…´è¶£ã€‚é‡å¤è¿™ä¸ªæ ‡è®°å¯ä»¥äº§ç”Ÿæ›´è¯¦ç»†çš„è¾“å‡ºã€‚å¦‚æœä½ å¸Œæœ›å‘é€ä¸€ä¸ªbugæŠ¥å‘Šï¼Œé€šè¿‡-v -v -d -dç”Ÿæˆçš„è¾“å‡ºä¼šä½¿ä½ çš„æŠ¥å‘Šæ›´åŠ æœ‰æ•ˆã€‚</p>
<p>&ndash;tool=<toolname> [default: memcheck]</p>
<p>è¿è¡ŒtoolnameæŒ‡å®šçš„Valgrindï¼Œä¾‹å¦‚ï¼ŒMemcheck, Addrcheck, Cachegrind,ç­‰ç­‰ã€‚</p>
<p>&ndash;trace-children=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼ŒValgrindä¼šè·Ÿè¸ªåˆ°å­è¿›ç¨‹ä¸­ã€‚è¿™ç»å¸¸ä¼šå¯¼è‡´å›°æƒ‘ï¼Œè€Œä¸”é€šå¸¸ä¸æ˜¯ä½ æ‰€æœŸæœ›çš„ï¼Œæ‰€ä»¥é»˜è®¤è¿™ä¸ªé€‰é¡¹æ˜¯å…³é—­çš„ã€‚</p>
<p>&ndash;track-fds=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼ŒValgrindä¼šåœ¨é€€å‡ºæ—¶æ‰“å°ä¸€ä¸ªæ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„åˆ—è¡¨ã€‚æ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦éƒ½ä¼šæ‰“å°å‡ºä¸€ä¸ªæ–‡ä»¶æ˜¯åœ¨å“ªé‡Œæ‰“å¼€çš„æ ˆå›æº¯ï¼Œå’Œä»»ä½•ä¸æ­¤æ–‡ä»¶æè¿°ç¬¦ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯æ¯”å¦‚æ–‡ä»¶åæˆ–socketä¿¡æ¯ã€‚</p>
<p>&ndash;time-stamp=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œæ¯æ¡ä¿¡æ¯ä¹‹å‰éƒ½æœ‰ä¸€ä¸ªä»ç¨‹åºå¼€å§‹æ¶ˆé€çš„æ—¶é—´ï¼Œç”¨å¤©ï¼Œå°æ—¶ï¼Œåˆ†é’Ÿï¼Œç§’å’Œæ¯«ç§’è¡¨ç¤ºã€‚</p>
<p>&ndash;log-fd=<number> [default: 2, stderr]</p>
<p>æŒ‡å®šValgrindæŠŠå®ƒæ‰€æœ‰çš„æ¶ˆæ¯éƒ½è¾“å‡ºåˆ°ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ä¸­å»ã€‚é»˜è®¤å€¼2, æ˜¯æ ‡å‡†é”™è¯¯è¾“å‡º(stderr)ã€‚æ³¨æ„è¿™å¯èƒ½ä¼šå¹²æ‰°åˆ°å®¢æˆ·ç«¯è‡ªèº«å¯¹stderrçš„ä½¿ç”¨, Valgrindçš„è¾“å‡ºä¸å®¢æˆ·ç¨‹åºçš„è¾“å‡ºå°†ç©¿æ’åœ¨ä¸€èµ·è¾“å‡ºåˆ°stderrã€‚</p>
<p>&ndash;log-file=<filename></p>
<p>æŒ‡å®šValgrindæŠŠå®ƒæ‰€æœ‰çš„ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚å®é™…ä¸Šï¼Œè¢«åˆ›å»ºæ–‡ä»¶çš„æ–‡ä»¶åæ˜¯ç”±filenameã€&rsquo;.&lsquo;å’Œè¿›ç¨‹å·è¿æ¥èµ·æ¥çš„ï¼ˆå³<filename>.<pid>ï¼‰ï¼Œä»è€Œæ¯ä¸ªè¿›ç¨‹åˆ›å»ºä¸åŒçš„æ–‡ä»¶ã€‚</p>
<p>&ndash;log-file-exactly=<filename></p>
<p>ç±»ä¼¼äº&ndash;log-fileï¼Œä½†æ˜¯åç¼€&quot;.pid&quot;ä¸ä¼šè¢«æ·»åŠ ã€‚å¦‚æœè®¾ç½®äº†è¿™ä¸ªé€‰é¡¹ï¼Œä½¿ç”¨Valgrindè·Ÿè¸ªå¤šä¸ªè¿›ç¨‹ï¼Œå¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªä¹±ä¸ƒå…«ç³Ÿçš„æ–‡ä»¶ã€‚</p>
<p>&ndash;log-file-qualifier=<VAR></p>
<p>å½“å’Œ&ndash;log-fileä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæ—¥å¿—æ–‡ä»¶åå°†é€šè¿‡ç¯å¢ƒå˜é‡$VARæ¥ç­›é€‰ã€‚è¿™å¯¹äºMPIç¨‹åºæ˜¯æœ‰ç›Šçš„ã€‚æ›´å¤šçš„ç»†èŠ‚ï¼ŒæŸ¥çœ‹æ‰‹å†Œ2.3èŠ‚ &ldquo;æ³¨è§£&rdquo;ã€‚</p>
<p>&ndash;log-socket=
<a href="ip-address:port-number" >ip-address:port-number</a>
</p>
<p>æŒ‡å®šValgrindè¾“å‡ºæ‰€æœ‰çš„æ¶ˆæ¯åˆ°æŒ‡å®šçš„IPï¼ŒæŒ‡å®šçš„ç«¯å£ã€‚å½“ä½¿ç”¨1500ç«¯å£æ—¶ï¼Œç«¯å£æœ‰å¯èƒ½è¢«å¿½ç•¥ã€‚å¦‚æœä¸èƒ½å»ºç«‹ä¸€ä¸ªåˆ°æŒ‡å®šç«¯å£çš„è¿æ¥ï¼ŒValgrindå°†è¾“å‡ºå†™åˆ°æ ‡å‡†é”™è¯¯(stderr)ã€‚è¿™ä¸ªé€‰é¡¹ç»å¸¸å’Œä¸€ä¸ªValgrindç›‘å¬ç¨‹åºä¸€èµ·ä½¿ç”¨ã€‚æ›´å¤šçš„ç»†èŠ‚ï¼ŒæŸ¥çœ‹æ‰‹å†Œ2.3èŠ‚ &ldquo;æ³¨è§£&rdquo;ã€‚</p>
<h3 id="é”™è¯¯ç›¸å…³é€‰é¡¹">é”™è¯¯ç›¸å…³é€‰é¡¹ï¼š</h3>
<p>è¿™äº›é€‰é¡¹é€‚ç”¨äºæ‰€æœ‰äº§ç”Ÿé”™è¯¯çš„å·¥å…·ï¼Œæ¯”å¦‚Memcheck, ä½†æ˜¯Cachegrindä¸è¡Œã€‚</p>
<p>&ndash;xml=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œè¾“å‡ºå°†æ˜¯XMLæ ¼å¼ã€‚è¿™æ˜¯ä¸ºäº†ä½¿ç”¨Valgrindçš„è¾“å‡ºåšä¸ºè¾“å…¥çš„å·¥å…·ï¼Œä¾‹å¦‚GUIå‰ç«¯æ›´åŠ å®¹æ˜“äº›ã€‚ç›®å‰è¿™ä¸ªé€‰é¡¹åªåœ¨Memcheckæ—¶ç”Ÿæ•ˆã€‚</p>
<p>&ndash;xml-user-comment=<string></p>
<p>åœ¨XMLå¼€å¤´ é™„åŠ ç”¨æˆ·æ³¨é‡Šï¼Œä»…åœ¨æŒ‡å®šäº†&ndash;xml=yesæ—¶ç”Ÿæ•ˆï¼Œå¦åˆ™å¿½ç•¥ã€‚</p>
<p>&ndash;demangle=&lt;yes|no&gt; [default: yes]</p>
<p>æ‰“å¼€/å…³é—­C++çš„åå­—è‡ªåŠ¨è§£ç ã€‚é»˜è®¤æ‰“å¼€ã€‚å½“æ‰“å¼€æ—¶ï¼ŒValgrindå°†å°è¯•ç€æŠŠç¼–ç è¿‡çš„C++åå­—è‡ªåŠ¨è½¬å›åˆå§‹çŠ¶æ€ã€‚è¿™ä¸ªè§£ç å™¨å¯ä»¥å¤„ç†g++ç‰ˆæœ¬ä¸º2.X,3.Xæˆ–4.Xç”Ÿæˆçš„ç¬¦å·ã€‚ä¸€ä¸ªå…³äºåå­—ç¼–ç è§£ç é‡è¦çš„äº‹å®æ˜¯ï¼Œç¦æ­¢æ–‡ä»¶ä¸­çš„è§£ç å‡½æ•°åä»ç„¶ä½¿ç”¨ä»–ä»¬æœªè§£ç çš„å½¢å¼ã€‚Valgrindåœ¨æœå¯»å¯ç”¨çš„ç¦æ­¢æ¡ç›®æ—¶ä¸å¯¹å‡½æ•°åè§£ç ï¼Œå› ä¸ºè¿™å°†ä½¿ç¦æ­¢æ–‡ä»¶å†…å®¹ä¾èµ–äºValgrindçš„åå­—è§£ç æœºåˆ¶çŠ¶æ€ï¼Œä¼šä½¿é€Ÿåº¦å˜æ…¢ï¼Œä¸”æ— æ„ä¹‰ã€‚</p>
<p>&ndash;num-callers=<number> [default: 12]</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒValgrindæ˜¾ç¤º12å±‚å‡½æ•°è°ƒç”¨çš„å‡½æ•°åæœ‰åŠ©äºç¡®å®šç¨‹åºçš„ä½ç½®ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹æ¥æ”¹å˜è¿™ä¸ªæ•°å­—ã€‚è¿™æ ·æœ‰åŠ©åœ¨åµŒå¥—è°ƒç”¨çš„å±‚æ¬¡å¾ˆæ·±æ—¶ç¡®å®šç¨‹åºçš„ä½ç½®ã€‚æ³¨æ„é”™è¯¯ä¿¡æ¯é€šå¸¸åªå›æº¯åˆ°æœ€é¡¶ä¸Šçš„4ä¸ªå‡½æ•°ã€‚(å½“å‰å‡½æ•°ï¼Œå’Œå®ƒçš„3ä¸ªè°ƒç”¨è€…çš„ä½ç½®)ã€‚æ‰€ä»¥è¿™å¹¶ä¸å½±å“æŠ¥å‘Šçš„é”™è¯¯æ€»æ•°ã€‚è¿™ä¸ªå€¼çš„æœ€å¤§å€¼æ˜¯50ã€‚æ³¨æ„é«˜çš„è®¾ç½®ä¼šä½¿Valgrindè¿è¡Œå¾—æ…¢ï¼Œå¹¶ä¸”ä½¿ç”¨æ›´å¤šçš„å†…å­˜,ä½†æ˜¯åœ¨åµŒå¥—è°ƒç”¨å±‚æ¬¡æ¯”è¾ƒé«˜çš„ç¨‹åºä¸­éå¸¸å®ç”¨ã€‚</p>
<p>&ndash;error-limit=&lt;yes|no&gt; [default: yes]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œåœ¨æ€»é‡è¾¾åˆ°10,000,000ï¼Œæˆ–è€…1,000ä¸ªä¸åŒçš„é”™è¯¯ï¼ŒValgrindåœæ­¢æŠ¥å‘Šé”™è¯¯ã€‚è¿™æ˜¯ä¸ºäº†é¿å…é”™è¯¯è·Ÿè¸ªæœºåˆ¶åœ¨é”™è¯¯å¾ˆå¤šçš„ç¨‹åºä¸‹å˜æˆä¸€ä¸ªå·¨å¤§çš„æ€§èƒ½è´Ÿæ‹…ã€‚</p>
<p>&ndash;error-exitcode=<number> [default: 0]</p>
<p>æŒ‡å®šå¦‚æœValgrindåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥å‘Šä»»ä½•é”™è¯¯æ—¶çš„é€€å‡ºè¿”å›å€¼ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼›å½“è®¾ç½®ä¸ºé»˜è®¤å€¼(é›¶)æ—¶ï¼ŒValgrindè¿”å›çš„å€¼å°†æ˜¯å®ƒæ¨¡æ‹Ÿè¿è¡Œçš„ç¨‹åºçš„è¿”å›å€¼ã€‚å½“è®¾ç½®ä¸ºéé›¶å€¼æ—¶ï¼Œå¦‚æœValgrindå‘ç°ä»»ä½•é”™è¯¯æ—¶åˆ™è¿”å›è¿™ä¸ªå€¼ã€‚åœ¨Valgrindåšä¸ºä¸€ä¸ªæµ‹è¯•å·¥å…·å¥—ä»¶çš„éƒ¨åˆ†ä½¿ç”¨æ—¶è¿™å°†éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºä½¿æµ‹è¯•å·¥å…·å¥—ä»¶åªæ£€æŸ¥Valgrindè¿”å›å€¼å°±å¯ä»¥çŸ¥é“å“ªäº›æµ‹è¯•ç”¨ä¾‹ValgrindæŠ¥å‘Šäº†é”™è¯¯ã€‚</p>
<p>&ndash;show-below-main=&lt;yes|no&gt; [default: no]</p>
<p>é»˜è®¤åœ°ï¼Œé”™è¯¯æ—¶çš„æ ˆå›æº¯ä¸æ˜¾ç¤ºmain()ä¹‹ä¸‹çš„ä»»ä½•å‡½æ•°(æˆ–è€…ç±»ä¼¼çš„å‡½æ•°åƒglibcçš„__libc_start_main()ï¼Œå¦‚æœmain()æ²¡æœ‰å‡ºç°åœ¨æ ˆå›æº¯ä¸­)ï¼›è¿™äº›å¤§éƒ¨åˆ†éƒ½æ˜¯ä»¤äººåŒå€¦çš„Cåº“å‡½æ•°ã€‚å¦‚æœæ‰“å¼€è¿™ä¸ªé€‰é¡¹ï¼Œåœ¨main()ä¹‹ä¸‹çš„å‡½æ•°ä¹Ÿå°†ä¼šæ˜¾ç¤ºã€‚</p>
<p>&ndash;suppressions=<filename> [default: $PREFIX/lib/valgrind/default.supp]</p>
<p>æŒ‡å®šä¸€ä¸ªé¢å¤–çš„æ–‡ä»¶è¯»å–ä¸éœ€è¦ç†ä¼šçš„é”™è¯¯ï¼›ä½ å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ä»»æ„å¤šçš„é¢å¤–æ–‡ä»¶ã€‚</p>
<p>&ndash;gen-suppressions=&lt;yes|no|all&gt; [default: no]</p>
<p>å½“è®¾ç½®ä¸ºyesæ—¶ï¼ŒValgrindå°†ä¼šåœ¨æ¯ä¸ªé”™è¯¯æ˜¾ç¤ºä¹‹åè‡ªåŠ¨æš‚åœå¹¶ä¸”æ‰“å°ä¸‹é¢è¿™ä¸€è¡Œï¼š&mdash;- Print suppression ? &mdash; [Return/N/n/Y/y/C/c] &mdash;-è¿™ä¸ªæç¤ºçš„è¡Œä¸ºå’Œ&ndash;db-attaché€‰é¡¹(è§ä¸‹é¢)ç›¸åŒã€‚å¦‚æœé€‰æ‹©æ˜¯ï¼ŒValgrindä¼šæ‰“å°å‡ºä¸€ä¸ªé”™è¯¯çš„ç¦æ­¢æ¡ç›®ï¼Œä½ å¯ä»¥æŠŠå®ƒå‰ªåˆ‡ç„¶åç²˜å¸–åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœä¸å¸Œæœ›åœ¨å°†æ¥å†çœ‹åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯ã€‚å½“è®¾ç½®ä¸ºallæ—¶ï¼ŒValgrindä¼šå¯¹æ¯ä¸€ä¸ªé”™è¯¯æ‰“å°ä¸€æ¡ç¦æ­¢æ¡ç›®ï¼Œè€Œä¸å‘ç”¨æˆ·è¯¢é—®ã€‚è¿™ä¸ªé€‰é¡¹å¯¹C++ç¨‹åºéå¸¸æœ‰ç”¨ï¼Œå®ƒæ‰“å°å‡ºç¼–è¯‘å™¨è°ƒæ•´è¿‡çš„åå­—ã€‚æ³¨æ„æ‰“å°å‡ºæ¥çš„ç¦æ­¢æ¡ç›®æ˜¯å°½å¯èƒ½çš„ç‰¹å®šçš„ã€‚å¦‚æœéœ€è¦æŠŠç±»ä¼¼çš„æ¡ç›®å½’çº³èµ·æ¥ï¼Œæ¯”å¦‚åœ¨å‡½æ•°åä¸­æ·»åŠ é€šé…ç¬¦ã€‚å¹¶ä¸”ï¼Œæœ‰äº›æ—¶å€™ä¸¤ä¸ªä¸åŒçš„é”™è¯¯ä¹Ÿä¼šäº§ç”ŸåŒæ ·çš„ç¦æ­¢æ¡ç›®ï¼Œè¿™æ—¶Valgrindå°±ä¼šè¾“å‡ºç¦æ­¢æ¡ç›®ä¸æ­¢ä¸€æ¬¡ï¼Œä½†æ˜¯åœ¨ç¦æ­¢æ¡ç›®çš„æ–‡ä»¶ä¸­åªéœ€è¦ä¸€ä»½æ‹·è´(ä½†æ˜¯å¦‚æœå¤šäºä¸€ä»½ä¹Ÿä¸ä¼šå¼•èµ·ä»€ä¹ˆé—®é¢˜)ã€‚å¹¶ä¸”ï¼Œç¦æ­¢æ¡ç›®çš„åå­—åƒ&lt;åœ¨è¿™å„¿è¾“å…¥ä¸€ä¸ªç¦æ­¢æ¡ç›®çš„åå­—&gt;;åå­—å¹¶ä¸æ˜¯å¾ˆé‡è¦ï¼Œå®ƒåªæ˜¯å’Œ-vé€‰é¡¹ä¸€èµ·ä½¿ç”¨æ‰“å°å‡ºæ‰€æœ‰ä½¿ç”¨çš„ç¦æ­¢æ¡ç›®è®°å½•ã€‚</p>
<p>&ndash;db-attach=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼ŒValgrindå°†ä¼šåœ¨æ¯æ¬¡æ‰“å°é”™è¯¯æ—¶æš‚åœå¹¶æ‰“å‡ºå¦‚ä¸‹ä¸€è¡Œï¼š&mdash;- Attach to debugger ? &mdash; [Return/N/n/Y/y/C/c] &mdash;- æŒ‰ä¸‹å›è½¦,æˆ–è€…Nã€å›è½¦ï¼Œnã€å›è½¦ï¼ŒValgrindä¸ä¼šå¯¹è¿™ä¸ªé”™è¯¯å¯åŠ¨è°ƒè¯•å™¨ã€‚æŒ‰ä¸‹Yã€å›è½¦ï¼Œæˆ–è€…yã€å›è½¦ï¼ŒValgrindä¼šå¯åŠ¨è°ƒè¯•å™¨å¹¶è®¾å®šåœ¨ç¨‹åºè¿è¡Œçš„è¿™ä¸ªç‚¹ã€‚å½“è°ƒè¯•ç»“æŸæ—¶ï¼Œé€€å‡ºï¼Œç¨‹åºä¼šç»§ç»­è¿è¡Œã€‚åœ¨è°ƒè¯•å™¨å†…éƒ¨å°è¯•ç»§ç»­è¿è¡Œç¨‹åºï¼Œå°†ä¸ä¼šç”Ÿæ•ˆã€‚æŒ‰ä¸‹Cã€å›è½¦ï¼Œæˆ–è€…cã€å›è½¦ï¼ŒValgrindä¸ä¼šå¯åŠ¨ä¸€ä¸ªè°ƒè¯•å™¨ï¼Œå¹¶ä¸”ä¸ä¼šå†æ¬¡è¯¢é—®ã€‚æ³¨æ„ï¼š&ndash;db-attach=yesä¸&ndash;trace-children=yesæœ‰å†²çªã€‚ä½ ä¸èƒ½åŒæ—¶ä½¿ç”¨å®ƒä»¬ã€‚Valgrindåœ¨è¿™ç§æƒ…å†µä¸‹ä¸èƒ½å¯åŠ¨ã€‚</p>
<p>2002.05: è¿™æ˜¯ä¸€ä¸ªå†å²çš„é—ç•™ç‰©ï¼Œå¦‚æœè¿™ä¸ªé—®é¢˜å½±å“åˆ°ä½ ï¼Œè¯·å‘é€é‚®ä»¶å¹¶æŠ•è¯‰è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>2002.11:å¦‚æœä½ å‘é€è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶æˆ–è€…åˆ°ç½‘ç»œç«¯å£ï¼Œæˆ‘çŒœè¿™ä¸ä¼šè®©ä½ æœ‰ä»»ä½•æ„Ÿè§‰ã€‚ä¸é¡»ç†ä¼šã€‚</p>
<p>&ndash;db-command=<command> [default: gdb -nw %f %p]</p>
<p>é€šè¿‡&ndash;db-attachæŒ‡å®šå¦‚ä½•ä½¿ç”¨è°ƒè¯•å™¨ã€‚é»˜è®¤çš„è°ƒè¯•å™¨æ˜¯gdb.é»˜è®¤çš„é€‰é¡¹æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶æ‰©å±•Valgrindçš„æ¨¡æ¿ã€‚ %fä¼šç”¨å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶åæ›¿æ¢ï¼Œ%pä¼šè¢«å¯æ‰§è¡Œæ–‡ä»¶çš„è¿›ç¨‹IDæ›¿æ¢ã€‚</p>
<p>è¿™æŒ‡å®šäº†Valgrindå°†æ€æ ·è°ƒç”¨è°ƒè¯•å™¨ã€‚é»˜è®¤é€‰é¡¹ä¸ä¼šå› ä¸ºåœ¨æ„é€ æ—¶æ˜¯å¦æ£€æµ‹åˆ°äº†GDBè€Œæ”¹å˜,é€šå¸¸æ˜¯/usr/bin/gdb.ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€äº›è°ƒç”¨å…¶å®ƒçš„è°ƒè¯•å™¨æ¥æ›¿æ¢ã€‚</p>
<p>ç»™å‡ºçš„è¿™ä¸ªå‘½ä»¤å­—ä¸²å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ª%p %fæ‰©å±•ã€‚æ¯ä¸€ä¸ª%på®ä¾‹éƒ½è¢«è§£é‡Šæˆå°†è°ƒè¯•çš„è¿›ç¨‹çš„PIDï¼Œæ¯ä¸€ä¸ª%få®ä¾‹éƒ½è¢«è§£é‡Šæˆè¦è°ƒè¯•çš„è¿›ç¨‹çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ã€‚</p>
<p>&ndash;input-fd=<number> [default: 0, stdin]</p>
<p>ä½¿ç”¨&ndash;db-attach=yeså’Œ&ndash;gen-suppressions=yesé€‰é¡¹ï¼Œåœ¨å‘ç°é”™è¯¯æ—¶ï¼ŒValgrindä¼šåœä¸‹æ¥å»è¯»å–é”®ç›˜è¾“å…¥ã€‚é»˜è®¤åœ°ï¼Œä»æ ‡å‡†è¾“å…¥è¯»å–ï¼Œæ‰€ä»¥å…³é—­äº†æ ‡å‡†è¾“å…¥çš„ç¨‹åºä¼šæœ‰é—®é¢˜ã€‚è¿™ä¸ªé€‰é¡¹å…è®¸ä½ æŒ‡å®šä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ¥æ›¿ä»£æ ‡å‡†è¾“å…¥è¯»å–ã€‚</p>
<p>&ndash;max-stackframe=<number> [default: 2000000]</p>
<p>æ ˆçš„æœ€å¤§å€¼ã€‚å¦‚æœæ ˆæŒ‡é’ˆçš„åç§»è¶…è¿‡è¿™ä¸ªæ•°é‡ï¼ŒValgrindåˆ™ä¼šè®¤ä¸ºç¨‹åºæ˜¯åˆ‡æ¢åˆ°äº†å¦å¤–ä¸€ä¸ªæ ˆæ‰§è¡Œã€‚å¦‚æœåœ¨ç¨‹åºä¸­æœ‰å¤§é‡çš„æ ˆåˆ†é…çš„æ•°ç»„ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚valgrindä¿æŒå¯¹ç¨‹åºæ ˆæŒ‡é’ˆçš„è¿½è¸ªã€‚å¦‚æœæ ˆæŒ‡é’ˆçš„åç§»è¶…è¿‡äº†è¿™ä¸ªæ•°é‡ï¼ŒValgrindå‡å®šä½ çš„ç¨‹åºåˆ‡æ¢åˆ°äº†å¦å¤–ä¸€ä¸ªæ ˆï¼Œå¹¶ä¸”Memcheckè¡Œä¸ºä¸æ ˆæŒ‡</p>
<p>é’ˆçš„åç§»æ²¡æœ‰è¶…å‡ºè¿™ä¸ªæ•°é‡å°†ä¼šä¸åŒã€‚é€šå¸¸è¿™ç§æœºåˆ¶è¿è½¬å¾—å¾ˆå¥½ã€‚ç„¶è€Œï¼Œå¦‚æœä½ çš„ç¨‹åºåœ¨æ ˆä¸Šç”³è¯·äº†å¤§çš„ç»“æ„ï¼Œè¿™ç§æœºåˆ¶å°†ä¼šè¡¨ç°å¾—æ„šè ¢ï¼Œå¹¶ä¸”Memcheckå°†ä¼šæŠ¥å‘Šå¤§é‡çš„éæ³•æ ˆå†…å­˜è®¿é—®ã€‚è¿™ä¸ªé€‰é¡¹å…è®¸æŠŠè¿™ä¸ªé˜€å€¼è®¾ç½®ä¸ºå…¶å®ƒå€¼ã€‚åº”è¯¥åªåœ¨Valgrindçš„è°ƒè¯•è¾“å‡ºä¸­æ˜¾ç¤ºéœ€è¦è¿™ä¹ˆåšæ—¶æ‰ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šå‘Šè¯‰ä½ åº”è¯¥æŒ‡å®šçš„æ–°çš„é˜€å€¼ã€‚æ™®éåœ°ï¼Œåœ¨æ ˆä¸­åˆ†é…å¤§å—çš„å†…å­˜æ˜¯ä¸€ä¸ªåçš„ä¸»æ„ã€‚å› ä¸ºè¿™å¾ˆå®¹æ˜“ç”¨å…‰ä½ çš„æ ˆç©ºé—´ï¼Œå°¤å…¶æ˜¯åœ¨å†…å­˜å—é™çš„ç³»ç»Ÿæˆ–è€…æ”¯æŒå¤§é‡å°å †æ ˆçš„çº¿ç¨‹çš„ç³»ç»Ÿä¸Šï¼Œå› ä¸ºMemcheckæ‰§è¡Œçš„é”™è¯¯æ£€æŸ¥ï¼Œå¯¹äºå †ä¸Šçš„æ•°æ®æ¯”å¯¹æ ˆä¸Šçš„æ•°æ®è¦é«˜æ•ˆå¾ˆå¤šã€‚å¦‚æœä½ ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œä½ å¯èƒ½å¸Œæœ›è€ƒè™‘é‡å†™ä»£ç åœ¨å †ä¸Šåˆ†é…å†…å­˜è€Œä¸æ˜¯åœ¨æ ˆä¸Šåˆ†é…ã€‚</p>
<h3 id="mallocç›¸å…³çš„é€‰é¡¹">MALLOC()ç›¸å…³çš„é€‰é¡¹:</h3>
<p>å¯¹äºä½¿ç”¨è‡ªæœ‰ç‰ˆæœ¬çš„malloc() (ä¾‹å¦‚Memcheckå’Œmassif)ï¼Œä¸‹é¢çš„é€‰é¡¹å¯ä»¥ä½¿ç”¨ã€‚</p>
<p>&ndash;alignment=<number> [default: 8]</p>
<p>é»˜è®¤Valgrindçš„malloc(),realloc(), ç­‰ç­‰ï¼Œæ˜¯8å­—èŠ‚å¯¹é½åœ°å€çš„ã€‚è¿™æ˜¯å¤§éƒ¨åˆ†å¤„ç†å™¨çš„æ ‡å‡†ã€‚ç„¶è€Œï¼Œä¸€äº›ç¨‹åºå¯èƒ½å‡å®šmalloc()ç­‰æ€»æ˜¯è¿”å›16å­—èŠ‚æˆ–æ›´å¤šå¯¹é½çš„å†…å­˜ã€‚æä¾›çš„æ•°å€¼å¿…é¡»åœ¨8å’Œ4096åŒºé—´ä¹‹å†…ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯2çš„å¹‚æ•°ã€‚</p>
<p>éé€šç”¨é€‰é¡¹ï¼š</p>
<p>è¿™äº›é€‰é¡¹å¯ä»¥ç”¨äºæ‰€æœ‰çš„å·¥å…·ï¼Œå®ƒä»¬å½±å“Valgrind coreçš„å‡ ä¸ªç‰¹æ€§ã€‚å¤§éƒ¨åˆ†äººä¸ä¼šç”¨åˆ°è¿™äº›é€‰é¡¹ã€‚</p>
<p>&ndash;run-libc-freeres=&lt;yes|no&gt; [default: yes]</p>
<p>GNU Cåº“(libc.so)ï¼Œæ‰€æœ‰ç¨‹åºå…±ç”¨çš„ï¼Œå¯èƒ½ä¼šåˆ†é…ä¸€éƒ¨åˆ†å†…å­˜è‡ªå·²ç”¨ã€‚é€šå¸¸åœ¨ç¨‹åºé€€å‡ºæ—¶é‡Šæ”¾å†…å­˜å¹¶ä¸éº»çƒ¦ &ndash; è¿™é‡Œæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºLinuxå†…æ ¸åœ¨ä¸€ä¸ªè¿›ç¨‹é€€å‡ºæ—¶ä¼šå›æ”¶è¿›ç¨‹å…¨éƒ¨çš„èµ„æºï¼Œæ‰€ä»¥è¿™åªæ˜¯ä¼šé€ æˆé€Ÿåº¦æ…¢ã€‚glibcçš„ä½œè€…è®¤è¯†åˆ°è¿™æ ·ä¼šå¯¼è‡´å†…å­˜æ£€æŸ¥å™¨ï¼ŒåƒValgrindï¼Œåœ¨é€€å‡ºæ—¶æ£€æŸ¥å†…å­˜é”™è¯¯çš„æŠ¥å‘Šglibcçš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä»–ä»¬æä¾›äº†ä¸€ä¸ª__libc_freeres()ä¾‹ç¨‹ç‰¹åˆ«ç”¨æ¥è®©glibcé‡Šæ”¾åˆ†é…çš„æ‰€æœ‰å†…å­˜ã€‚å› æ­¤Memcheckåœ¨é€€å‡ºæ—¶å°è¯•ç€å»è¿è¡Œ__libc_freeres()ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåœ¨glibcçš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œ__libc_freeresæ˜¯æœ‰bugä¼šå¯¼è‡´æ®µé”™è¯¯çš„ã€‚è¿™åœ¨Red Hat 7.1ä¸Šæœ‰ç‰¹åˆ«å£°æ˜ã€‚æ‰€ä»¥ï¼Œæä¾›è¿™ä¸ªé€‰é¡¹æ¥å†³å®šæ˜¯å¦è¿è¡Œ__libc_freeresã€‚å¦‚æœä½ çš„ç¨‹åºçœ‹èµ·æ¥åœ¨Valgrindä¸Šè¿è¡Œå¾—å¾ˆå¥½ï¼Œä½†æ˜¯åœ¨é€€å‡ºæ—¶å‘ç”Ÿæ®µé”™è¯¯ï¼Œä½ å¯èƒ½éœ€è¦æŒ‡å®š&ndash;run-libc-freeres=noæ¥ä¿®æ­£ï¼Œè¿™å°†å¯èƒ½é”™è¯¯çš„æŠ¥å‘Šlibc.soçš„å†…å­˜æ³„æ¼ã€‚</p>
<p>&ndash;sim-hints=hint1,hint2,&hellip;</p>
<p>ä¼ é€’æ‚å‡‘çš„æç¤ºç»™Valgrindï¼Œè½»å¾®çš„ä¿®æ”¹æ¨¡æ‹Ÿè¡Œä¸ºçš„éæ ‡å‡†æˆ–å±é™©æ–¹å¼ï¼Œå¯èƒ½æœ‰åŠ©äºæ¨¡æ‹Ÿå¥‡æ€ªçš„ç‰¹æ€§ã€‚é»˜è®¤æ²¡æœ‰æç¤ºæ‰“å¼€ã€‚å°å¿ƒä½¿ç”¨ï¼ç›®å‰å·²çŸ¥çš„æç¤ºæœ‰ï¼š</p>
<p>l lax-ioctls: å¯¹ioctlçš„å¤„ç†éå¸¸ä¸ä¸¥æ ¼ï¼Œå”¯ä¸€çš„å‡å®šæ˜¯å¤§å°æ˜¯æ­£ç¡®çš„ã€‚ä¸éœ€è¦åœ¨å†™æ—¶ç¼“å†²åŒºå®Œå…¨çš„åˆå§‹åŒ–ã€‚æ²¡æœ‰è¿™ä¸ªï¼Œç”¨å¤§é‡çš„å¥‡æ€ªçš„ioctlå‘½ä»¤æ¥ä½¿ç”¨ä¸€äº›è®¾å¤‡é©±åŠ¨å°†ä¼šéå¸¸çƒ¦äººã€‚</p>
<p>l enable-inner:æ‰“å¼€æŸäº›ç‰¹æ®Šçš„æ•ˆæœï¼Œå½“è¿è¡Œçš„ç¨‹åºæ˜¯Valgrindè‡ªèº«æ—¶ã€‚</p>
<p>&ndash;kernel-variant=variant1,variant2,&hellip;</p>
<p>å¤„ç†ç³»ç»Ÿè°ƒç”¨å’Œioctlsåœ¨è¿™ä¸ªå¹³å°çš„é»˜è®¤æ ¸å¿ƒä¸Šäº§ç”Ÿä¸åŒçš„å˜é‡ã€‚è¿™æœ‰åŠ©äºè¿è¡Œåœ¨æ”¹è¿›è¿‡çš„å†…æ ¸æˆ–è€…æ”¯æŒéæ ‡å‡†çš„ioctlsä¸Šã€‚å°å¿ƒä½¿ç”¨ã€‚å¦‚æœä½ ä¸ç†è§£è¿™ä¸ªé€‰é¡¹åšçš„æ˜¯ä»€ä¹ˆé‚£ä½ å‡ ä¹ä¸éœ€è¦å®ƒã€‚å·²ç»çŸ¥é“çš„å˜é‡æœ‰ï¼š</p>
<p>l bproc: æ”¯æŒX86å¹³å°ä¸Šçš„sys_brocç³»ç»Ÿè°ƒç”¨ã€‚è¿™æ˜¯ä¸ºäº†è¿è¡Œåœ¨BProcï¼Œå®ƒæ˜¯æ ‡å‡†Linuxçš„ä¸€ä¸ªå˜ç§ï¼Œæœ‰æ—¶ç”¨æ¥æ„å»ºé›†ç¾¤ã€‚</p>
<p>&ndash;show-emwarns=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼ŒValgrindåœ¨ä¸€äº›ç‰¹å®šçš„æƒ…å†µä¸‹å°†å¯¹CPUä»¿çœŸäº§ç”Ÿè­¦å‘Šã€‚é€šå¸¸è¿™äº›éƒ½æ˜¯ä¸å¼•äººæ³¨æ„çš„ã€‚</p>
<p>&ndash;smc-check=&lt;none|stack|all&gt; [default: stack]</p>
<p>è¿™ä¸ªé€‰é¡¹æ§åˆ¶Valgrindå¯¹è‡ªæˆ‘ä¿®æ”¹çš„ä»£ç çš„æ£€æµ‹ã€‚Valgrindå¯ä»¥ä¸åšæ£€æµ‹ï¼Œå¯ä»¥æ£€æµ‹æ ˆä¸­è‡ªæˆ‘ä¿®æ”¹çš„ä»£ç ï¼Œæˆ–è€…ä»»æ„åœ°æ–¹æ£€æµ‹è‡ªæˆ‘ä¿®æ”¹çš„ä»£ç ã€‚æ³¨æ„é»˜è®¤é€‰é¡¹æ˜¯æ•æ‰ç»å¤§å¤šæ•°æƒ…å†µï¼Œåˆ°ç›®å‰æˆ‘ä»¬äº†è§£çš„æƒ…å†µä¸ºæ­¢ã€‚ä½¿ç”¨allé€‰é¡¹æ—¶ä¼šæå¤§çš„é™ä½é€Ÿåº¦ã€‚(ä½†æ˜¯ç”¨noneé€‰é¡¹è¿è¡Œæå°‘å½±å“é€Ÿåº¦ï¼Œå› ä¸ºå¯¹å¤§å¤šæ•°ç¨‹åºï¼Œéå¸¸å°‘çš„ä»£ç è¢«æ·»åŠ åˆ°æ ˆä¸­)</p>
<h3 id="è°ƒè¯•valgrindé€‰é¡¹">è°ƒè¯•VALGRINDé€‰é¡¹ï¼š</h3>
<p>è¿˜æœ‰ä¸€äº›é€‰é¡¹æ˜¯ç”¨æ¥è°ƒè¯•Valgrindè‡ªèº«çš„ã€‚åœ¨è¿è¡Œä¸€èˆ¬çš„ä¸œè¥¿æ—¶ä¸åº”è¯¥éœ€è¦çš„ã€‚å¦‚æœä½ å¸Œæœ›çœ‹åˆ°é€‰é¡¹åˆ—è¡¨ï¼Œä½¿ç”¨&ndash;help-debugé€‰é¡¹ã€‚</p>
<p>å†…å­˜æ£€æŸ¥é€‰é¡¹ï¼š</p>
<p>&ndash;leak-check=&lt;no|summary|yes|full&gt; [default: summary]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œå½“å®¢æˆ·ç¨‹åºç»“æŸæ—¶æŸ¥æ‰¾å†…å­˜æ³„æ¼ã€‚å†…å­˜æ³„æ¼æ„å‘³ç€æœ‰ç”¨mallocåˆ†é…å†…å­˜å—ï¼Œä½†æ˜¯æ²¡æœ‰ç”¨freeé‡Šæ”¾ï¼Œè€Œä¸”æ²¡æœ‰æŒ‡é’ˆæŒ‡å‘è¿™å—å†…å­˜ã€‚è¿™æ ·çš„å†…å­˜å—æ°¸è¿œä¸èƒ½è¢«ç¨‹åºé‡Šæ”¾ï¼Œå› ä¸ºæ²¡æœ‰æŒ‡é’ˆæŒ‡å‘å®ƒä»¬ã€‚å¦‚æœè®¾ç½®ä¸ºsummaryï¼ŒValgrindä¼šæŠ¥å‘Šæœ‰å¤šå°‘å†…å­˜æ³„æ¼å‘ç”Ÿäº†ã€‚å¦‚æœè®¾ç½®ä¸ºfullæˆ–yesï¼ŒValgrindç»™å‡ºæ¯ä¸€ä¸ªç‹¬ç«‹çš„æ³„æ¼çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<p>&ndash;show-reachable=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹å…³é—­æ—¶ï¼Œå†…å­˜æ³„æ¼æ£€æµ‹å™¨åªæ˜¾ç¤ºæ²¡æœ‰æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ï¼Œæˆ–è€…åªèƒ½æ‰¾åˆ°æŒ‡å‘å—ä¸­é—´çš„æŒ‡é’ˆã€‚å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œå†…å­˜æ³„æ¼æ£€æµ‹å™¨è¿˜æŠ¥å‘Šæœ‰æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ã€‚è¿™äº›å—æ˜¯æœ€æœ‰å¯èƒ½å‡ºç°å†…å­˜æ³„æ¼çš„åœ°æ–¹ã€‚ä½ çš„ç¨‹åºå¯èƒ½ï¼Œè‡³å°‘åœ¨åŸåˆ™ä¸Šï¼Œåº”è¯¥åœ¨é€€å‡ºå‰é‡Šæ”¾è¿™äº›å†…å­˜å—ã€‚è¿™äº›æœ‰æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—å’Œæ²¡æœ‰æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜å—ï¼Œæˆ–è€…åªæœ‰å†…éƒ¨æŒ‡é’ˆæŒ‡å‘çš„å—ï¼Œéƒ½å¯èƒ½äº§ç”Ÿå†…å­˜æ³„æ¼ï¼Œå› ä¸ºå®é™…ä¸Šæ²¡æœ‰ä¸€ä¸ªæŒ‡å‘å—èµ·å§‹çš„æŒ‡é’ˆå¯ä»¥æ‹¿æ¥é‡Šæ”¾ï¼Œå³ä½¿ä½ æƒ³å»é‡Šæ”¾å®ƒã€‚</p>
<p>&ndash;leak-resolution=&lt;low|med|high&gt; [default: low]</p>
<p>åœ¨åšå†…å­˜æ³„æ¼æ£€æŸ¥æ—¶ï¼Œç¡®å®šmemcheckå°†æ€ä¹ˆæ ·è€ƒè™‘ä¸åŒçš„æ ˆæ˜¯ç›¸åŒçš„æƒ…å†µã€‚å½“è®¾ç½®ä¸ºlowæ—¶ï¼Œåªéœ€è¦å‰ä¸¤å±‚æ ˆåŒ¹é…å°±è®¤ä¸ºæ˜¯ç›¸åŒçš„æƒ…å†µï¼›å½“è®¾ç½®ä¸ºmedï¼Œå¿…é¡»è¦å››å±‚æ ˆåŒ¹é…ï¼Œå½“è®¾ç½®ä¸ºhighæ—¶ï¼Œæ‰€æœ‰å±‚æ¬¡çš„æ ˆéƒ½å¿…é¡»åŒ¹é…ã€‚å¯¹äºhardcoreå†…å­˜æ³„æ¼æ£€æŸ¥ï¼Œä½ å¾ˆå¯èƒ½éœ€è¦ä½¿ç”¨&ndash;leak-resolution=highå’Œ&ndash;num-callers=40æˆ–è€…æ›´å¤§çš„æ•°å­—ã€‚æ³¨æ„è¿™å°†äº§ç”Ÿå·¨é‡çš„ä¿¡æ¯ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé»˜è®¤é€‰é¡¹æ˜¯å››ä¸ªè°ƒç”¨è€…åŒ¹é…å’Œä½åˆ†è¾¨ç‡çš„åŒ¹é…ã€‚æ³¨æ„&ndash;leak-resolution= è®¾ç½®å¹¶ä¸å½±å“memcheckæŸ¥æ‰¾å†…å­˜æ³„æ¼çš„èƒ½åŠ›ã€‚å®ƒåªæ˜¯æ”¹å˜äº†ç»“æœå¦‚ä½•è¾“å‡ºã€‚</p>
<p>&ndash;freelist-vol=<number> [default: 5000000]</p>
<p>å½“å®¢æˆ·ç¨‹åºä½¿ç”¨free(Cä¸­)æˆ–è€…delete(C++)é‡Šæ”¾å†…å­˜æ—¶ï¼Œè¿™äº›å†…å­˜å¹¶ä¸æ˜¯é©¬ä¸Šå°±å¯ä»¥ç”¨æ¥å†åˆ†é…çš„ã€‚è¿™äº›å†…å­˜å°†è¢«æ ‡è®°ä¸ºä¸å¯è®¿é—®çš„ï¼Œå¹¶è¢«æ”¾åˆ°ä¸€ä¸ªå·²é‡Šæ”¾å†…å­˜çš„é˜Ÿåˆ—ä¸­ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œä½¿é‡Šæ”¾çš„å†…å­˜å†æ¬¡è¢«åˆ©ç”¨çš„ç‚¹å°½å¯èƒ½çš„æ™šã€‚è¿™æœ‰åˆ©äºmemcheckåœ¨å†…å­˜å—é‡Šæ”¾åè¿™æ®µé‡è¦çš„æ—¶é—´æ£€æŸ¥å¯¹å—ä¸åˆæ³•çš„è®¿é—®ã€‚è¿™ä¸ªé€‰é¡¹æŒ‡å®šäº†é˜Ÿåˆ—æ‰€èƒ½å®¹çº³çš„å†…å­˜æ€»å®¹é‡ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚é»˜è®¤çš„å€¼æ˜¯5000000å­—èŠ‚ã€‚å¢å¤§è¿™ä¸ªæ•°ç›®ä¼šå¢åŠ memcheckä½¿ç”¨çš„å†…å­˜ï¼Œä½†åŒæ—¶ä¹Ÿå¢åŠ äº†å¯¹å·²é‡Šæ”¾å†…å­˜çš„éæ³•ä½¿ç”¨çš„æ£€æµ‹æ¦‚ç‡ã€‚</p>
<p>&ndash;workaround-gcc296-bugs=&lt;yes|no&gt; [default: no]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œå‡å®šè¯»å†™æ ˆæŒ‡é’ˆä»¥ä¸‹çš„ä¸€å°æ®µè·ç¦»æ˜¯gcc 2.96çš„bugï¼Œå¹¶ä¸”ä¸æŠ¥å‘Šä¸ºé”™è¯¯ã€‚è·ç¦»é»˜è®¤ä¸º256å­—èŠ‚ã€‚æ³¨æ„gcc 2.96æ˜¯ä¸€äº›æ¯”è¾ƒè€çš„Linuxå‘è¡Œç‰ˆ(RedHat 7.X)çš„é»˜è®¤ç¼–è¯‘å™¨ï¼Œæ‰€ä»¥ä½ å¯èƒ½éœ€è¦ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚å¦‚æœä¸æ˜¯å¿…è¦è¯·ä¸è¦ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒå¯èƒ½ä¼šä½¿ä¸€äº›çœŸæ­£çš„é”™è¯¯æºœæ‰ã€‚ä¸€ä¸ªæ›´å¥½çš„è§£å†³åŠæ³•æ˜¯ä½¿ç”¨è¾ƒæ–°çš„ï¼Œä¿®æ­£äº†è¿™ä¸ªbugçš„gcc/g++ç‰ˆæœ¬ã€‚</p>
<p>&ndash;partial-loads-ok=&lt;yes|no&gt; [default: no]</p>
<p>æ§åˆ¶memcheckå¦‚ä½•å¤„ç†ä»åœ°å€è¯»å–æ—¶å­—é•¿åº¦ï¼Œå­—å¯¹é½ï¼Œå› æ­¤å“ªäº›å­—èŠ‚æ˜¯å¯ä»¥å¯»å€çš„ï¼Œå“ªäº›æ˜¯ä¸å¯ä»¥å¯»å€çš„ã€‚å½“è®¾ç½®ä¸ºyesæ˜¯ï¼Œè¿™æ ·çš„è¯»å–å¹¶ä¸æŠ›å‡ºä¸€ä¸ªå¯»å€é”™è¯¯ã€‚è€Œæ˜¯ä»éæ³•åœ°å€è¯»å–çš„Vå­—èŠ‚æ˜¾ç¤ºä¸ºæœªå®šä¹‰ï¼Œè®¿é—®åˆæ³•åœ°å€ä»ç„¶æ˜¯åƒå¹³å¸¸ä¸€æ ·æ˜ å°„åˆ°å†…å­˜ã€‚è®¾ç½®ä¸ºnoæ—¶ï¼Œä»éƒ¨åˆ†é”™è¯¯çš„åœ°å€è¯»å–ä¸ä»å®Œå…¨é”™è¯¯çš„åœ°å€è¯»å–åŒæ ·å¤„ç†ï¼šæŠ›å‡ºä¸€ä¸ªéæ³•åœ°å€é”™è¯¯ï¼Œç»“æœçš„Vå­—èŠ‚æ˜¾ç¤ºä¸ºåˆæ³•æ•°æ®ã€‚æ³¨æ„è¿™ç§ä»£ç è¡Œä¸ºæ˜¯è¿èƒŒISO C/C++æ ‡å‡†ï¼Œåº”è¯¥è¢«è®¤ä¸ºæ˜¯æœ‰é—®é¢˜çš„ã€‚å¦‚æœå¯èƒ½ï¼Œè¿™ç§ä»£ç åº”è¯¥ä¿®æ­£ã€‚è¿™ä¸ªé€‰é¡¹åº”è¯¥åªæ˜¯åšä¸ºä¸€ä¸ªæœ€åè€ƒè™‘çš„æ–¹æ³•ã€‚</p>
<p>&ndash;undef-value-errors=&lt;yes|no&gt; [default: yes]</p>
<p>æ§åˆ¶memcheckæ˜¯å¦æ£€æŸ¥æœªå®šä¹‰å€¼çš„å±é™©ä½¿ç”¨ã€‚å½“è®¾ä¸ºyesæ—¶ï¼ŒMemcheckçš„è¡Œä¸ºåƒAddrcheck, ä¸€ä¸ªè½»é‡çº§çš„å†…å­˜æ£€æŸ¥å·¥å…·ï¼Œæ˜¯Valgrindçš„ä¸€ä¸ªéƒ¨åˆ†ï¼Œå®ƒå¹¶ä¸æ£€æŸ¥æœªå®šä¹‰å€¼çš„é”™è¯¯ã€‚ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œå¦‚æœä½ ä¸å¸Œæœ›çœ‹åˆ°æœªå®šä¹‰å€¼é”™è¯¯ã€‚</p>
<h3 id="cachegrindé€‰é¡¹">CACHEGRINDé€‰é¡¹ï¼š</h3>
<p>æ‰‹åŠ¨æŒ‡å®šI1/D1/L2ç¼“å†²é…ç½®ï¼Œå¤§å°æ˜¯ç”¨å­—èŠ‚è¡¨ç¤ºçš„ã€‚è¿™ä¸‰ä¸ªå¿…é¡»ç”¨é€—å·éš”å¼€ï¼Œä¸­é—´æ²¡æœ‰ç©ºæ ¼ï¼Œä¾‹å¦‚ï¼š valgrind &ndash;tool=cachegrind &ndash;I1=65535,2,64ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªï¼Œä¸¤ä¸ªæˆ–ä¸‰ä¸ªI1/D1/L2ç¼“å†²ã€‚å¦‚æœæ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šï¼Œæ¯ä¸ªçº§åˆ«ä½¿ç”¨æ™®é€šæ–¹å¼(é€šè¿‡CPUIDæŒ‡ä»¤å¾—åˆ°ç¼“å†²é…ç½®ï¼Œå¦‚æœå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼)å¾—åˆ°çš„é…ç½®ã€‚</p>
<p>&ndash;I1=<size>,<associativity>,<line size></p>
<p>æŒ‡å®šç¬¬ä¸€çº§æŒ‡ä»¤ç¼“å†²çš„å¤§å°ï¼Œå…³è”åº¦å’Œè¡Œå¤§å°ã€‚</p>
<p>&ndash;D1=<size>,<associativity>,<line size></p>
<p>æŒ‡å®šç¬¬ä¸€çº§æ•°æ®ç¼“å†²çš„å¤§å°ï¼Œå…³è”åº¦å’Œè¡Œå¤§å°ã€‚</p>
<p>&ndash;L2=<size>,<associativity>,<line size></p>
<p>æŒ‡å®šç¬¬äºŒçº§ç¼“å†²çš„å¤§å°ï¼Œå…³è”åº¦å’Œè¡Œå¤§å°ã€‚</p>
<p>CALLGRINDé€‰é¡¹ï¼š</p>
<p>&ndash;heap=&lt;yes|no&gt; [default: yes]</p>
<p>å½“è¿™ä¸ªé€‰é¡¹æ‰“å¼€æ—¶ï¼Œè¯¦ç»†çš„è¿½è¸ªå †çš„ä½¿ç”¨æƒ…å†µã€‚å…³é—­è¿™ä¸ªé€‰é¡¹æ—¶ï¼Œmassif.pid.txtæˆ–massif.pid.htmlå°†ä¼šéå¸¸çš„ç®€çŸ­ã€‚</p>
<p>&ndash;heap-admin=<number> [default: 8]</p>
<p>æ¯ä¸ªå—ä½¿ç”¨çš„ç®¡ç†å­—èŠ‚æ•°ã€‚è¿™åªèƒ½ä½¿ç”¨ä¸€ä¸ªå¹³å‡çš„ä¼°è®¡å€¼ï¼Œå› ä¸ºå®ƒå¯èƒ½å˜åŒ–ã€‚glibcä½¿ç”¨çš„åˆ†é…å™¨æ¯å—éœ€è¦4~15å­—èŠ‚ï¼Œä¾èµ–äºå„æ–¹é¢çš„å› ç´ ã€‚ç®¡ç†å·²ç»é‡Šæ”¾çš„å—ä¹Ÿéœ€è¦ç©ºé—´ï¼Œå°½ç®¡massifä¸è®¡ç®—è¿™äº›ã€‚</p>
<p>&ndash;stacks=&lt;yes|no&gt; [default: yes]</p>
<p>å½“æ‰“å¼€æ—¶ï¼Œåœ¨å‰–æä¿¡æ¯ä¸­åŒ…å«æ ˆä¿¡æ¯ã€‚å¤šçº¿ç¨‹çš„ç¨‹åºå¯èƒ½æœ‰å¤šä¸ªæ ˆã€‚</p>
<p>&ndash;depth=<number> [default: 3]</p>
<p>è¯¦ç»†çš„å †ä¿¡æ¯ä¸­è°ƒç”¨è¿‡ç¨‹çš„æ·±åº¦ã€‚å¢åŠ è¿™ä¸ªå€¼å¯ä»¥ç»™å‡ºæ›´å¤šçš„ä¿¡æ¯ï¼Œä½†æ˜¯massifä¼šæ›´ä½¿è¿™ä¸ªç¨‹åºè¿è¡Œå¾—æ…¢ï¼Œä½¿ç”¨æ›´å¤šçš„å†…å­˜ï¼Œå¹¶ä¸”äº§ç”Ÿä¸€ä¸ªå¤§çš„massif.pid.txtæˆ–è€…massif.pid.hpæ–‡ä»¶ã€‚</p>
<p>&ndash;alloc-fn=<name></p>
<p>æŒ‡å®šä¸€ä¸ªåˆ†é…å†…å­˜çš„å‡½æ•°ã€‚è¿™å¯¹äºä½¿ç”¨malloc()çš„åŒ…è£…å‡½æ•°æ˜¯æœ‰ç”¨çš„ï¼Œå¯ä»¥ç”¨å®ƒæ¥å¡«å……åŸæ¥æ— æ•ˆçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚(è¿™äº›å‡½æ•°ä¼šç»™å‡ºæ— ç”¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¹¶åœ¨å›¾ä¸­ç»™å‡ºæ— æ„ä¹‰çš„åŒºåŸŸ)ã€‚æŒ‡å®šçš„å‡½æ•°åœ¨ä¸Šä¸‹æ–‡ä¸­è¢«å¿½ç•¥ï¼Œä¾‹å¦‚ï¼Œåƒå¯¹malloc()ä¸€æ ·å¤„ç†ã€‚è¿™ä¸ªé€‰é¡¹å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é‡å¤å¤šæ¬¡ï¼ŒæŒ‡å®šå¤šä¸ªå‡½æ•°ã€‚</p>
<p>&ndash;format=&lt;text|html&gt; [default: text]</p>
<p>äº§ç”Ÿtextæˆ–è€…HTMLæ ¼å¼çš„è¯¦ç»†å †ä¿¡æ¯ï¼Œæ–‡ä»¶çš„åç¼€åä½¿ç”¨.txtæˆ–è€….htmlã€‚</p>
<h3 id="helgrindé€‰é¡¹">HELGRINDé€‰é¡¹ï¼š</h3>
<p>&ndash;private-stacks=&lt;yes|no&gt; [default: no]</p>
<p>å‡å®šçº¿ç¨‹æ ˆæ˜¯ç§æœ‰çš„ã€‚</p>
<p>&ndash;show-last-access=&lt;yes|some|no&gt; [default: no]</p>
<p>æ˜¾ç¤ºæœ€åä¸€æ¬¡å­—è®¿é—®å‡ºé”™çš„ä½ç½®ã€‚</p>
<h3 id="lackeyé€‰é¡¹">LACKEYé€‰é¡¹ï¼š</h3>
<p>&ndash;fnname=<name> [default: _dl_runtime_resolve()]</p>
<p>å¯¹<name>å‡½æ•°è®¡æ•°ã€‚</p>
<p>&ndash;detailed-counts=&lt;no|yes&gt; [default: no]</p>
<p>å¯¹è¯»å–ï¼Œå­˜å‚¨å’Œaluæ“ä½œè®¡æ•°ã€‚</p>

</main>

<style>
    

    

    body {
        margin-right: 280px;
    }

    @media (max-width: 768px) {
        body {
            margin-right: 0;
        }
    }

    

     
    .article-meta {
        text-align: center;
        text-decoration: none;
        background: #efefef;
        padding: 1px;
        border-radius: 5px;
    }

    .article-meta-title {
        font-size: 2.2rem;
    }

    .article-meta-info {
        color: #666;
        font-size: 1.1rem;
        margin: -0.6rem 0 0.2rem 10px;
        text-align: left;
    }

    .article-meta-info a {
        color: inherit;
        text-decoration: none;
        transition: color 0.3s ease;
    }
</style>



<h1 style="font-size: 1.2rem; margin: 2.5rem 0 0.1rem 0;">Comment</h1>
<div class="cusdis-comments">
  <div id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id=697d528d-b618-4ee1-a6fe-403c81a646ac
    data-page-id="afc3fdab8277454a7451ce607a7cefbb"
    data-page-url="https://kaikaixixi.xyz/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/valgrind%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"
    data-page-title="Valgrindå¿«é€Ÿä¸Šæ‰‹"
  ></div>
  <script async defer src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/cusdis/cusdis.es.min.js"></script>
</div>

<style>
.cusdis-comments {
  border-top: 2px dashed #cfcfcf;
  padding-top: 1.3rem;
}

#cusdis_thread iframe {
  min-height: 500px !important;
  overflow: visible !important;
}
</style>


<footer>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/auto-render.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/math-code.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/render-katex.min.js"></script>

  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/center-img.min.js"></script>

  

<div id="menuBtnContainer">
    
    <button id="menuBtn"><i class="fa-solid fa-screwdriver-wrench"></i></button>

    
    <button id="backToBottomBtn" class="menu-popup-btn top-btn"><i class="fa-solid fa-square-caret-down"></i></button>
    <button id="backToTopBtn" class="menu-popup-btn top-btn"><i class="fa-solid fa-square-caret-up"></i></button>

    
    <div class="menu-popup-btn edit-btn">
        <a href='https://github.com/captainwc/captainwc.github.io/edit/main/content/%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8/Valgrind%e5%bf%ab%e9%80%9f%e4%b8%8a%e6%89%8b.md'
            target="_blank" rel="noopener">
            <i class="fa-solid fa-square-pen"></i>
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var menuBtn = document.getElementById('menuBtn');
        var menuBtnContainer = document.getElementById('menuBtnContainer');
        var backToTopBtn = document.getElementById('backToTopBtn');
        var backToBottomBtn = document.getElementById('backToBottomBtn');
        var popupBtns = document.querySelectorAll('.menu-popup-btn');
        var hoverTimeout;

        
        menuBtnContainer.classList.add('visible');

        
        function showPopupBtns() {
            clearTimeout(hoverTimeout);
            menuBtnContainer.classList.add('active');
        }

        
        function hidePopupBtns() {
            hoverTimeout = setTimeout(function() {
                menuBtnContainer.classList.remove('active');
            }, 300);
        }

        
        menuBtnContainer.addEventListener('mouseenter', showPopupBtns);
        menuBtnContainer.addEventListener('mouseleave', hidePopupBtns);

        
        menuBtn.addEventListener('click', function() {
            if (menuBtnContainer.classList.contains('active')) {
                menuBtnContainer.classList.remove('active');
            } else {
                showPopupBtns();
            }
        });

        
        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        
        backToBottomBtn.addEventListener('click', function() {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth'
            });
        });
    });
</script>

<style>
     
    #menuBtnContainer {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 999;
        opacity: 0.6;
        visibility: visible;
        transition: opacity 0.3s;
    }

    #menuBtnContainer:hover {
        opacity: 1;
    }

     
    #menuBtn {
        border-radius: 8px;
        border: none;
        color: #aaa;
        font-family: "Maple Mono NF CN";
        font-size: 1.2rem;
        transition: background 0.3s;
        cursor: pointer;
        background: #EFEFEF;
        z-index: 1000;
        position: relative;
    }

    #menuBtn:hover {
        background: #BEC2B3;
        color: #666;
    }

     
    .menu-popup-btn {
        position: absolute;
        opacity: 0;
        visibility: hidden;
        border-radius: 8px;
        border: none;
        color: #aaa;
        font-family: "Maple Mono NF CN";
        font-size: 1.3rem;
        transition: all 0.3s ease;
        background: #EFEFEF;
        cursor: pointer;
        z-index: 999;
    }

     
    .menu-popup-btn.top-btn {
        right: 0;
        transform: translateY(0) scale(0.8);
    }

     
    .menu-popup-btn.edit-btn {
        bottom: 0;
        transform: translateX(0) scale(0.8);
        padding: 1px 6.6px 0px 6.6px;
    }

    .menu-popup-btn.edit-btn a {
        color: #ccc;
        text-decoration: none;
        background: none !important;
        transition: opacity 0.2s;
        padding: 0;
        margin: 0;
    }

     
    #menuBtnContainer.active .menu-popup-btn {
        opacity: 1;
        visibility: visible;
    }

     
    #menuBtnContainer.active #backToBottomBtn {
        transform: translateY(-60px) scale(1);
    }

     
    #menuBtnContainer.active #backToTopBtn {
        transform: translateY(-110px) scale(1);
    }

     
    #menuBtnContainer.active .edit-btn {
        transform: translateX(-60px) scale(1);
    }

     
    .menu-popup-btn:hover,
    .menu-popup-btn.edit-btn:hover {
        background: #BEC2B3;
        color: #666;
    }

    .menu-popup-btn.edit-btn:hover a {
        color: #666;
    }

     
    @media (max-width: 768px) {
        #menuBtnContainer {
            right: 15px;
            bottom: 15px;
        }

        #menuBtnContainer.active #backToBottomBtn {
            transform: translateY(-50px) scale(1);
        }

        #menuBtnContainer.active #backToTopBtn {
            transform: translateY(-90px) scale(1);
        }

        #menuBtnContainer.active .edit-btn {
            transform: translateX(-50px) scale(1);
        }
    }
</style>



  <script>
  document.addEventListener('DOMContentLoaded', function() {
    
    document.querySelectorAll('ul').forEach(ul => {
      
      const isTodoList = Array.from(ul.children).some(li => {
        return li.innerHTML.includes('type="checkbox"')
      });

      if (isTodoList) {
        
        const todolistContainer = document.createElement('div');
        todolistContainer.className = 'todolist';

        

        
        ul.querySelectorAll('li').forEach(li => {
          const todoItemDiv = document.createElement('div');
          todoItemDiv.className = 'todo-item';

          
          const isChecked = li.innerHTML.includes('checked');
          const content = li.innerHTML
            .replace(/<input[^>]+>/g, '') 
            .trim();

          
          const checkedIcon = `<svg t="1742522457277" class="todo-item-checked-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12342"><path d="M512 938.688A426.624 426.624 0 1 1 512 85.376a426.624 426.624 0 0 1 0 853.312z m0-85.312A341.312 341.312 0 1 0 512 170.688a341.312 341.312 0 0 0 0 682.688z m-42.56-170.688L288.448 501.632l60.288-60.288L469.44 561.92l241.28-241.28 60.416 60.288-301.696 301.696z" p-id="12343"></path></svg>`;
          const uncheckedIcon = `<svg t="1742522354856" class="todo-item-unchecked-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11882"><path d="M512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z m0-85.333334a341.333333 341.333333 0 1 0 0-682.709333A341.333333 341.333333 0 0 0 512 853.333333z" p-id="11883"></path></svg>`;

          
          todoItemDiv.innerHTML = `
            <span class="todo-item-checkbox">
              ${isChecked ? checkedIcon : uncheckedIcon}
            </span>
            <span class="todo-item-content">
              ${isChecked ? `<del>${content}</del>` : content}
            </span>
          `;

          
          todolistContainer.appendChild(todoItemDiv);
        });

        
        ul.parentNode.replaceChild(todolistContainer, ul);
      }
    });

    function addTaskProgressBar(ul, todolistContainer) {
      
      const totalTasks = ul.children.length;
      const finishedTasks = Array.from(ul.children).filter(li => li.innerHTML.includes('checked')).length;

      
      const progressContainer = document.createElement('div');
      progressContainer.className = 'todo-progress';

      
      const counterSpan = document.createElement('span');
      counterSpan.className = 'todo-progress-counter';
      counterSpan.textContent = `${finishedTasks}/${totalTasks}`;

      
      const progressTrack = document.createElement('div');
      progressTrack.className = 'todo-progress-bar';

      
      const progressFill = document.createElement('div');
      progressFill.className = 'todo-progress-bar-fill';
      progressFill.style.width = `${(finishedTasks / totalTasks) * 100}%`;

      
      const flagSpan = document.createElement('span');
      flagSpan.className = 'todo-progress-flag';
      flagSpan.innerHTML = `${finishedTasks === totalTasks ? 'ğŸŒŸ' : 'ğŸš§'}`;

      
      progressTrack.appendChild(progressFill);
      progressContainer.append(flagSpan, progressTrack, counterSpan);
      todolistContainer.appendChild(progressContainer);
    }
  });
</script>

<style>
   
  .todolist {
    padding-left: 0.6rem;
  }

  .todo-item {
    padding: 0.2rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    margin: -0.5rem 0 -0.5rem -0.7rem;
    line-height: 1.3;
  }

  .todo-item-checkbox {
    flex-shrink: 0;
    font-size: 1.2em;

    svg {
      margin-top: 0.46rem;
      width: 16px !important;
      height: 16px !important;
    }
  }

  .todo-item-checked-icon {
    fill: #707070;
  }

  .todo-item-unchecked-icon {
    fill: #1A61CC;
  }

  .todo-item-unchecked-icon:hover {
    fill: red;
    width: 20px !important;
    height: 20px !important;
  }

  .todo-item-content {
    flex: 1;
    word-break: break-all;

    p {
      margin: 0;
      padding: 0;
    }
  }

   
  .todo-progress {
    display: flex;
     
    align-items: center;
    gap: 0.3rem;
     
    margin: 0.1rem 0 0 0.7rem;
  }

  .todo-progress-counter {
     
    font-family: "LXGW WenKai";
    font-size: 0.8rem;
    color: #707070;
  }

  .todo-progress-bar {
    flex: 1;
    height: 2px;
    background: #a64036;
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    max-width: 20%;
  }

  .todo-progress-bar-fill {
    height: 100%;
    background: #84a729;
    transition: width 0.3s ease;
  }

  .todo-progress-flag {
    display: none;
    position: relative;
    font-size: 0.9rem;
  }
</style>


  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/highlight/highlight.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', () => hljs.highlightAll())</script>



  <script>
    const langToNerdFontMap = {
        asm: '\ue6ab',
        bash: '\ue760',
        bazel: '\ue63a',
        c: '\ue61e',
        cmake: '\ue794',
        cmd: '\uebc4',
        cpp: '\ue61d',
        'c++': '\ue61d',
        csharp: '\ue7b2',
        css: '\ue749',
        diff: '\ueae1',
        dockerfile: '\uf21f',
        go: '\udb81\udfd3',
        gradle: '\ue7f2',
        html: '\ue736',
        java: '\uedaf',
        javascript: '\ue781',
        json: '\ueb0f',
        latex: '\ue81f',
        llvm: '\ue823',
        lua: '\ue826',
        makefile: '\ue673',
        markdown: '\uf48a',
        maven: '\ue82c',
        plaintext: '\udb80\udd4d',
        plantuml: '\ue8cb',
        powershell: '\ue86c',
        python: '\ued1b',
        rust: '\udb85\ude17',
        shell: '\ue760',
        sql: '\udb82\udc66',
        text: '\udb80\udd4d',
        toml: '\ue6b2',
        txt: '\udb80\udd4d',
        typescript: '\ue8ca',
        uml: '\ue8cb',
        vim: '\ue7c5',
        wasm: '\ue8e0',
        xml: '\ue8ea',
        yaml: '\ue8eb',
    };

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('pre > code').forEach(codeBlock => {
            const parentElement = codeBlock.parentElement;

            
            const tools = document.createElement('div');
            tools.className = 'code-tools';

            
            const foldBtn = document.createElement('button');
            foldBtn.className = 'fold-btn';
            foldBtn.innerHTML = '\uf48c';
            foldBtn.style.display = 'none';

            
            const langLabel = document.createElement('div');
            langLabel.className = 'lang-label';
            const lang = [...codeBlock.classList].find(c => c.startsWith('language-'))?.split('-')[1] || 'text';
            const icon = langToNerdFontMap[lang.toLowerCase()];
            langLabel.textContent = icon || lang.toUpperCase();
            if (!icon) langLabel.style.fontSize = '0.8rem';

            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.textContent = '\uf4bb COPY';

            
            const scale_height = 600;       
            const collapsed_height = 500;   
            const checkHeight = () => {
                const originalDisplay = parentElement.style.display;
                parentElement.style.display = 'block';
                const fullHeight = parentElement.scrollHeight;
                parentElement.style.display = originalDisplay;
                return fullHeight > scale_height;
            };

            
            if (checkHeight()) {
                foldBtn.style.display = 'flex';
                parentElement.dataset.fullHeight = `${parentElement.scrollHeight}px`;

                
                parentElement.classList.add('collapsed');
                parentElement.style.maxHeight = `${collapsed_height}px`;
                foldBtn.innerHTML = '\uf4d9';

                parentElement.style.overflowY = 'auto'; 

                foldBtn.addEventListener('click', () => {
                    const isCollapsed = parentElement.classList.toggle('collapsed');
                    foldBtn.innerHTML = isCollapsed ? '\uf4d9' : '\uf48c';

                    if (isCollapsed) {
                        parentElement.style.maxHeight = `${collapsed_height}px`;
                        parentElement.style.overflowX = 'auto';
                    } else {
                        parentElement.style.maxHeight = 'none';
                        void parentElement.offsetHeight;
                        parentElement.dataset.fullHeight = `${parentElement.scrollHeight}px`;
                    }
                });
            }

            
            copyBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(codeBlock.textContent);
                    copyBtn.textContent = '\uf00c COPIED!';
                    setTimeout(() => copyBtn.textContent = '\uf4bb COPY', 2000);
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
            });

            
            tools.append(langLabel, foldBtn, copyBtn);
            parentElement.prepend(tools);
        });
    });
</script>

<style>
 
.code-tools {
    position: absolute;
    right: 10px;
    top: 20px;
    display: flex;
    align-items: center;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    pointer-events: none;
    font-family: "Maple Mono NF CN";
}

.fold-btn {
    cursor: pointer;
    border: none;
    color: #666;
    background: none;
    font-family: "Maple Mono NF CN";
    font-size: 0.9rem;
    line-height: 1.2;
    margin: 0 0 0 0.45rem;
    transition: all 0.2s ease;
}

 
.lang-label {
     
    color: #666;
    font-size: 1.2rem;
    line-height: 1.2;
}

 
.copy-btn {
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 0 0.3rem;
    margin: 0 0 0 0.6rem;
    color: #333;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    font-size: 0.6rem;
    line-height: 1.8;
    cursor: pointer;
    font-family: "Maple Mono NF CN";
}

 
pre:hover .code-tools {
    opacity: 1;
    pointer-events: auto;
}
</style>


  
<script>
    
    window.diagramRenderUtils = {
        
        getOrCreateFullscreenOverlay: function() {
            let overlay = document.querySelector('.fullscreen-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'fullscreen-overlay';
                document.body.appendChild(overlay);

                
                overlay.addEventListener('dblclick', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });

                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && overlay.classList.contains('active')) {
                        overlay.classList.remove('active');
                    }
                });
            }
            return overlay;
        },

        
        createDiagramContainer: function() {
            const container = document.createElement('div');
            container.className = 'code-rendered-diagram';
            return container;
        },

        
        createCopyButton: function() {
            const copyButton = document.createElement('button');
            copyButton.className = 'code-rendered-diagram-copy-button';
            copyButton.innerHTML = '&#xf4bb; COPY-SRC';
            return copyButton;
        },

        
        createFullscreenButton: function() {
            const fullscreenButton = document.createElement('button');
            fullscreenButton.className = 'code-rendered-diagram-fullscreen-button';
            fullscreenButton.innerHTML = '&#xf065; FULL';
            return fullscreenButton;
        },

        
        makeSVGTransparent: function(svgText) {
            const doc = new DOMParser().parseFromString(svgText, 'image/svg+xml');
            doc.querySelectorAll('[fill="#ffffff"],[fill="white"],[style*="fill: white"]')
                .forEach(el => {
                    if (el.tagName !== 'svg') {
                        el.setAttribute('fill', 'transparent');
                    }
                });
            doc.documentElement.style.backgroundColor = 'transparent';
            return new XMLSerializer().serializeToString(doc);
        },

        
        setupCopyButton: function(copyButton, codeContent) {
            copyButton.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(codeContent);
                    copyButton.textContent = '\uf00c COPIED!';
                    setTimeout(() => copyButton.innerHTML = '&#xf4bb; COPY-SRC', 2000);
                } catch (err) {
                    copyButton.textContent = 'FAILED';
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
            });
        },

        
        setupShowSourceCode: function(imageElem, sourceCode) {
            
            imageElem.addEventListener('contextmenu', function(e) {
                e.preventDefault();

                
                const pre = document.createElement('pre');
                const codeElem = document.createElement('code');
                codeElem.textContent = sourceCode;
                pre.appendChild(codeElem);

                
                window.diagramRenderUtils.popupWindowUtils.create({
                    title: 'Source Code',
                    content: pre,
                    x: e.clientX,
                    y: e.clientY,
                    minWidth: 300,
                    maxWidth: '60%',
                    maxHeight: '60%',
                    closeOnClickOutside: true,
                    closeOnEsc: true,
                    className: 'source-code-viewer'
                });
            });
        },

        
        setupFullscreenButton: function(fullscreenButton, contentElement, isImage = false) {
            fullscreenButton.addEventListener('click', () => {
                const overlay = this.getOrCreateFullscreenOverlay();
                let clonedContent;

                if (isImage) {
                    
                    clonedContent = contentElement.cloneNode(true);
                } else {
                    
                    const svgElement = contentElement.querySelector('svg');
                    if (!svgElement) return;
                    clonedContent = svgElement.cloneNode(true);
                }

                overlay.innerHTML = '';

                
                const exitButton = document.createElement('button');
                exitButton.className = 'fullscreen-exit-button';
                exitButton.innerHTML = 'ESC';
                exitButton.onclick = () => overlay.classList.remove('active');

                overlay.appendChild(exitButton);
                overlay.appendChild(clonedContent);
                overlay.classList.add('active');

                
                this.setupZoomAndDrag(overlay, isImage ? 'img' : 'svg');
            });
        },

        
        setupZoomAndDrag: function(overlay, selector) {
            let scale = 1;
            let posX = 0;
            let posY = 0;
            let isDragging = false;
            let startX = 0;
            let startY = 0;

            const element = overlay.querySelector(selector);

            
            overlay.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY * -0.002;
                const newScale = Math.min(Math.max(scale + delta, 0.1), 10);

                
                const rect = element.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                
                posX += mouseX * (1 - newScale / scale);
                posY += mouseY * (1 - newScale / scale);

                scale = newScale;
                updateTransform();
            });

            
            overlay.addEventListener('mousedown', (e) => {
                if (e.target === overlay) return;
                isDragging = true;
                startX = e.clientX - posX;
                startY = e.clientY - posY;
                overlay.classList.add('dragging');
            });

            window.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                posX = e.clientX - startX;
                posY = e.clientY - startY;
                updateTransform();
            });

            window.addEventListener('mouseup', () => {
                isDragging = false;
                overlay.classList.remove('dragging');
            });

            function updateTransform() {
                element.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
            }
        },

        
        popupWindowUtils: {
            
            create: function(options) {
                
                const config = {
                    title: 'Popup Window',
                    content: '',         
                    x: 100,              
                    y: 100,              
                    minWidth: 300,       
                    maxWidth: '80%',     
                    maxHeight: '80%',    
                    closeOnClickOutside: true,
                    closeOnEsc: true,
                    onClose: null,       
                    className: ''        
                };

                
                Object.assign(config, options);

                
                if (config.className) {
                    const existingPopup = document.querySelector(`.popup-window.${config.className}`);
                    if (existingPopup) {
                        document.body.removeChild(existingPopup);
                    }
                }

                
                const popup = document.createElement('div');
                popup.className = `popup-window ${config.className}`.trim();

                
                const titleBar = document.createElement('div');
                titleBar.className = 'popup-window-title';
                titleBar.textContent = config.title;

                
                const closeButton = document.createElement('button');
                closeButton.className = 'popup-window-close';
                closeButton.innerHTML = '&times;';

                
                titleBar.appendChild(closeButton);

                
                const contentContainer = document.createElement('div');
                contentContainer.className = 'popup-window-content';

                
                if (typeof config.content === 'string') {
                    contentContainer.innerHTML = config.content;
                } else if (config.content instanceof Element) {
                    contentContainer.appendChild(config.content);
                }

                
                popup.appendChild(titleBar);
                popup.appendChild(contentContainer);

                
                popup.style.minWidth = typeof config.minWidth === 'number' ? `${config.minWidth}px` : config.minWidth;
                popup.style.maxWidth = typeof config.maxWidth === 'number' ? `${config.maxWidth}px` : config.maxWidth;
                popup.style.maxHeight = typeof config.maxHeight === 'number' ? `${config.maxHeight}px` : config.maxHeight;

                
                document.body.appendChild(popup);

                
                const popupRect = popup.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;

                
                let left = Math.min(Math.max(config.x, 20), windowWidth - popupRect.width - 20);
                let top = Math.min(Math.max(config.y, 20), windowHeight - popupRect.height - 20);

                popup.style.left = `${left}px`;
                popup.style.top = `${top}px`;

                
                const closePopup = () => {
                    if (document.body.contains(popup)) {
                        document.body.removeChild(popup);
                        if (typeof config.onClose === 'function') {
                            config.onClose();
                        }
                    }
                };

                closeButton.addEventListener('click', closePopup);

                
                if (config.closeOnEsc) {
                    const escHandler = (e) => {
                        if (e.key === 'Escape' && document.body.contains(popup)) {
                            closePopup();
                            document.removeEventListener('keydown', escHandler);
                        }
                    };
                    document.addEventListener('keydown', escHandler);
                }

                
                if (config.closeOnClickOutside) {
                    const outsideClickHandler = (e) => {
                        if (popup && !popup.contains(e.target) && document.body.contains(popup)) {
                            closePopup();
                            document.removeEventListener('mousedown', outsideClickHandler);
                        }
                    };

                    
                    setTimeout(() => {
                        document.addEventListener('mousedown', outsideClickHandler);
                    }, 100);
                }

                
                let isDragging = false;
                let offsetX = 0;
                let offsetY = 0;

                titleBar.addEventListener('mousedown', (e) => {
                    
                    if (e.target !== closeButton) {
                        isDragging = true;
                        offsetX = e.clientX - popup.getBoundingClientRect().left;
                        offsetY = e.clientY - popup.getBoundingClientRect().top;
                        popup.classList.add('dragging');
                    }
                });

                const mouseMoveHandler = (e) => {
                    if (isDragging) {
                        let newLeft = e.clientX - offsetX;
                        let newTop = e.clientY - offsetY;

                        
                        newLeft = Math.max(0, Math.min(windowWidth - popupRect.width, newLeft));
                        newTop = Math.max(0, Math.min(windowHeight - popupRect.height, newTop));

                        popup.style.left = `${newLeft}px`;
                        popup.style.top = `${newTop}px`;
                    }
                };

                const mouseUpHandler = () => {
                    if (isDragging) {
                        isDragging = false;
                        popup.classList.remove('dragging');
                    }
                };

                document.addEventListener('mousemove', mouseMoveHandler);
                document.addEventListener('mouseup', mouseUpHandler);

                
                return {
                    element: popup,
                    contentElement: contentContainer,
                    close: closePopup,
                    setTitle: (title) => {
                        titleBar.textContent = title;
                        titleBar.appendChild(closeButton); 
                    },
                    setContent: (content) => {
                        contentContainer.innerHTML = '';
                        if (typeof content === 'string') {
                            contentContainer.innerHTML = content;
                        } else if (content instanceof Element) {
                            contentContainer.appendChild(content);
                        }
                    },
                    setPosition: (x, y) => {
                        let newLeft = Math.min(Math.max(x, 0), windowWidth - popupRect.width);
                        let newTop = Math.min(Math.max(y, 0), windowHeight - popupRect.height);
                        popup.style.left = `${newLeft}px`;
                        popup.style.top = `${newTop}px`;
                    },
                    
                    destroy: () => {
                        document.removeEventListener('mousemove', mouseMoveHandler);
                        document.removeEventListener('mouseup', mouseUpHandler);
                        if (document.body.contains(popup)) {
                            document.body.removeChild(popup);
                        }
                    }
                };
            }
        }
    };
</script>
<style>
     
    .code-rendered-diagram {
        max-width: 80% !important;
        height: auto;
        position: relative;

        svg {
            max-width: 100%;
            height: auto;
        }
    }

    .code-rendered-diagram-copy-button,
    .code-rendered-diagram-fullscreen-button {
        position: absolute;
        top: 20px;
        transform: translateY(-10px);
        transition: all 0.2s ease;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 0 0.3rem;
        margin: 0 0 0 0.6rem;
        color: #333;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-size: 0.6rem;
        line-height: 1.8;
        cursor: pointer;
        font-family: "Maple Mono NF CN";
        opacity: 0;
    }

    .code-rendered-diagram-copy-button {
        right: 10px;
    }

    .code-rendered-diagram-fullscreen-button {
        right: 100px;
    }

    .code-rendered-diagram:hover .code-rendered-diagram-copy-button,
    .code-rendered-diagram:hover .code-rendered-diagram-fullscreen-button {
        opacity: 1;
    }

    .fullscreen-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #FBFBFB;
         
        z-index: 99999;
        justify-content: center;
        align-items: center;
    }

    .fullscreen-overlay.active {
        display: flex;
    }

    .fullscreen-overlay img,
    .fullscreen-overlay svg {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        cursor: move;
        transition: transform 0.1s ease-out;
        transform-origin: center center;
    }

    .fullscreen-overlay svg {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }

    .fullscreen-overlay.dragging {
        cursor: move;
    }

    .fullscreen-exit-button {
        position: fixed;
        top: 20px;
        left: 20px;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 6px;
        color: #666;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-size: 0.8rem;
        line-height: 1.8;
        cursor: pointer;
        font-family: "Maple Mono NF CN";
        transition: all 0.2s ease;
        z-index: 100000;
    }

    .fullscreen-exit-button:hover {
        background-color: #e0e0e0;
        color: #333;
    }

     
    .popup-window {
        position: fixed;
        z-index: 10000;
        background-color: #f8f8f8;
        border: 1px solid #ccc;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: box-shadow 0.3s ease;
    }

    .popup-window.dragging {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        opacity: 0.95;
    }

    .popup-window-title {
        background-color: #e8e8e8;
        padding: 8px 12px;
        font-weight: bold;
        border-bottom: 1px solid #ddd;
        cursor: move;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #333;
        font-family: "Maple Mono NF CN", monospace;
        font-size: 0.9rem;
    }

    .popup-window-close {
        background: none;
        border: none;
        font-size: 1.2rem;
        line-height: 1;
        cursor: pointer;
        color: #666;
        padding: 0 4px;
        margin: -4px -4px 0 0;
        transition: color 0.2s ease;
    }

    .popup-window-close:hover {
        color: #333;
    }

    .popup-window-content {
        overflow: auto;
        padding: 10px;
        font-size: 0.9rem;
    }

     
    .popup-window.source-code-viewer .popup-window-content {
        font-family: "Maple Mono NF CN", monospace;
    }

    .popup-window.source-code-viewer .popup-window-content pre {
        margin: 0;
        white-space: pre-wrap;
    }

    .popup-window.source-code-viewer .popup-window-content code {
        font-family: "Maple Mono NF CN", monospace;
        color: #333;
    }
</style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const plantumlBlocks = document.querySelectorAll('pre code.language-plantuml');
        if (!plantumlBlocks.length) return;

        
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js';

        
        script.onload = () => {
            const plantuml_theme = parsePlantumlUserConfig();

            plantumlBlocks.forEach(codeBlock => {
                
                const container = window.diagramRenderUtils.createDiagramContainer();

                
                const img = document.createElement('img');
                img.className = 'code-rendered-diagram-img';
                img.style.display = 'block';
                img.alt = 'PlantUML Diagram';

                
                const fullCode = `${plantuml_theme}\n\n${codeBlock.textContent}`;
                img.src = 'https://www.plantuml.com/plantuml/svg/' + plantumlEncoder.encode(fullCode);

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, fullCode);

                
                window.diagramRenderUtils.setupShowSourceCode(img, fullCode);

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, img, true);

                
                

                
                container.appendChild(img);
                container.appendChild(fullscreenButton);
                container.appendChild(copyButton);
                codeBlock.parentElement.replaceWith(container);
            });
        };

        
        document.head.appendChild(script);
    });

    function parsePlantumlUserConfig() {
        let configItems = [];

        
            configItems.push(`scale 5`);
        

        
            configItems.push(`skin rose`);
        

        
            configItems.push(`skinparam BackgroundColor transparent`);
        

        
        
            
                configItems.push(`skinparam shadowing false`);
            
        

        

        
            configItems.push(`skinparam BackgroundColor transparent`);
        

        return configItems.join("\n").trim();
    }
</script>

  
<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
        if (!mermaidBlocks.length) return;

        
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js';

        
        script.onload = () => {
            
            mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                fontFamily: 'Maple Mono NF CN',
                
                look: 'handDrawn',
                
                theme: 'neutral',
                
                
            });

            
            mermaidBlocks.forEach((codeBlock, index) => {
                
                const container = window.diagramRenderUtils.createDiagramContainer();

                
                const renderDiv = document.createElement('div');
                renderDiv.id = `mermaid-diagram-${index}`;
                renderDiv.style.background = 'transparent';

                
                const code = codeBlock.textContent.trim();

                try {
                    
                    mermaid.render(`mermaid-svg-${index}`, code).then(result => {
                        renderDiv.innerHTML = result.svg;

                        
                        const svg = renderDiv.querySelector('svg');
                        if (svg) {
                            svg.style.backgroundColor = 'transparent';
                            
                            svg.querySelectorAll('[fill="#ffffff"],[fill="white"],[style*="fill: white"]')
                                .forEach(el => {
                                    if (el.tagName !== 'svg') {
                                        el.setAttribute('fill', 'transparent');
                                    }
                                });
                        }
                    });
                } catch (error) {
                    console.error('Mermaidæ¸²æŸ“é”™è¯¯:', error);
                    renderDiv.innerHTML = `<div style="color:red;border:1px solid red;padding:10px;">
                        Mermaidæ¸²æŸ“é”™è¯¯: ${error.message}
                    </div>`;
                }

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, code);

                
                window.diagramRenderUtils.setupShowSourceCode(renderDiv, code);

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, renderDiv, false);

                
                container.appendChild(renderDiv);
                container.appendChild(fullscreenButton);
                container.appendChild(copyButton);

                
                const pre = codeBlock.closest('pre');
                pre.insertAdjacentElement('afterend', container);
                pre.remove();
            });
        };

        
        document.head.appendChild(script);
    });
</script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const markmapBlocks = document.querySelectorAll('pre code.language-map, pre code.language-mindmap');
        if (!markmapBlocks.length) return;

        
        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        
        Promise.all([
            loadScript('https://cdn.jsdelivr.net/npm/d3@latest'),
            loadScript('https://cdn.jsdelivr.net/npm/markmap-view@latest'),
            loadScript('https://cdn.jsdelivr.net/npm/markmap-lib@latest')
        ]).then(() => {
            
            markmapBlocks.forEach((codeBlock, index) => {
                
                const container = window.diagramRenderUtils.createDiagramContainer();

                
                const markmapContainer = document.createElement('div');
                markmapContainer.className = 'markmap';
                markmapContainer.id = `markmap-${index}`;
                markmapContainer.style.minHeight = '300px';
                markmapContainer.style.width = '100%';
                markmapContainer.style.position = 'relative';

                
                const code = codeBlock.textContent.trim();

                
                const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svgElement.style.width = '100%';
                svgElement.style.height = '400px';
                markmapContainer.appendChild(svgElement);

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, code);

                
                window.diagramRenderUtils.setupShowSourceCode(markmapContainer, code);

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, markmapContainer, false);

                
                container.appendChild(markmapContainer);
                container.appendChild(fullscreenButton);
                container.appendChild(copyButton);

                
                const pre = codeBlock.closest('pre');
                pre.insertAdjacentElement('afterend', container);
                pre.remove();

                
                renderMarkmapWithRetry(svgElement, markmapContainer, code);
            });
        }).catch(error => {
            console.error('åŠ è½½markmapåº“å¤±è´¥:', error);
        });

        

        function renderMarkmapWithRetry(svgElement, markmapContainer, code, maxRetries = 5, delay = 200) {
            let attempt = 0;

            function tryRender() {
                attempt++;
                try {
                    
                    if (!window.markmap || typeof window.markmap.Markmap !== 'function') {
                        throw new Error('Markmap constructor not available yet.');
                    }

                    
                    const { Transformer } = window.markmap;
                    const transformer = new Transformer();

                    
                    const { root, features } = transformer.transform(code);

                    
                    const { Markmap } = window.markmap;
                    const mm = new Markmap(svgElement, {
                        autoFit: true,
                        duration: 500,
                        zoom: true,
                    });

                    
                    mm.setData(root, features);
                    mm.fit();

                    
                    markmapContainer.dataset.markmapData = JSON.stringify({
                        root: root,
                        features: features
                    });

                    
                    setTimeout(() => {
                        const links = svgElement.querySelectorAll('a');
                        links.forEach(link => {
                            link.setAttribute('target', '_blank');
                            link.setAttribute('rel', 'noopener noreferrer');
                        });
                    }, 100);

                } catch (error) {
                    console.error(`Markmapæ¸²æŸ“å°è¯•ç¬¬ ${attempt} æ¬¡å¤±è´¥:`, error.message);
                    if (attempt < maxRetries) {
                        
                        setTimeout(tryRender, delay);
                    } else {
                        
                        console.error('Markmapæ¸²æŸ“åœ¨å¤šæ¬¡é‡è¯•åä»ç„¶å¤±è´¥ã€‚');
                        markmapContainer.innerHTML = `<div style="color:red;border:1px solid red;padding:10px;">
                            Markmapæ¸²æŸ“é”™è¯¯: ${error.message} (è¯·å°è¯•æ‰‹åŠ¨åˆ·æ–°ç½‘é¡µ)
                        </div>`;
                    }
                }
            }

            
            tryRender();
        }
    });
</script>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        
        if (!window.diagramRenderUtils) return;

        
        const originalSetupFullscreenButton = window.diagramRenderUtils.setupFullscreenButton;
        window.diagramRenderUtils.setupFullscreenButton = function(fullscreenButton, contentElement, isImage = false) {
            
            const isMarkmap = contentElement.classList.contains('markmap');

            if (isMarkmap) {
                fullscreenButton.addEventListener('click', () => {
                    const overlay = this.getOrCreateFullscreenOverlay();
                    overlay.innerHTML = '';

                    
                    const exitButton = document.createElement('button');
                    exitButton.className = 'fullscreen-exit-button';
                    exitButton.innerHTML = 'ESC';
                    exitButton.onclick = () => overlay.classList.remove('active');
                    overlay.appendChild(exitButton);

                    
                    const fullscreenContainer = document.createElement('div');
                    fullscreenContainer.className = 'markmap';
                    fullscreenContainer.style.width = '100%';
                    fullscreenContainer.style.height = '100%';

                    
                    const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svgElement.style.width = '100%';
                    svgElement.style.height = '100%';
                    fullscreenContainer.appendChild(svgElement);

                    overlay.appendChild(fullscreenContainer);
                    overlay.classList.add('active');

                    
                    try {
                        const markmapData = JSON.parse(contentElement.dataset.markmapData || '{}');
                        if (markmapData.root) {
                            
                            const { Markmap } = window.markmap;
                            const mm = new Markmap(svgElement, {
                                autoFit: true,
                                duration: 500,
                                zoom: true,
                            });

                            
                            mm.setData(markmapData.root, markmapData.features);
                            mm.fit();

                            
                            setTimeout(() => {
                                const links = svgElement.querySelectorAll('a');
                                links.forEach(link => {
                                    link.setAttribute('target', '_blank');
                                    link.setAttribute('rel', 'noopener noreferrer');
                                });
                            }, 100);
                        }
                    } catch (error) {
                        console.error('å…¨å±æ¨¡å¼ä¸‹æ¸²æŸ“markmapå¤±è´¥:', error);
                    }

                    
                    this.setupZoomAndDrag(overlay, 'svg');
                });
            } else {
                
                originalSetupFullscreenButton.call(this, fullscreenButton, contentElement, isImage);
            }
        };
    });
</script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const xmindBlocks = document.querySelectorAll('pre code.language-xmind');
        if (xmindBlocks.length === 0) {
            return;
        }

        
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/xmind-embed-viewer/dist/umd/xmind-embed-viewer.js';
        document.head.appendChild(script);

        
        script.onload = function() {
            xmindBlocks.forEach((codeBlock, index) => {
                const xmindUrl = codeBlock.textContent.trim();
                if (!xmindUrl) {
                    console.error('XMind code block is empty.');
                    return;
                }

                
                const mountId = `xmind-mount-${index}`;
                const mountDiv = document.createElement('div');
                mountDiv.id = mountId;

                
                const preElement = codeBlock.parentElement;
                preElement.parentElement.replaceChild(mountDiv, preElement);

                renderXmindFile(mountId, xmindUrl);
            });

            async function renderXmindFile(elementId, fileUrl) {
                const mountEl = document.getElementById(elementId);

                
                
                mountEl.className = 'xmind-container';
                
                mountEl.innerHTML = `
                <div class="xmind-loader-wrapper">
                    <div class="xmind-loader"></div>
                    <div class="xmind-loader-text">xmind loading</div>
                </div>
            `;

                try {
                    
                    const isExternal = fileUrl.startsWith('http');
                    const fetchUrl = isExternal ? `https://api.allorigins.win/raw?url=${encodeURIComponent(fileUrl)}` : fileUrl;
                    const res = await fetch(fetchUrl, {
                        mode: 'cors'
                    });

                    
                    if (!res.ok) {
                        mountEl.innerHTML = `
                        <div class="xmind-error">
                            <span class="xmind-error-icon">âš ï¸</span>
                            <div class="xmind-error-content">
                                <strong>åŠ è½½ XMind æ–‡ä»¶å¤±è´¥</strong>
                                <p>æ— æ³•ä» <code>${fileUrl}</code> è·å–æ–‡ä»¶ (HTTP ${res.status})</p>
                            </div>
                        </div>
                    `;
                        console.error(`Failed to fetch XMind file: ${res.statusText}`);
                        return;
                    }
                    const fileBuffer = await res.arrayBuffer();

                    
                    mountEl.className = ''; 
                    mountEl.innerHTML = ''; 

                    new XMindEmbedViewer({
                        el: `#${elementId}`,
                        file: fileBuffer,
                        styles: {
                            'height': '500px',
                            'width': '100%'
                        }
                    });
                } catch (error) {
                    
                    mountEl.innerHTML = `
                    <div class="xmind-error">
                        <span class="xmind-error-icon">âš ï¸</span>
                        <div class="xmind-error-content">
                            <strong>æ¸²æŸ“ XMind æ–‡ä»¶æ—¶å‡ºé”™</strong>
                            <p>${error.message}</p>
                        </div>
                    </div>
                `;
                    console.error('Error rendering XMind file:', error);
                }
            }
        }
    });
</script>

<style>
     
    .xmind-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background-color: #f9f9f9;
        border: 1px dashed #ddd;
        border-radius: 6px;
        margin: 1.5rem 0;
        padding: 20px;
    }

     
    .xmind-loader-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }

     
    .xmind-loader {
        border: 3px solid #f0f0f0;
        border-top: 3px solid #999;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
    }

     
    .xmind-loader-text {
        color: #888;
        font-size: 0.9rem;
        font-family: "LXGW WenKai", "Maple Mono NF CN", sans-serif;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

     
    .xmind-error {
        display: flex;
        align-items: flex-start;
        text-align: left;
        color: #c0392b;
        width: 100%;
    }

    .xmind-error-icon {
        font-size: 1.5rem;
        margin-right: 15px;
        line-height: 1.2;
    }

    .xmind-error-content {
        flex: 1;
    }

    .xmind-error strong {
        font-size: 1.1rem;
        color: #a93226;
    }

    .xmind-error p {
        margin: 5px 0 0;
        font-size: 0.9rem;
        color: #7b241c;
        word-break: break-all;
    }

    .xmind-error code {
        background-color: #fbeae5;
        padding: 2px 5px;
        border-radius: 4px;
        font-size: 0.85rem;
    }
</style>

  
<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        const DIAGRAM_MAP = new Map([
            ['plantuml_kroki', 'plantuml'],
            ['mermaid_kroki', 'mermaid'],
            ['graphviz', 'graphviz'],
            ['blockdiag', 'blockdiag'],
            ['seqdiag', 'seqdiag'],
            ['actdiag', 'actdiag'],
            ['packetdiag', 'packetdiag'],
            ['database', 'dbml'],
            ['dbml', 'dbml'],
            ['vega', 'vega']
        ]);

        
        const blocks = [];
        document.querySelectorAll('pre code[class]').forEach(block => {
            if (block.dataset.kroki) return;
            const lang = [...block.classList].find(c => DIAGRAM_MAP.has(c.split('-')[1]));
            if (lang) {
                block.dataset.kroki = 'processed';
                blocks.push({ block, api: DIAGRAM_MAP.get(lang.split('-')[1]) });
            }
        });

        if (!blocks.length) return;

        
        const CONCURRENCY = 6;
        const queue = blocks.slice();

        (async function processQueue() {
            const workers = Array(Math.min(CONCURRENCY, queue.length))
                .fill()
                .map(async () => {
                    while (queue.length) {
                        const { block, api } = queue.pop();
                        await renderBlock(block, api);
                    }
                });
            await Promise.all(workers);
        })();

        async function renderBlock(block, api) {
            const pre = block.closest('pre');
            try {
                const code = block.textContent.trim();
                if (!code) {
                    pre.style.border = '2px solid orange';
                    return;
                }

                const res = await fetch(`https://kroki.io/${api}/svg`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: code
                });

                if (!res.ok) throw new Error(`${await res.text()} (HTTP ${res.status})`);

                
                const svg = window.diagramRenderUtils.createDiagramContainer();
                svg.innerHTML = window.diagramRenderUtils.makeSVGTransparent(await res.text());

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, svg, false);
                svg.appendChild(fullscreenButton);

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, code);
                svg.appendChild(copyButton);

                
                window.diagramRenderUtils.setupShowSourceCode(svg, code);

                pre.insertAdjacentElement('afterend', svg);

                
                pre.remove();
            } catch (err) {
                console.error(`[Kroki] æ¸²æŸ“å¤±è´¥: ${err.message}`);
                pre.style.border = '2px solid red';
                pre.title = err.message;
            }
        }
    });
</script>


  <div id="search-modal">
  <input type="text" id="modal-search-input" placeholder="è¾“å…¥å…³é”®è¯æœç´¢..." aria-label="æœç´¢æ¡†" autocomplete="off">
  <div id="modal-search-debug" style="margin-bottom: 10px; color: #999;"></div>
  <div id="modal-search-results"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<script>
  function debug(text) {
      document.getElementById('modal-search-debug').textContent = text;
  }
  function showpages() {
    debug("å½“å‰æœ¬ç«™å…±æœ‰ " + searchIndex.length + " ç¯‡æ–‡ç« ");
  }

  let searchIndex = [];
  
  
    
  

  
    searchIndex.push({
      title: "\"é¢å‘æ¨¡å¼çš„è½¯ä»¶æ¶æ„ å·1 æ¨¡å¼ç³»ç»Ÿ è¯»ä¹¦ç¬”è®°\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/%E9%9D%A2%E5%90%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%8D%B71%E6%A8%A1%E5%BC%8F%E7%B3%BB%E7%BB%9F%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/\"",
      
      categories: "[\"è¯»ä¹¦ç¬”è®°\",\"è½¯ä»¶å·¥ç¨‹\"]",
      tags: "[\"è®¾è®¡æ¨¡å¼\"]",
      series: "[\"è½¯ä»¶æ¶æ„ä¹‹é“\"]",
      date: "\"2025-12-04\""
    });
  
    searchIndex.push({
      title: "\"é“¾æ¥ç¬¦å·ä¸ç¬¦å·å¯¼å…¥å¯¼å‡ºå®â€”â€”è®°ä¸€æ¬¡å› clangdè¡¥å…¨å¤´æ–‡ä»¶äº§ç”Ÿçš„é“¾æ¥é”™è¯¯\"",
      permalink: "\"/cpp/%E9%93%BE%E6%8E%A5%E7%AC%A6%E5%8F%B7%E5%AF%BC%E5%87%BA%E4%B8%8E%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E5%AE%8F/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"C++\"]",
      series: "[\"C++è¸©å‘\"]",
      date: "\"2025-11-17\""
    });
  
    searchIndex.push({
      title: "\"Qtä»é›¶å¼€å§‹ï¼ˆ0ï¼‰â€”â€”ç¯å¢ƒé…ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/qt%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: "[\"Qtä¸“æ \"]",
      date: "\"2025-08-30\""
    });
  
    searchIndex.push({
      title: "\"ubuntué…ç½®coredumpæ–‡ä»¶ç”Ÿæˆä½ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ubuntu%E7%94%9F%E6%88%90coredump%E6%96%87%E4%BB%B6/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2025-08-01\""
    });
  
    searchIndex.push({
      title: "\"ubuntuå®‰è£…ä¸­æ–‡è¾“å…¥æ³•ï¼ˆfcitx5-rimeï¼‰\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ubuntu%E5%AE%89%E8%A3%85rime%E8%BE%93%E5%85%A5%E6%B3%95/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2025-07-10\""
    });
  
    searchIndex.push({
      title: "\"SSHåå‘éš§é“ä¸­è½¬æœº-è¿œç¨‹è¿æ¥æœ¬åœ°æœåŠ¡å™¨\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/ssh%E5%8F%8D%E5%90%91%E9%9A%A7%E9%81%93%E4%B8%AD%E8%BD%AC%E6%9C%BA%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"ssh\"]",
      series: [],
      date: "\"2025-06-16\""
    });
  
    searchIndex.push({
      title: "\"C++ é«˜å¹¶å‘æœåŠ¡å™¨æ¨¡å‹å®ç° | [è½¬è½½](https://github.com/linkxzhou/mylib/blob/master/c%2B%2B/concurrency_server/README.md)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/06/10/22%E7%A7%8Dc-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"ç½‘ç»œç¼–ç¨‹\",\"C++\"]",
      series: [],
      date: "\"2025-06-10\""
    });
  
    searchIndex.push({
      title: "\"libclang-pyä½¿ç”¨ä»‹ç»\"",
      permalink: "\"/cpp/libclang-py%E4%BD%BF%E7%94%A8/\"",
      
      categories: [],
      tags: "[\"C++\",\"ç¼–è¯‘åŸç†\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-06-10\""
    });
  
    searchIndex.push({
      title: "\"å‚æ•°åŒ…ä¸æŠ˜å è¡¨è¾¾å¼å‚»å‚»åˆ†ä¸æ¸…\"",
      permalink: "\"/cpp/%E5%8F%82%E6%95%B0%E5%8C%85%E4%B8%8E%E6%8A%98%E5%8F%A0%E8%A1%A8%E8%BE%BE%E5%BC%8F/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"C++\"]",
      series: "[\"modern c++\"]",
      date: "\"2025-06-05\""
    });
  
    searchIndex.push({
      title: "\"åç¨‹å¿«é€Ÿå…¥é—¨\"",
      permalink: "\"/cpp/%E5%8D%8F%E7%A8%8B%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"coroutine\",\"C++\"]",
      series: "[\"modern c++\"]",
      date: "\"2025-05-21\""
    });
  
    searchIndex.push({
      title: "\"åˆç­‰æ•°å­¦å›å¿†å½•\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/%E5%88%9D%E7%AD%89%E6%95%B0%E5%AD%A6%E5%9B%9E%E5%BF%86%E5%BD%95/\"",
      
      categories: "[\"æ•°å­¦\"]",
      tags: "[\"æ•°å­¦\",\"ä¸‰è§’å‡½æ•°\",\"æåæ ‡\",\"å®šç§¯åˆ†\"]",
      series: [],
      date: "\"2025-05-16\""
    });
  
    searchIndex.push({
      title: "\"Epollè¯¦ç»†ä»‹ç» | [è½¬è½½](https://mp.weixin.qq.com/s/pahk8ay5MvkvONeg1-M82w)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/05/04/epoll%E8%AF%A6%E8%A7%A3/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"ç½‘ç»œç¼–ç¨‹\",\"epoll\"]",
      series: [],
      date: "\"2025-05-04\""
    });
  
    searchIndex.push({
      title: "\"å…±äº«å†…å­˜è¯¦è§£ | [è½¬è½½](https://mp.weixin.qq.com/s/wOySn0oi0xXREpFRBXCMmQ)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/05/04/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E8%AF%A6%E8%A7%A3/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"ç½‘ç»œç¼–ç¨‹\"]",
      series: [],
      date: "\"2025-05-04\""
    });
  
    searchIndex.push({
      title: "\"Asio åŸºæœ¬ä½¿ç”¨ä¸æ ¸å¿ƒè®¾è®¡æ€æƒ³ | [è½¬è½½](https://blog.csdn.net/gma999/article/details/143983035)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/17/asio-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"asio\"]",
      series: "[\"ç½‘ç»œç¼–ç¨‹\"]",
      date: "\"2025-04-17\""
    });
  
    searchIndex.push({
      title: "\"GoogleTestä¸gMockè¿›é˜¶æŒ‡å— | [è½¬è½½](https://www.cnblogs.com/jinyunshaobing/p/16804309.html)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/16/googletest%E4%B8%8Egmock%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"GoogleTest\"]",
      series: [],
      date: "\"2025-04-16\""
    });
  
    searchIndex.push({
      title: "\"GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ | [è½¬è½½](https://imageslr.com/2023/gtest.html)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/16/gtest_gmock-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5%E6%89%8B%E5%86%8C/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"GoogleTest\"]",
      series: [],
      date: "\"2025-04-16\""
    });
  
    searchIndex.push({
      title: "\"Docker ç½‘ç»œæ¨¡å¼è¯¦è§£åŠå®¹å™¨é—´ç½‘ç»œé€šä¿¡ | [è½¬è½½](https://www.cnblogs.com/mrhelloworld/p/docker11.html)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/15/docker-%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%AE%B9%E5%99%A8%E9%97%B4%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"Docker\"]",
      series: [],
      date: "\"2025-04-15\""
    });
  
    searchIndex.push({
      title: "\"ä¸‡å­—é•¿æ–‡ç®€è¿°Apolloä¸­CyberRTæ¡†æ¶åŸºç¡€æ¦‚å¿µ | [è½¬è½½](https://zhuanlan.zhihu.com/p/479518561#CTZ_DEFAULT)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/15/%E4%B8%87%E5%AD%97%E9%95%BF%E6%96%87%E7%AE%80%E8%BF%B0apollo%E4%B8%ADcyberrt%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"CyberRT\"]",
      series: [],
      date: "\"2025-04-15\""
    });
  
    searchIndex.push({
      title: "\"C++å°æŠ€å·§\"",
      permalink: "\"/cpp/c++%E5%B0%8F%E6%8A%80%E5%B7%A7/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"C++\"]",
      series: "[\"modern c++\"]",
      date: "\"2025-04-14\""
    });
  
    searchIndex.push({
      title: "\"tmux å¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/tmux%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"tmux\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-04-08\""
    });
  
    searchIndex.push({
      title: "\"Valgrindå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/valgrind%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"valgrind\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-04-08\""
    });
  
    searchIndex.push({
      title: "\"Mermaidå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/mermaid%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"mermaid\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-04-07\""
    });
  
    searchIndex.push({
      title: "\"CyberRTæ¡†æ¶æ€»è§ˆ\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/cyberrt%E6%A1%86%E6%9E%B6%E6%80%BB%E8%A7%88/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: "[\"CyberRT\"]",
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-04-02\""
    });
  
    searchIndex.push({
      title: "\"é€šä¿¡ä¸­é—´ä»¶æœ¯è¯­è¡¨\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/%E6%9C%AF%E8%AF%AD%E8%A1%A8/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: [],
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-03-27\""
    });
  
    searchIndex.push({
      title: "\"ç°ä»£C++å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/c++%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"c++\"]",
      series: [],
      date: "\"2025-03-26\""
    });
  
    searchIndex.push({
      title: "\"å¸¦ç€ç›®çš„å­¦ï¼šCyberRT\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/%E5%B8%A6%E7%9D%80%E9%97%AE%E9%A2%98%E5%AD%A6cyberrt/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: "[\"CyberRT\"]",
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-03-25\""
    });
  
    searchIndex.push({
      title: "\"Linuxç¯å¢ƒå˜é‡åŠ è½½é¡ºåºåˆ†æ\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/linux%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%E5%88%86%E6%9E%90/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"linux\"]",
      series: [],
      date: "\"2025-03-14\""
    });
  
    searchIndex.push({
      title: "\"æ‰‹å†Œé€ŸæŸ¥æ–¹æ¡ˆï¼ˆå¦‚cppreferenceï¼‰\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/zeal-dataset%E4%B8%AD%E6%96%87cppreference%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"cppreference\"]",
      series: [],
      date: "\"2025-03-12\""
    });
  
    searchIndex.push({
      title: "\"CyberRTä¸­çš„ä»£ç å’Œå·¥ç¨‹æŠ€å·§\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/cyberrt%E4%B8%AD%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%92%8C%E4%BB%A3%E7%A0%81%E6%8A%80%E5%B7%A7/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: "[\"CyberRT\",\"C++\"]",
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-03-01\""
    });
  
    searchIndex.push({
      title: "\"è®¾è®¡æ¨¡å¼\"",
      permalink: "\"/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/\"",
      
      categories: "[\"è½¯ä»¶å·¥ç¨‹\"]",
      tags: "[\"SE\"]",
      series: "[\"è®¾è®¡æ¨¡å¼ä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-02-28\""
    });
  
    searchIndex.push({
      title: "\"ä¸€ç«™å¼ç¯å¢ƒé…ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E4%B8%80%E7%AB%99%E5%BC%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2025-02-24\""
    });
  
    searchIndex.push({
      title: "\"leetcodeè°ƒè¯•æŒ‡å—\"",
      permalink: "\"/%E7%AE%97%E6%B3%95/leetcode%E8%B0%83%E8%AF%95%E6%8C%87%E5%8D%97/\"",
      
      categories: [],
      tags: "[\"leetcode\"]",
      series: [],
      date: "\"2024-03-14\""
    });
  
    searchIndex.push({
      title: "\"linuxå‘½ä»¤è¡Œå¤§è®°å¿†æ¢å¤æœ¯\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%94%A8%E6%B3%95/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"linux\",\"cmdline\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2023-11-25\""
    });
  
    searchIndex.push({
      title: "\"ç•ªèŒ„é¸¡è›‹é¢\"",
      permalink: "\"/%E8%A1%A3%E9%A3%9F%E4%BD%8F%E8%A1%8C/%E8%8F%9C%E8%B0%B1/%E7%95%AA%E8%8C%84%E9%B8%A1%E8%9B%8B%E9%9D%A2/\"",
      
      categories: "[\"è¡£é£Ÿä½è¡Œ\"]",
      tags: [],
      series: "[\"å¿«é€Ÿåšé¥­\"]",
      date: "\"2023-10-22\""
    });
  
    searchIndex.push({
      title: "\"PlantUMLå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/plantuml%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"uml\",\"plantuml\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2023-10-11\""
    });
  
    searchIndex.push({
      title: "\"WSLå®‰è£…ä¸é…ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/wsl%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2023-09-12\""
    });
  
    searchIndex.push({
      title: "\"C++ç½‘ç»œç¼–ç¨‹å…¥é—¨æ¦‚å¿µåŠapiæ€»ç»“\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/\"",
      
      categories: [],
      tags: "[\"linux\",\"ç½‘ç»œç¼–ç¨‹\"]",
      series: "[\"é¢ç­‹\",\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2023-04-02\""
    });
  
    searchIndex.push({
      title: "\"è‹å·æ—…è¡Œè®¡åˆ’\"",
      permalink: "\"/%E8%A1%A3%E9%A3%9F%E4%BD%8F%E8%A1%8C/%E6%97%85%E8%A1%8C%E6%94%BB%E7%95%A5/%E8%8B%8F%E5%B7%9E/\"",
      
      categories: "[\"è¡£é£Ÿä½è¡Œ\"]",
      tags: "[\"æ—…è¡Œ\"]",
      series: [],
      date: "\"2023-04-01\""
    });
  
    searchIndex.push({
      title: "\"gdbå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/gdb%E6%95%99%E7%A8%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"gdb\",\"cmdline\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2022-11-25\""
    });
  
    searchIndex.push({
      title: "\"Ubuntu22.04å®‰è£…Hadoopå®Œå…¨åˆ†å¸ƒå¼é›†ç¾¤\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ubuntu%E9%85%8D%E7%BD%AEhadoop%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"hadoop\"]",
      series: [],
      date: "\"2022-11-21\""
    });
  
    searchIndex.push({
      title: "\"C++è¿æ¥mysql\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/c++%E8%BF%9E%E6%8E%A5mysql/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2022-11-20\""
    });
  
    searchIndex.push({
      title: "\"å¾æœCæŒ‡é’ˆç¬”è®°\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/%E5%BE%81%E6%9C%8Dc%E6%8C%87%E9%92%88/\"",
      
      categories: [],
      tags: [],
      series: [],
      date: "\"2022-10-04\""
    });
  
    searchIndex.push({
      title: "\"Leetcodeåˆ·é¢˜æŒ‡å—\"",
      permalink: "\"/%E7%AE%97%E6%B3%95/leetcode%E5%88%B7%E9%A2%98%E6%8C%87%E5%8D%97/\"",
      
      categories: "[\"ç®—æ³•\"]",
      tags: "[\"leetcode\"]",
      series: "[\"leetcodeåˆ·é¢˜æŒ‡å—\"]",
      date: "\"2022-09-11\""
    });
  
    searchIndex.push({
      title: "\"word é¡µçœ‰é¡µè„šè®¾ç½®\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/word%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: [],
      series: [],
      date: "\"2021-04-03\""
    });
  
    searchIndex.push({
      title: "\"Markdown Demo\"",
      permalink: "\"/%E6%B5%8B%E8%AF%95/markdown-demo/\"",
      
      categories: [],
      tags: "[\"markdown\"]",
      series: [],
      date: "\"2021-02-15\""
    });
  
    searchIndex.push({
      title: "\"å¸¸ç”¨æ•°å­¦ç¬¦å·çš„latexè¡¨ç¤º\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E5%B8%B8%E7%94%A8%E6%95%B0%E5%AD%A6%E7%AC%A6%E5%8F%B7%E7%9A%84latex%E8%A1%A8%E7%A4%BA/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"latex\",\"markdown\"]",
      series: [],
      date: "\"2021-02-15\""
    });
  

  showpages()

  const options = {
    includeScore: true,
    threshold: 0.6,
    keys: [
      { name: 'title', weight: 0.7 },
      { name: 'content', weight: 0.3 },
      { name: 'tags', weight: 0.5 },
      { name: 'categories', weight: 0.5 },
      { name: 'series', weight: 0.5 }
    ]
  };

  const fuse = new Fuse(searchIndex, options);

  document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && event.key === 'k') {
      event.preventDefault();
      toggleSearchModal();
    } else if (event.key === 'Escape') {
      document.getElementById('modal-search-input').value = "";
      closeSearchModal();
      var res = document.getElementById('modal-search-results');
      while (res.firstChild) {
        res.removeChild(res.firstChild);
      }
      showpages();
    }
  });

  function toggleSearchModal() {
    const modal = document.getElementById('search-modal');
    if (modal.style.display === 'none') {
      modal.style.display = 'block';
      document.getElementById('modal-search-input').focus();
    } else {
      modal.style.display = 'none';
    }
  }

  function closeSearchModal() {
    const modal = document.getElementById('search-modal');
    modal.style.display = 'none';
  }

  document.getElementById('modal-search-input').addEventListener('input', function(e) {
    const searchTerm = e.target.value.trim();
    const resultsContainer = document.getElementById('modal-search-results');
    resultsContainer.innerHTML = '';

    if (searchTerm === '') {
      showpages()
      return;
    }

    const results = fuse.search(searchTerm);

    results.sort((a, b) => new Date(b.item.date) - new Date(a.item.date));

    if (results.length === 0) {
      showpages()
      resultsContainer.innerHTML = '<p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« </p>';
      return;
    } else {
      debug("å…±æ‰¾åˆ° " + results.length + " ç¯‡åŒ¹é…çš„æ–‡ç« ")
    }

    results.forEach(result => {
      const item = result.item;
      const resultItem = document.createElement('div');
      resultItem.className = 'modal-search-result-item';

      const date = document.createElement('span');
      date.textContent = item.date.replace(/^"|"$/g, '') + '   ';
      date.className = 'modal-search-result-date';

      const link = document.createElement('a');
      link.href = item.permalink.replace(/^"|"$/g, '');
      link.textContent = item.title.replace(/^"|"$/g, '');
      link.className = 'modal-search-result-title';

      resultItem.appendChild(date);
      resultItem.appendChild(link);
      resultsContainer.appendChild(resultItem);
    });
  });
</script>

<style>
 
#search-modal {
    display: none;
    position: fixed;
    top: 6%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 20px;
    box-shadow: 0 0 6px rgba(45, 45, 45, 0.5);
    border-radius: 6px;
    z-index: 1000;
    width: 80%;
    max-width: 600px;
    text-align: left;
}

#modal-search-input {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    font-size: 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 1rem;
}

#modal-search-results {
    margin-top: 10px;
    max-height: 60vh;
    overflow-y: auto;
}

.modal-search-result-item {
    padding: 0.7rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
}

.modal-search-result-date {
    color: #666;
    font-size: 1.1rem;
    margin-right: 0.5rem;
    text-wrap: nowrap;
}

.modal-search-result-title {
    font-weight: bold;
    color: #1a73e8;
    text-decoration: none;
}

.modal-search-result-title:hover {
    text-decoration: underline;
}
</style>


  

  
  <hr />
  Â© 
<a href="https://kaikaixixi.xyz"  target="_blank" rel="noopener noreferrer" >SHUAIKAI</a>
 2021 &ndash; 2025 | ğŸ¨
<a href="https://github.com/captainwc/ksimple"  target="_blank" rel="noopener noreferrer" >KSimple</a>
  

</footer>
</body>

</html>
