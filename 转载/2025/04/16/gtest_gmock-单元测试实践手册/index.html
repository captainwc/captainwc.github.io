<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ | [è½¬è½½](https://imageslr.com/2023/gtest.html) | SHUAIKAI&#39;s Blog</title>
    <link rel="icon" href= /images/favicon.png />
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />

    <link rel="stylesheet" href="/css/custom.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">ä¸»é¡µ</a></li>
      
      <li><a href="/series/">ä¸“æ </a></li>
      
      <li><a href="/categories/">åˆ†ç±»</a></li>
      
      <li><a href="/tags/">æ ‡ç­¾</a></li>
      
      <li><a href="/archives/">å½’æ¡£</a></li>
      
      <li><a href="/search/">æœç´¢</a></li>
      
      <li><a href="/about/">å…³äº</a></li>
      
    </ul>
    <hr/>
    </nav>


<div class="article-meta">
    <h1><span class="article-meta-title">GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ | 
<a href="https://imageslr.com/2023/gtest.html"  target="_blank" rel="noopener noreferrer" >è½¬è½½</a></span></h1>

    <div class="article-meta-info">
        

        
        
        
        

        
        
        
        

        
        

        
        
        
        
        
        
        
        
        

        
        
        
        
        
        
        
        
        

        ğŸ•ºğŸ» Images ğŸ—“ï¸ 2025-04-16 ğŸ—‚ï¸ <a href="/categories/%E5%8D%9A%E5%AE%A2%E5%89%AA%E8%97%8F/">åšå®¢å‰ªè—</a> ğŸ·ï¸ <a href="/tags/googletest/">#GoogleTest</a>
    </div>
</div>

<main>

    

<div class="left-sidebar-btn" id="leftSidebarBtn"><i class="fa-solid fa-list"></i></div>
<div class="left-sidebar-panel" id="leftSidebarPanel">
    
        <div class="sidebar-content">
            
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">ğŸ·ï¸ æ ‡ç­¾</div>
                <div class="tag-blocks">
                    
                    <a href="/tags/googletest" class="tag-block">
                        GoogleTest
                    </a>
                    
                </div>
            </div>
            

            
            

            
            
            
            
            <div class="sidebar-section">
                <div class="sidebar-section-title">ğŸ—‚ï¸ åˆ†ç±»æ–‡ç« </div>
                
                
                <div class="category-group">
                    <div class="category-name">åšå®¢å‰ªè—</div>
                    <ul class="article-list">
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/06/10/22%E7%A7%8Dc-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/" class="article-link">
                                
                                <span class="article-title">C++ é«˜å¹¶å‘æœåŠ¡å™¨æ¨¡å‹å®ç° | [è½¬è½½](https://github.com/linkxzhou/mylib/blob/master/c%2B%2B/concurrency_server/README.md)</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/05/04/epoll%E8%AF%A6%E8%A7%A3/" class="article-link">
                                
                                <span class="article-title">Epollè¯¦ç»†ä»‹ç» | [è½¬è½½](https://mp.weixin.qq.com/s/pahk8ay5MvkvONeg1-M82w)</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/05/04/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E8%AF%A6%E8%A7%A3/" class="article-link">
                                
                                <span class="article-title">å…±äº«å†…å­˜è¯¦è§£ | [è½¬è½½](https://mp.weixin.qq.com/s/wOySn0oi0xXREpFRBXCMmQ)</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/04/17/asio-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/" class="article-link">
                                
                                <span class="article-title">Asio åŸºæœ¬ä½¿ç”¨ä¸æ ¸å¿ƒè®¾è®¡æ€æƒ³ | [è½¬è½½](https://blog.csdn.net/gma999/article/details/143983035)</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/04/16/googletest%E4%B8%8Egmock%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/" class="article-link">
                                
                                <span class="article-title">GoogleTestä¸gMockè¿›é˜¶æŒ‡å— | [è½¬è½½](https://www.cnblogs.com/jinyunshaobing/p/16804309.html)</span>
                            </a>
                        </li>
                        
                        
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/04/15/docker-%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%AE%B9%E5%99%A8%E9%97%B4%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/" class="article-link">
                                
                                <span class="article-title">Docker ç½‘ç»œæ¨¡å¼è¯¦è§£åŠå®¹å™¨é—´ç½‘ç»œé€šä¿¡ | [è½¬è½½](https://www.cnblogs.com/mrhelloworld/p/docker11.html)</span>
                            </a>
                        </li>
                        
                        
                        
                        <li class="article-item">
                            <a href="/%E8%BD%AC%E8%BD%BD/2025/04/15/%E4%B8%87%E5%AD%97%E9%95%BF%E6%96%87%E7%AE%80%E8%BF%B0apollo%E4%B8%ADcyberrt%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" class="article-link">
                                
                                <span class="article-title">ä¸‡å­—é•¿æ–‡ç®€è¿°Apolloä¸­CyberRTæ¡†æ¶åŸºç¡€æ¦‚å¿µ | [è½¬è½½](https://zhuanlan.zhihu.com/p/479518561#CTZ_DEFAULT)</span>
                            </a>
                        </li>
                        
                        
                    </ul>
                </div>
                
            </div>
            
        </div>
    </div>

    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btn = document.getElementById('leftSidebarBtn');
            const panel = document.getElementById('leftSidebarPanel');
            let hoverTimeout;

            
            btn.addEventListener('mouseenter', () => {
                clearTimeout(hoverTimeout);
                panel.classList.add('show');
            });

            panel.addEventListener('mouseenter', () => clearTimeout(hoverTimeout));

            [btn, panel].forEach(el => {
                el.addEventListener('mouseleave', () => {
                    hoverTimeout = setTimeout(() => {
                        panel.classList.remove('show');
                    }, 200);
                });
            });
        });
    </script>
    

    <style>
        

         
        .left-sidebar-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 980;
            cursor: pointer;
            padding: 6px 10px;
            background: #EFEFEF;
            border-radius: 8px;
            transition: background 0.3s;
            color: #999;
            opacity: 0.7;
        }

        .left-sidebar-btn:hover {
            background: #BEC2B3;
        }

        .left-sidebar-panel {
            border-radius: 8px;
            display: none;
            position: fixed;
            top: 66px;
            left: 20px;
            max-width: 360px;
            min-width: 280px;
            max-height: 80vh;
            overflow-y: auto;
            background: white;
            border: 1px solid #eee;
            padding: 10px 5px 10px 15px;
            z-index: 970;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .left-sidebar-panel.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }

            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        

        .sidebar-content {
            padding: 15px 12px;
        }

        .sidebar-section {
            margin-bottom: 1.2rem;
        }

        .sidebar-section-title {
            font-size: 1rem;
            color: #2d3842;
            margin: 0 0 0.6rem 0;
            padding-bottom: 0.3rem;
            font-family: "LXGW WenKai";
            font-weight: bold;

             
            
            border-bottom: 2px dashed #cfcfcf;
            
        }

         
        .tag-blocks {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
        }

        .tag-block {
            display: inline-block;
            background: #F6F6F6;
            color: #666;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            border: 1px solid #e0e0e0;
        }

        .tag-block:hover {
            background: #2e59a7;
            color: white;
            transform: translateY(-1px);
        }

         
        .series-group,
        .category-group {
            margin-bottom: 0.8rem;
        }

        .series-name,
        .category-name {
            font-size: 0.9rem;
            color: #666;
            margin: 0 0 0.4rem 0;
            font-weight: bold;
            font-family: "LXGW WenKai";
        }

         
        .article-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .article-item {
            margin-bottom: 0.3rem;
        }

        .article-link {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.4rem;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .article-link:hover {
            background: #f8f9fa;
            border-left-color: #2e59a7;
            transform: translateX(3px);
        }

        .article-date {
            font-size: 0.8rem;
            color: #999;
            font-family: "LXGW WenKai";
            flex-shrink: 0;
            width: 45px;
            text-align: left;
        }

        .article-title {
            flex: 1;
            font-size: 0.9rem;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

         
        

        .left-sidebar-panel::-webkit-scrollbar {
            display: none;
        }

        .left-sidebar-panel {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        

         
        @media (max-width: 768px) {
        
        }
    </style>

    


<div class="toc-btn" id="tocBtn"><i class="fa-solid fa-bars-staggered"></i></div>
<div class="toc-panel" id="tocPanel"></div>


<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        
        const btn = document.getElementById('tocBtn');
        const panel = document.getElementById('tocPanel');
        let hoverTimeout;

        
        btn.addEventListener('mouseenter', () => {
            clearTimeout(hoverTimeout);
            generateToc(panel);
            panel.classList.add('show');

            
            requestAnimationFrame(() => {
                const headers = Array.from(document.querySelectorAll('h2, h3, h4, h5, h6'));
                let activeHeader = null;
                let minDistance = Infinity;

                
                headers.forEach(header => {
                    const rect = header.getBoundingClientRect();
                    const distance = Math.abs(rect.top);
                    if (distance < minDistance) {
                        minDistance = distance;
                        activeHeader = header;
                    }
                });

                
                if (activeHeader) {
                    const activeLink = panel.querySelector(`a[href="#${activeHeader.id}"]`);
                    if (activeLink) {
                        
                        const panelHeight = panel.offsetHeight;
                        const linkOffset = activeLink.offsetTop;
                        const centerPosition = linkOffset - (panelHeight / 2) + (activeLink.offsetHeight / 2);
                        
                        panel.scrollTo({
                            top: centerPosition,
                            behavior: 'auto'
                        });
                    }
                }
            });
        });

        panel.addEventListener('mouseenter', () => clearTimeout(hoverTimeout));

        [btn, panel].forEach(el => {
            el.addEventListener('mouseleave', () => {
                hoverTimeout = setTimeout(() => {
                    panel.classList.remove('show');
                }, 200);
            });
        });
        

        
        function generateToc(container) {
            if (container.children.length > 0) return;

            const headers = Array.from(document.querySelectorAll('h2, h3, h4, h5, h6'));
            const counts = [0, 0, 0, 0, 0]; 

            headers.forEach(header => {
                const level = parseInt(header.tagName[1]) - 2;
                if (level < 0) return;

                counts[level]++;
                for (let i = level + 1; i < counts.length; i++) counts[i] = 0;
                const number = counts.slice(0, level + 1).join('.');

                
                const numberSpan = document.createElement('span');
                numberSpan.className = 'toc-number';
                numberSpan.textContent = number;

                
                const link = document.createElement('a');
                link.href = `#${header.id}`;
                link.style.paddingLeft = `${level * 12}px`;

                
                link.appendChild(numberSpan);
                link.appendChild(document.createTextNode(header.textContent));

                container.appendChild(link);
            });
        }
    });
</script>

<style>
    

     
    .toc-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 980;
        cursor: pointer;
        padding: 6px 10px;
        background: #EFEFEF;
        border-radius: 8px;
        transition: background 0.3s;
        color: #999;
        opacity: 0.7;
    }

    .toc-btn:hover {
        background: #BEC2B3;
    }

    .toc-panel {
        border-radius: 8px;
        display: none;
        position: fixed;
        top: 66px;
        right: 20px;
        max-width: 360px;
        min-width: 200px;
        max-height: 80vh;
        overflow-y: auto;
        background: white;
        border: 1px solid #eee;
        padding: 10px 5px 10px 15px;
        z-index: 970;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        list-style: none;
    }

    .toc-panel.show {
        display: block;
        animation: fadeIn 0.3s ease-out;
    }

     
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateX(10px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    

     
    .toc-number {
        vertical-align: middle;
        margin-right: 6px;
        font-family: "LXGW WenKai";
        font-size: 0.85rem;
    }

     
        

    .toc-panel a {
        
            display: block;
            padding: 4px 0;
            text-decoration: none;
            color: #333;
            white-space: nowrap;
        }

        

        .toc-panel a:hover {
        

                color: #007bff;
            }

        
</style>


    
    
    
        <h1 id="gtest--gmock-å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ">GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ</h1>

          <link rel="stylesheet" href="/css/vendors/admonitions.e8f9d71468684b38dcc32a3631441f47b6ee45ce52f3bcc31201e76cc2b0a193.css" integrity="sha256-6PnXFGhoSzjcwyo2MUQfR7buRc5S87zDEgHnbMKwoZM=" crossorigin="anonymous">
  <div class="admonition warning">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480L40 480c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24l0 112c0 13.3 10.7 24 24 24s24-10.7 24-24l0-112c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg>
      <span>å£°æ˜</span>
    </div>
      <div class="admonition-content">
        <ul>
<li>æœ¬æ–‡ç”±æ’ä»¶
<a href="https://chromewebstore.google.com/detail/markdownload-markdown-web/pcmpcfapbekmbjjkdalcgopdkipoggdi?pli=1"  target="_blank" rel="noopener noreferrer" >Markdown Web Clipper</a>
è‡ªåŠ¨æå–ç½‘é¡µæ­£æ–‡è€Œæ¥ï¼Œå¹¶æœªè·å–åŸä½œè€…æˆæƒï¼</li>
<li>æœ¬æ–‡ä»…ä½œä¸ªäººå­˜æ¡£å­¦ä¹ ä½¿ç”¨ï¼Œå¦‚æœ‰ä»»ä½•ç–‘é—®/éœ€æ±‚è¯·æŸ¥çœ‹
<a href="https://imageslr.com/2023/gtest.html"  target="_blank" rel="noopener noreferrer" >åŸæ–‡</a>
ï¼</li>
<li>å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»æœ¬äººç«‹åˆ»åˆ é™¤ï¼</li>
<li>åŸæ–‡é“¾æ¥: 
<a href="https://imageslr.com/2023/gtest.html"  target="_blank" rel="noopener noreferrer" >ğŸ’»ã€C++ã€‘ç ”å‘åŸºæœ¬åŠŸ - GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ</a>
</li>
</ul>
      </div>
  </div>
<hr>
<h2 id="ä¸€å‰è¨€">ä¸€ã€å‰è¨€</h2>
<p>ğŸ“Œ æœ¬æ–‡æ¥è‡ª Ads Infra å†…éƒ¨åˆ†äº«ï¼Œ
<a href="https://imageslr.com/ads-infra"  target="_blank" rel="noopener noreferrer" >æ¬¢è¿åŠ å…¥ ğŸ‘‰ğŸ»</a>
</p>
<p>ä½œä¸ºæ¶æ„éƒ¨é—¨ï¼Œæˆ‘ä»¬çš„å¾ˆå¤šæ ¸å¿ƒä»“åº“éƒ½æ˜¯ C++ ç¼–å†™ï¼Œç›®å‰åŸºæœ¬éƒ½æœ‰ 80% çš„å¢é‡å•æµ‹è¦†ç›–ç‡å¡ç‚¹ã€‚ç¼–å†™å•æµ‹çš„å¥½å¤„ä¸è¨€è€Œå–»ï¼šé€šè¿‡æ„é€ å„ç§ caseï¼Œå¯ä»¥å‘ç°ç©ºæŒ‡é’ˆã€å¤§æ•°è¶Šç•Œç­‰è‚‰çœ¼ä¸å®¹æ˜“å‘ç°çš„ bugã€‚æ­¤å¤–ï¼Œå•æµ‹ä¹Ÿå¯ä»¥åœ¨ä¸å¼•æµçš„æƒ…å†µä¸‹ï¼Œæµ‹è¯•åŠŸèƒ½æ˜¯å¦æ­£ç¡®ã€‚å› æ­¤ï¼Œç¼–å†™å•æµ‹æ˜¯å¿…è¦çš„ï¼Œ<strong>ä¸ºæ–°å¢ä»£ç è¡¥å……å•æµ‹æ˜¯æ¯ä¸ªç ”å‘åŒå­¦çš„åŸºæœ¬åŠŸ</strong>ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<strong>C++ ç¼–å†™å•æµ‹ä¹Ÿæ˜¯æœ€éº»çƒ¦çš„</strong>ã€‚æ ¹æ®æ—¥å¸¸è§‚å¯Ÿï¼Œå¤§éƒ¨åˆ†åŒå­¦æ²¡æœ‰ç³»ç»Ÿåœ°å†™è¿‡å•æµ‹ï¼ŒåŸºæœ¬ä¾èµ–ç…§æŠ„ç°æœ‰ä»£ç ï¼Œå•æµ‹å†™å¾—æ…¢ï¼Œä¸”ä¸æ ‡å‡†ã€‚æ­¤å¤–ï¼Œæ²¡æœ‰æŒæ¡å¸¸è§çš„è°ƒè¯•æŠ€å·§ï¼Œä¸»è¦é€šè¿‡ <code>cout</code> é€è¡Œæ‰“æ—¥å¿—å’Œé‡æ–°ç¼–è¯‘æ¥å®šä½é—®é¢˜ï¼Œè¿›ä¸€æ­¥é™ä½äº†å•æµ‹ç¼–å†™æ•ˆç‡ã€‚</p>
<p>æœ¬æ–‡æ—¨åœ¨è§£å†³ä¸Šè¿°é—®é¢˜ï¼š</p>
<ul>
<li>æœ¬æ–‡çš„<strong>å—ä¼—</strong>ï¼šå¼€å‘è¿‡ C++ æ¨¡å—ã€çŸ¥é“ GTest / GMock çš„åŸºæœ¬ä½¿ç”¨ã€ç¼–å†™è¿‡å•æµ‹ä»£ç ã€èƒ½å®Œæˆç®€å•åœºæ™¯çš„å•æµ‹éœ€æ±‚ã€ä½†å¯¹äºå¤æ‚çš„ä»£ç åˆ™æ— ä»ä¸‹æ‰‹çš„åŒå­¦ï¼›å†™å•æµ‹æ„Ÿè§‰å¾ˆä¸çˆ½ã€çŸ¥é“ç—›ç‚¹åœ¨å“ªå„¿ã€ä½†ä¸çŸ¥é“å¦‚ä½•è§£å†³çš„åŒå­¦ï¼›å¹³æ—¶ review ä»£ç åªçœ‹ä¸šåŠ¡é€»è¾‘ã€ä¸çœ‹å•æµ‹åˆç†æ€§çš„ reviewer åŒå­¦ã€‚</li>
<li>æœ¬æ–‡çš„<strong>å†…å®¹</strong>ï¼šåˆ†äº« GTestã€GMock çš„æ ¸å¿ƒç”¨æ³•ã€å¸¸ç”¨æŠ€å·§ + å•æµ‹ç¼–å†™çš„æ€è·¯ + GDB è°ƒè¯•æ–¹æ³•ã€‚åªè®²æœ€å¿…è¦çš„ã€æœ€å¸¸ç”¨çš„å†…å®¹ï¼Œèƒ½è¦†ç›–å¤§éƒ¨åˆ†åœºæ™¯çš„å•æµ‹éœ€æ±‚ã€‚ä¸è®²èŠ±æ´»å„¿ï¼Œä½†ä¼šå¼•ç”¨å¤–éƒ¨æ–‡æ¡£ä¾›æ‰©å±•é˜…è¯»ã€‚</li>
<li>æœ¬æ–‡çš„<strong>ç›®æ ‡</strong>ï¼š(1) é€šè¿‡åˆ†äº«ä¸Šè¿°å†…å®¹ï¼Œè®©å¤§å®¶ç³»ç»ŸæŒæ¡å•æµ‹ç¼–å†™å’Œè°ƒè¯•æ–¹æ³•ï¼Œ<strong>å†™èµ·æ¥æ›´ä¸æ»‘</strong>ï¼ŒæŸ¥é—®é¢˜æ›´é«˜æ•ˆã€‚(2) å¯¹é½è®¤çŸ¥ï¼Œ<strong>è®©å•æµ‹çœŸæ­£å‘æŒ¥ä½œç”¨</strong>ã€‚çŸ¥é“ä»€ä¹ˆæ˜¯æ­£ç¡®çš„ã€æœ‰æ•ˆçš„ã€å¥½çš„å•æµ‹ï¼Œå¹¶å†™å‡ºè¿™æ ·çš„å•æµ‹ã€‚çŸ¥é“ä»€ä¹ˆæ˜¯æ— æ•ˆçš„ã€å·®çš„å•æµ‹ï¼Œå¹¶é¿å…å†™å‡º / åˆå…¥è¿™æ ·çš„å•æµ‹ã€‚ä»¥å¯¹å¾…çº¿ä¸Šä»£ç çš„æ ‡å‡†æ¥å¯¹å¾…å•æµ‹ã€‚</li>
</ul>
<h2 id="äºŒhello-worldä»ä¸€ä¸ªå•æµ‹ç¤ºä¾‹å¼€å§‹">äºŒã€Hello, worldï¼šä»ä¸€ä¸ªå•æµ‹ç¤ºä¾‹å¼€å§‹</h2>
<p>ä¸ºä¸‹é¢è¿™æ®µä»£ç ç¼–å†™å•æµ‹ï¼š</p>
<pre><code class="language-cpp">int check_threshold(RequestContext ctx, Ad ad) {
    if (ad.pricing == CPT) {
        return -1;
    }
    if (ad.pricing == CPM) {
        if (ctx.params.use_stable_thresh || ad.use_stable_thresh()) {
            return 2;
        }
        return ctx.get_threshold(ad);
    }
    ...
}
</code></pre>
<p>ç¼–å†™å‡ºæ¥çš„å•æµ‹ä»£ç å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="language-cpp">// Case 1
TEST(ChecksThresholdTest, CheckThreshForCPT) {
    // 1. æ„é€ è¾“å…¥
    RequestContext ctx;
    Ad ad;
    ad.pricing = CPT;

    // 2. æ£€æŸ¥è¾“å‡º
    EXPECT_EQ(check_threshold(ctx, ad), -1);
}

// Case 2
TEST(CheckThresholdTest, CheckThreshForCPM) {
    // 1. æ„é€ è¾“å…¥
    MockRequestContext ctx;  // è¿™æ˜¯ä¸€ä¸ª GMock å¯¹è±¡

    // ä½¿ç”¨å¤§æ‹¬å·åˆ†éš”ä¸åŒ case
    {
        Ad ad;
        ad.pricing = CPM;
        ctx.params.use_stable_thresh = true;
        EXPECT_EQ(check_threshold(ctx, ad), 2);
        ctx.params.use_stable_thresh = false;  // reset
    }

    // ä¸Šé¢å¯¹äº if(a||b) çš„åˆ†æ”¯æ¥è¯´ï¼Œåªè¾¾åˆ°äº† 50% åˆ†æ”¯è¦†ç›–ç‡
    // å°è¯•è¾¾åˆ° 100% è¦†ç›–ç‡
    {
        Ad ad;
        ad.pricing = CPM;
        ad.should_use_stable_thresh = true; // å‡è®¾ ad.use_stable_thresh() å‡½æ•°å†…éƒ¨ç”¨äº†è¿™ä¸ªå­—æ®µæ¥åˆ¤æ–­
        ASSERT_TRUE(ad.use_stable_thresh()); // ä¸Šä¸€è¡Œä¿®æ”¹æ˜¯ä¸ºäº†æ§åˆ¶è¿™ä¸ªå‡½æ•°çš„ç»“æœï¼Œæ‰€ä»¥æœ€å¥½ ASSERT ä¸€ä¸‹
        EXPECT_EQ(check_threshold(ctx, ad), 2);
    }

    // é»˜è®¤åˆ†æ”¯
    {
        Ad ad;
        ad.pricing = CPM;
        EXPECT_CALL(ctx, get_threshold).WillOnce(Return(100));
        EXPECT_EQ(check_threshold(ctx, ad), 100);
    }
}
</code></pre>
<p>æ¶‰åŠåˆ°çš„æ–¹é¢ï¼š</p>
<ul>
<li>æ„é€ è¾“å…¥ï¼šæ‰‹åŠ¨</li>
<li>æ£€æµ‹è¾“å‡ºï¼šEXPECT</li>
<li>æ§åˆ¶å¤–éƒ¨å‡½æ•°çš„è¿”å›å€¼ï¼šEXPECT_CALL</li>
<li>åˆ†æ”¯è¦†ç›–ç‡ï¼šå¯¹äº <code>if(a||b)</code>ï¼Œéœ€è¦åˆ†åˆ«æ„é€  <code>a == true</code> å’Œ <code>b == true</code> ä¸¤ä¸ª caseã€‚</li>
</ul>
<h2 id="ä¸‰gtest">ä¸‰ã€GTest</h2>
<h3 id="åŸºæœ¬æ¦‚å¿µtest-suitetest-case">åŸºæœ¬æ¦‚å¿µï¼šTest Suiteã€Test Case</h3>
<h4 id="test-suite">Test Suite</h4>
<pre><code class="language-cpp">TEST(TestSuiteName, TestCaseName) {
    // å•æµ‹ä»£ç 
    EXPECT_EQ(func(0), 0);
}
</code></pre>
<ul>
<li><code>TestSuiteName</code> ç”¨æ¥æ±‡æ€» test caseï¼Œç›¸å…³çš„ test case åº”è¯¥æ˜¯ç›¸åŒçš„ <code>TestSuiteName</code>ã€‚ä¸€ä¸ªæ–‡ä»¶é‡Œåªèƒ½æœ‰ä¸€ä¸ª <code>TestSuiteName</code>ï¼Œå»ºè®®å‘½åä¸ºè¿™ä¸ªæ–‡ä»¶æµ‹è¯•çš„ç±»åã€‚</li>
<li><code>TestCaseName</code> æ˜¯æµ‹è¯•ç”¨ä¾‹çš„åç§°ã€‚å»ºè®®æœ‰æ„ä¹‰ï¼Œæ¯”å¦‚â€œè¢«æµ‹è¯•çš„å‡½æ•°åç§°â€ï¼Œæˆ–è€…è¢«æµ‹è¯•çš„å‡½æ•°åçš„ä¸åŒè¾“å…¥çš„æƒ…å†µã€‚</li>
<li><code>TestSuiteName_TestCaseName</code> çš„ç»„åˆåº”è¯¥æ˜¯å”¯ä¸€çš„ã€‚</li>
<li>GTest ç”Ÿæˆçš„ç±»åæ˜¯å¸¦ä¸‹åˆ’çº¿çš„ï¼Œæ‰€ä»¥ä¸Šé¢è¿™äº›åå­—é‡Œä¸å»ºè®®æœ‰ä¸‹åˆ’çº¿ã€‚</li>
</ul>
<h4 id="test-case">Test Case</h4>
<p>ä¸€ä¸ª <code>TEST(Foo, Bar){...}</code> å°±æ˜¯ä¸€ä¸ª Test Caseã€‚è€ƒè™‘åˆ°æ„é€ è¾“å…¥æœ‰æˆæœ¬ï¼Œé€šå¸¸ä¸€ä¸ª <code>TEST(Foo, Bar)</code> é‡Œä¼šåå¤ä¿®æ”¹è¾“å…¥ï¼Œæ„é€ å¤šä¸ª caseï¼Œæµ‹è¯•ä¸åŒçš„æ‰§è¡Œæµç¨‹ã€‚è¿™é‡Œå»ºè®®<strong>ç”¨å¤§æ‹¬å·åˆ†éš”ä¸åŒçš„ case</strong>ï¼Œæ•´ä½“æ›´æ¡ç†ã€‚å¦ä¸€ä¸ªå¥½å¤„åœ¨äºï¼š<strong>æ¯ä¸ªå˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»…é™äºå¤§æ‹¬å·å†…</strong>ã€‚è¿™æ ·å°±å¯ä»¥åå¤ä½¿ç”¨ç›¸åŒçš„å˜é‡åï¼Œè€Œä¸ç”¨ç»™å˜é‡åç¼–å·ã€‚</p>
<pre><code class="language-cpp">TEST(Foo, bar) {
    // case 1: enable = true
    {
        Context ctx;
        params.enable_refresh = true;
        ASSERT_EQ(ctx-&gt;is_enable_fresh(), true);
    }

    // case 2: enable = false
    {
        Context ctx;
        params.enable_refresh = false;
        ASSERT_EQ(ctx-&gt;is_enable_fresh(), false);
    }
}
</code></pre>
<p>æ­¤å¤–ï¼Œå¦‚æœå¾…æµ‹å‡½æ•°ååˆ†å¤æ‚ï¼Œå»ºè®®æ‹†åˆ†å¤šä¸ª <code>TEST(Foo, Bar){...}</code>ï¼Œé¿å… Test Case ä»£ç è†¨èƒ€ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-cpp">// å¾…æµ‹å‡½æ•°
int foo(Ad ad) {
    if (!ad)
        return -1;
    switch(ad.pricing) {
        case CPT:
            ...
        case GD:
            ...
    }
}
// è¾“å…¥ä¸ºç©º
TEST(Foo, IsNil) {
    ...
}

// è¾“å…¥æ˜¯ CPT å¹¿å‘Š
TEST(Foo, IsCpt) {
    ...
}

// è¾“å…¥æ˜¯ GD å¹¿å‘Š
TEST(Foo, IsGd) {
    ...
}
</code></pre>
<h3 id="å–„ç”¨-test_fé¿å…å†™é‡å¤çš„ä»£ç ">å–„ç”¨ TEST_Fï¼Œé¿å…å†™é‡å¤çš„ä»£ç </h3>
<p>GTest æä¾›äº†å¤šç§æµ‹è¯•å®ï¼Œå…¶ä¸­æœ€ä¸ºå¸¸ç”¨çš„æ˜¯ <code>TEST</code>ã€<code>TEST_F</code>ï¼Œå®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ol>
<li><code>TEST</code>ï¼šè¿™æ˜¯æœ€åŸºæœ¬çš„æµ‹è¯•å®ï¼Œä»£è¡¨ä¸€ä¸ªæœ€å°æµ‹è¯•å•å…ƒã€‚åœ¨æ‰§è¡Œ <code>TEST</code> å®æ—¶ï¼Œgtest ä¼šä¸ºæ¯ä¸ª <code>TEST</code> å®šä¹‰ä¸€ä¸ªç‹¬ç«‹çš„å®ä¾‹ï¼Œä½¿å…¶äº’ç›¸éš”ç¦»ï¼Œé¿å…å¯¹åŒä¸€ä¸ªå˜é‡è¿›è¡Œä¿®æ”¹æˆ–å…±äº«ç­‰å¯èƒ½å¸¦æ¥çš„å‰¯ä½œç”¨ã€‚</li>
<li><strong><code>TEST_F</code></strong>ï¼šè¿™æ˜¯ TestFixture çš„æµ‹è¯•å®ã€‚TestFixture æ˜¯ä¸€ä¸ªç±»ï¼Œå¯ä»¥åœ¨<strong>å¤šä¸ª<strong><strong>æµ‹è¯•ç”¨ä¾‹</strong></strong>ä¹‹é—´å…±äº«æ•°æ®ç»“æ„æˆ–æ–¹æ³•</strong>ã€‚å¯¹äºåŒä¸€ä¸ª Test Suite çš„æ‰€æœ‰ Test Casesï¼Œä¼šåˆ›å»ºä¸€ä¸ª TestFixture å¯¹è±¡ï¼Œå…¶ SetUp å‡½æ•°ä¼šåœ¨æ¯ä¸ª Test Case æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ï¼Œè€Œ TearDown å‡½æ•°åˆ™ä¼šåœ¨æ¯ä¸ª Test Case æ‰§è¡Œä¹‹åè¢«è°ƒç”¨ã€‚</li>
</ol>
<p>ä½¿ç”¨ Test Fixture Classï¼Œå¯ä»¥é¿å…å†™é‡å¤çš„ä»£ç ï¼š</p>
<ul>
<li>å°†å…±äº«çš„å˜é‡ä½œä¸ºæˆå‘˜å˜é‡ï¼Œå¯ä»¥åœ¨ test case ä¸­ç›´æ¥è®¿é—®ï¼›å˜é‡åˆå§‹åŒ–ã€å›æ”¶é€»è¾‘æ”¾åˆ° SetUp()ã€TearDown()</li>
<li>æä¾›å…¬å…±æ–¹æ³•ï¼Œå¯ä»¥åœ¨ test case ä¸­ç›´æ¥ä½¿ç”¨</li>
</ul>
<p>ç¤ºä¾‹ä»£ç ï¼š</p>
<pre><code class="language-cpp">class FooTest : public ::testing::Test {
protected:
  // åœ¨æ¯ä¸ª Test Case è¿è¡Œå¼€å§‹å‰ï¼Œéƒ½ä¼šè°ƒç”¨ SetUpï¼Œè¿™é‡Œå¯ä»¥åˆå§‹åŒ–
  void SetUp() override {
    ctx = RequestContext(&quot;123&quot;);
  }

  // åœ¨æ¯ä¸ª Test Case è¿è¡Œç»“æŸåï¼Œéƒ½ä¼šè°ƒç”¨ TearDown
  void TearDown() override {}

  // æ‰€æœ‰ Test Case éƒ½å¯ä»¥ç›´æ¥è®¿é—®è¿™äº›å˜é‡å’Œæ–¹æ³•
  Ad new_ad() { return Ad(ctx); }
  RequestContext ctx;
};

TEST_F(FooTest, enable_foo) { // è¿™é‡Œä¼šåˆå§‹åŒ– FooTest å¯¹è±¡
  ctx-&gt;params.enable_foo = true; // å¯ä»¥è®¿é—® FooTest ä¸­çš„å˜é‡
  auto item = new_ad(); // å¯ä»¥è°ƒç”¨ FooTest ä¸­çš„æ–¹æ³•
  ...
}

// æ¯ä¸ª test case éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œè¿™é‡Œä¼šåˆå§‹åŒ–å¦ä¸€ä¸ª FooTest å¯¹è±¡
TEST_F(FooTest, OnTestProgramStart) {
  // ...
}
</code></pre>
<p>å®é™…ä½¿ç”¨æŠ€å·§ï¼š</p>
<ul>
<li>å…±äº«ä¸€äº›å˜é‡ï¼Œæ¯”å¦‚é¢„å…ˆåˆå§‹åŒ–å¥½å•æµ‹ä¾èµ–çš„ Context å¯¹è±¡</li>
<li>å°è£…ä¸€äº›å…¬å…±æ–¹æ³•ï¼Œå°¤å…¶æ˜¯æ„é€ é€šç”¨æ•°æ®å¯¹è±¡çš„æ–¹æ³•</li>
<li>æ´¾ç”Ÿæ›´å¤šå­ç±»ï¼š
<ul>
<li>å»ºè®®æ¯ä¸ªæœåŠ¡æœ‰ä¸€ä¸ªå…¬å…±çš„ <code>BaseTestFixture</code>ï¼Œç»§æ‰¿ <code>::testing::Test</code>ï¼Œå°è£…å…¨å±€é€šç”¨çš„æ–¹æ³•</li>
<li>å…¶ä»–å•æµ‹å¯ä»¥å†ç»§æ‰¿ <code>BaseTestFixture</code>ï¼Œæä¾›æŸä¸ªæµ‹è¯•åœºæ™¯ä¸‹å…±äº«å˜é‡å’Œæ–¹æ³•</li>
</ul>
</li>
</ul>
<h3 id="æ–­è¨€expect-ä¸-assert-å®">æ–­è¨€ï¼šEXPECT ä¸ ASSERT å®</h3>
<p>ç”¨æ¥åˆ¤æ–­æŸä¸ªå˜é‡çš„å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å‰è€…åœ¨æ ¡éªŒå¤±è´¥æ—¶ä¼šæ‰“å°å¤±è´¥ä¿¡æ¯ï¼Œç„¶åç»§ç»­è¿è¡Œã€‚åè€…ä¼šç›´æ¥ç»ˆæ­¢ã€‚</p>
<p>ğŸ’¡ <strong>æ­£ç¡®ä½¿ç”¨ ASSERT å’Œ EXPECT å‰ç¼€ï¼š</strong></p>
<ul>
<li>
<p>å¦‚æœæŸä¸ªåˆ¤æ–­ä¸é€šè¿‡æ—¶ï¼Œä¼šå½±å“åç»­æ­¥éª¤ï¼Œè¦ä½¿ç”¨ ASSERTã€‚å¸¸è§çš„æ˜¯ç©ºæŒ‡é’ˆï¼Œæˆ–è€…æ•°ç»„è®¿é—®è¶Šç•Œã€‚</p>
<blockquote>
<p>å¦‚æœæŸä¸ª EXPECT å¤±è´¥ä¼šå¯¼è‡´åç»­ä¸€è¿ä¸² EXPECT å¤±è´¥ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ª EXPECT åº”è¯¥æ¢æˆ ASSERTã€‚è¿™å°±åƒç¼–è¯‘æ—¶çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¾€å¾€åªæœ‰ç¬¬ä¸€ä¸ªæ˜¯æœ‰ç”¨çš„ï¼Œå…¶ä»–é”™è¯¯éƒ½åªæ˜¯åˆ·å±ã€‚</p></blockquote>
</li>
<li>
<p>å…¶ä»–æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ EXPECTï¼Œå°½å¯èƒ½å¤šæµ‹è¯•å‡ ä¸ªç”¨ä¾‹ã€‚</p>
</li>
</ul>
<p>ä¸‹é¢ç½—åˆ—ä¸€äº›æœ€å¸¸ç”¨çš„ EXPECT å®ï¼ŒæŠŠå‰ç¼€æ¢æˆ ASSERT ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚å®Œæ•´åˆ—è¡¨è§
<a href="http://google.github.io/googletest/reference/assertions.html"  target="_blank" rel="noopener noreferrer" >æ–‡æ¡£</a>
ã€‚</p>
<h4 id="1-ä¸€å…ƒ--äºŒå…ƒæ¯”è¾ƒ">(1) ä¸€å…ƒ / äºŒå…ƒæ¯”è¾ƒ</h4>
<ul>
<li><code>EXPECT_TRUE(foo)</code>ã€<code>EXPECT_FALSE(foo)</code>ï¼šåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦æ˜¯ true æˆ– falseã€‚</li>
<li>äºŒå…ƒæ¯”è¾ƒï¼š
<ul>
<li><code>EXPECT_EQ(foo, bar)</code>ï¼šåˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰ã€‚
<ul>
<li>åªè¦é‡è½½äº†<code>==</code>è¿ç®—ç¬¦å°±å¯ä»¥ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥åˆ¤æ–­ä¸¤ä¸ª vector æ˜¯å¦ç›¸ç­‰ã€‚</li>
</ul>
</li>
<li><code>EXPECT_NE(foo, bar)</code>ï¼šåˆ¤æ–­ foo != barã€‚</li>
<li><code>EXPECT_LT(foo, bar)</code>ï¼šfoo &lt; barï¼Œless thanã€‚</li>
<li><code>EXPECT_LE(foo, bar)</code>: foo â‰¤ barï¼Œless or equalã€‚</li>
<li><code>EXPECT_GT(foo, bar)</code>ï¼šfoo &gt; barï¼Œgreater thanã€‚</li>
<li><code>EXPECT_GE(foo, bar)</code>: foo â‰¥ barï¼Œgreater or equalã€‚</li>
</ul>
</li>
</ul>
<h4 id="2-æµ®ç‚¹æ•°æ¯”è¾ƒ">(2) æµ®ç‚¹æ•°æ¯”è¾ƒ</h4>
<ul>
<li>
<p><code>EXPECT_DOUBLE_EQ(foo, 0.1)</code>ï¼šæµ®ç‚¹æ•°æ¯”è¾ƒä¸èƒ½ä½¿ç”¨ <code>EXPECT_EQ</code>ã€‚</p>
</li>
<li>
<p><code>EXPECT_FLOAT_EQ</code>ï¼šåŒä¸Šã€‚</p>
</li>
<li>
<p><code>EXPECT_NEAR(foo, bar, abs_val)</code>ï¼šåˆ¤æ–­ä¸¤ä¸ªæ•°å­—çš„ç»å¯¹å€¼ç›¸å·®æ˜¯å¦å°äºç­‰äº abs_valã€‚</p>
<pre><code class="language-cpp">double pi = 3.141592653589793238;
double approx_pi = 3.14;
EXPECT_NEAR(pi, approx_pi, 0.01);  // æ£€æµ‹ä¸¤ä¸ª Ï€ å€¼ï¼Œå…è®¸è¯¯å·®åœ¨ 0.01 ä»¥å†…
</code></pre>
</li>
</ul>
<h4 id="3-å­—ç¬¦ä¸²æ¯”è¾ƒ">(3) å­—ç¬¦ä¸²æ¯”è¾ƒ</h4>
<ul>
<li>
<p><code>EXPECT_STREQ(foo, &quot;bar&quot;)</code>ï¼šåˆ¤æ–­ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ã€‚è¿™é‡Œæ¯”è¾ƒçš„æ˜¯ C é£æ ¼çš„å­—ç¬¦ä¸²ï¼Œå³ <code>char*</code>ã€‚å¦‚æœæŸä¸ªå¯¹è±¡æ˜¯ <code>std::string</code>ï¼Œéœ€è¦è°ƒç”¨å…¶ <code>c_str()</code> æ–¹æ³•ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡éƒ½æ˜¯ <code>std::string</code>ï¼Œå¯ä»¥ä½¿ç”¨ <code>EXPECT_EQ</code>ã€‚</p>
<pre><code class="language-cpp">std::string str = &quot;hello&quot;;
EXPECT_STREQ(str.c_str(), &quot;hello&quot;);
</code></pre>
</li>
<li>
<p><code>EXPECT_STRNE</code>ï¼šä¸ç›¸ç­‰ã€‚</p>
</li>
<li>
<p><code>EXPECT_STRCASEEQ</code>ï¼šå¿½ç•¥å¤§å°å†™ï¼Œæ˜¯å¦ç›¸ç­‰ã€‚</p>
</li>
<li>
<p><code>EXPECT_STRCASENE</code>ï¼šå¿½ç•¥å¤§å°å†™ï¼Œæ˜¯å¦ç›¸ç­‰ã€‚</p>
</li>
</ul>
<h4 id="4-å…¶ä»–">(4) å…¶ä»–</h4>
<ul>
<li>
<p><code>EXPECT_THROW</code>/<code>EXPECT_NO_THROW</code>ï¼šå¤„ç†å¼‚å¸¸ï¼Œä¸è¦è‡ªè¡Œ<code>try-catch</code>ã€‚</p>
</li>
<li>
<p><code>EXPECT_THAT</code>ï¼šè¿™å®é™…ä¸Šæ˜¯ GMock æä¾›çš„å®ï¼Œéœ€è¦å’Œ 
<a href="#matcher" >åŒ¹é…å™¨ Matcher</a>
 é…åˆä½¿ç”¨ï¼Œè¯¦è§ä¸‹æ–‡ã€‚è¿™æ˜¯<strong>å†™å‡ºä¼˜é›…å•æµ‹çš„å¿…å¤‡æŠ€èƒ½</strong>ã€‚</p>
</li>
<li>
<p><code>EXPECT_CALL</code>ï¼šåŒæ ·æ˜¯ GMock æä¾›çš„å®ï¼Œåˆ¤æ–­å‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°ï¼Œè¯¦è§ä¸‹æ–‡ã€‚</p>
</li>
<li>
<p><code>EXPECT_PRED(func, arg1, arg2, ...)</code>ï¼šè‡ªå®šä¹‰ä¸€ä¸ªè¿”å› bool çš„è°“è¯ï¼Œä¼ ç»™è¯¥è°“è¯ä¸€ç³»åˆ—å‚æ•°ï¼Œåˆ¤æ–­æ˜¯å¦è¿”å› trueã€‚å¦‚æœå¤±è´¥ï¼Œä¼šä¾æ¬¡æ‰“å°ä¼ å…¥çš„å‚æ•°å€¼ã€‚</p>
<pre><code class="language-cpp">std::vector&lt;int&gt; vec = {1, 2, 3};
EXPECT_PRED([](const std::vector&lt;int&gt;&amp; v) { return v.size() == 3; }, vec);
</code></pre>
</li>
</ul>
<h4 id="æ–­è¨€å¤±è´¥æ—¶è¾“å‡ºè‡ªå®šä¹‰ä¿¡æ¯">æ–­è¨€å¤±è´¥æ—¶è¾“å‡ºè‡ªå®šä¹‰ä¿¡æ¯</h4>
<p>é»˜è®¤å½“ EXPECT æˆ– ASSERT å¤±è´¥æ—¶ï¼ŒGTest ä¼šæ‰“å°é¢„æœŸå€¼å’Œå®é™…å€¼ï¼š</p>
<pre><code class="language-cpp">EXPECT_EQ(4, 3);

/path/to/test.cpp:7: Failure
Expected equality of these values:
  4
  result
    Which is: 3
</code></pre>
<p>ä½†æœ‰æ—¶å€™ï¼Œè¿™äº›ä¿¡æ¯ä¸å¤Ÿå®šä½å…·ä½“çš„å¤±è´¥åŸå› ã€‚å¯ä»¥åƒè¿™æ ·<strong>è¾“å‡ºè‡ªå®šä¹‰æ—¥å¿—</strong>ï¼Œè¿™äº›æ—¥å¿—ä»…åœ¨ EXPECT å¤±è´¥æ—¶æ‰æ‰“å°ï¼š</p>
<pre><code class="language-cpp">for (int i = 0; i &lt; x.size(); i++) {
  EXPECT_EQ(x[i], y[i]) &lt;&lt; &quot;x and y differ at index &quot; &lt;&lt; i;
}
</code></pre>
<p>è¿˜å¯ä»¥<strong>åœ¨ TestFixture ä¸­å°è£… debug å‡½æ•°</strong>ï¼Œè¾“å‡ºæ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œè¢«æµ‹å¯¹è±¡ä¸­åŒ…å«äº†ä¸€äº›ä½å›¾ std::bitsetã€‚åœ¨ EXPECT å¤±è´¥æ—¶æ‰“å°ä½å›¾ä¿¡æ¯ï¼Œæœ‰åŠ©äºæ’æŸ¥å•æµ‹å¤±è´¥çš„åŸå› ï¼š</p>
<pre><code class="language-cpp">class BitsetTest : public BaseTest {
public:
  std::string debug_message() {
      stringstream ss;
      for (const auto&amp; iter : bitset_maps) {
        ss &lt;&lt; &quot;bitset: name=&quot; &lt;&lt; iter.first &lt;&lt; &quot; value=&quot; &lt;&lt; iter.second &lt;&lt; std::endl;
      }
      return ss.string();
  }
}

TEST_F(BitsetTest, validate) {
    // ...
    EXPECT_TRUE(validate(ad, pos)) &lt;&lt; debug_message();
}
</code></pre>
<h2 id="å››gmock">å››ã€GMock</h2>

  <div class="admonition info">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/></svg>
      <span>Info</span>
    </div>
      <div class="admonition-content">
        <p>ä½¿ç”¨GMockè¦å…ˆæ˜ç™½GMockæ˜¯åšä»€ä¹ˆçš„ã€‚å®ƒæ¨¡æ‹Ÿäº†æ¥å£çš„è¡Œä¸ºï¼Œæ‰€ä»¥å¦‚æœä½ éªŒè¯æ¥å£çš„ç»“æœçš„è¯ï¼Œé‚£è‚¯å®šæ€ä¹ˆéªŒè¯éƒ½æ˜¯å¯¹çš„ã€‚è¿™ä¼šæ¥å£è¿˜ä¸å­˜åœ¨å‘¢ï¼Œå®ƒéªŒè¯çš„æ˜¯ä½ çš„å‡½æ•°ä¸æ¥å£çš„äº¤äº’æ–¹å¼ï¼Œæ¯”å¦‚</p>
<ol>
<li><strong>è¢«æµ‹ä»£ç æ˜¯å¦æ­£ç¡®è°ƒç”¨äº†ä¾èµ–æ¥å£</strong>ï¼šéªŒè¯è¢«æµ‹ä»£ç åœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦è°ƒç”¨äº†æ­£ç¡®çš„æ¥å£æ–¹æ³•ã€‚</li>
<li><strong>è°ƒç”¨é¡ºåºæ˜¯å¦ç¬¦åˆé¢„æœŸ</strong>ï¼šéªŒè¯æ–¹æ³•è°ƒç”¨çš„é¡ºåºæ˜¯å¦æ­£ç¡®ã€‚</li>
<li><strong>è°ƒç”¨æ¬¡æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸ</strong>ï¼šéªŒè¯æ–¹æ³•è¢«è°ƒç”¨çš„æ¬¡æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚</li>
<li><strong>è°ƒç”¨å‚æ•°æ˜¯å¦æ­£ç¡®</strong>ï¼šéªŒè¯è°ƒç”¨æ¥å£æ—¶ä¼ é€’çš„å‚æ•°æ˜¯å¦æ­£ç¡®ã€‚</li>
<li><strong>è¢«æµ‹ä»£ç å¯¹æ¥å£è¿”å›å€¼çš„å“åº”æ˜¯å¦æ­£ç¡®</strong>ï¼šæˆ‘ä»¬è®¾ç½®æ¨¡æ‹Ÿè¿”å›å€¼ï¼Œç„¶åéªŒè¯è¢«æµ‹ä»£ç æ˜¯å¦æ­£ç¡®å¤„ç†äº†è¿™äº›è¿”å›å€¼ã€‚</li>
</ol>
      </div>
  </div>

  <div class="admonition idea">
    <div class="admonition-header">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/></svg>
      <span>Idea</span>
    </div>
      <div class="admonition-content">
        <p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å†™æµ‹è¯•çš„æ—¶å€™ï¼Œè„‘è¢‹ç“œå­æ˜¯æ¸…é†’çš„ï¼Œä½ çŸ¥é“ä½ çš„å‡½æ•°<strong>åº”è¯¥</strong>æ€ä¹ˆä½¿ç”¨æ¥å£ã€‚æ¯”å¦‚æ•°æ®åº“è¿æ¥åœºæ™¯ï¼Œä½ å†™å¥½äº†å®¢æˆ·ç«¯ï¼Œä½†æ˜¯æ•°æ®åº“å°è£…ç±»Databaseè¿˜æ²¡æœ‰å®ç°ã€‚ä½ æƒ³éªŒè¯çš„åªæ˜¯ä½ çš„å®¢æˆ·ç«¯è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œ</p>
<p>æ¯”å¦‚ä¸€æ¬¡æ­£ç¡®çš„æŸ¥è¯¢çš„<strong>é¢„æœŸ</strong>è¿‡ç¨‹åº”è¯¥æ˜¯ï¼š</p>
<ol>
<li>è°ƒç”¨<code>connect</code>åˆ›å»ºè¿æ¥</li>
<li>è°ƒç”¨<code>query</code>æŸ¥è¯¢</li>
<li>è°ƒç”¨<code>disconnect</code>é‡Šæ”¾è¿æ¥</li>
</ol>
<p>**é‚£ä¹ˆä½ çš„å‡½æ•°ä¸­æ˜¯å¦è°ƒç”¨äº†ï¼Œä»¥åŠæ˜¯å¦æ˜¯æŒ‰é¡ºåºè°ƒç”¨äº†è¿™äº›å‘¢ï¼Ÿ**å†æ¯”å¦‚ä¸€æ¬¡é”™è¯¯çš„è¿æ¥ï¼Œé‚£ä¹ˆå°±åº”è¯¥æ ¡éªŒéæ³•ï¼Œç„¶åå°±åº”è¯¥è°ƒç”¨æ¥å£ä¸­çš„<code>HandleBadMan</code>å‡½æ•°ï¼Œé‚£ä¹ˆæ˜¯å¦è°ƒç”¨äº†å‘¢ï¼Ÿæ˜ç™½æ²¡ï¼Œé‡ç‚¹ä¸æ˜¯åœ¨æ¥å£çš„ç»“æœæ˜¯å¦æ­£ç¡®ï¼Œä¸æ˜¯éªŒè¯connectå‡½æ•°æ˜¯å¦èƒ½å¸®ä½ è¿æ¥åˆ°æ•°æ®åº“ï¼Œè€Œæ˜¯éªŒè¯ä½ å†™çš„å®¢æˆ·ç«¯ä»£ç ï¼Œæ˜¯å¦æ­£ç¡®æ‰§è¡Œäº†æ¥å£çš„è°ƒç”¨æµç¨‹ã€‚</p>
      </div>
  </div>
<h3 id="åŸç†ä¸ç¤ºä¾‹">åŸç†ä¸ç¤ºä¾‹</h3>
<p>GMock æ˜¯ Google Test æä¾›çš„ä¸€ä¸ª C++ mocking æ¡†æ¶ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºè™šæ‹Ÿçš„å¯¹è±¡å’Œæ–¹æ³•ã€‚GMock çš„åŸç†æ˜¯åˆ©ç”¨ C++ çš„å¤šæ€ç‰¹æ€§ï¼Œè¦†ç›– virtual å‡½æ•°ï¼Œå°†å‡½æ•°è°ƒç”¨è½¬å‘åˆ°ç›¸åº”çš„ mock å‡½æ•°ä¸­ã€‚</p>
<p>GMock åŸºæœ¬ä½¿ç”¨æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç»§æ‰¿è¢« mock çš„ç±»ï¼Œå®šä¹‰ä¸€ä¸ªæ–°çš„ Mock ç±»</li>
<li>ä½¿ç”¨ GMock æä¾›çš„ mock å®ï¼Œç”¨äºå®ç° Mock ç±»çš„æ–¹æ³•</li>
<li>é€šè¿‡ä¸Šé¢çš„ Mock ç±»ï¼Œåˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡</li>
<li>é€šè¿‡ EXPECT_CALL å®ï¼Œæ§åˆ¶æ¨¡æ‹Ÿæ–¹æ³•çš„è¿”å›å€¼</li>
</ol>
<pre><code class="language-cpp">#include &lt;gmock/gmock.h&gt;

class FooInterface {
public:
    virtual int foo(int) { return 3; } // â‘  éœ€è¦å®šä¹‰ä¸ºè™šå‡½æ•°
};

// â‘¡ éœ€è¦å£°æ˜ä¸€ä¸ª Mock ç±»ï¼Œå¹¶å£°æ˜ MOCK_METHOD
class MockFoo: public FooInterface {
public:
    MOCK_METHOD1(foo, int(int)); // è®°å½•å‡½æ•°åå­— + ç±»å‹ä¿¡æ¯åˆ° MockFoo å¯¹è±¡ä¸Š
};

using ::testing::Return;
TEST(FooInterface, foo) {
    MockFoo mockFoo; // â‘¢ éœ€è¦å£°æ˜ Mock å‡ºæ¥çš„å­ç±»
    EXPECT_CALL(mockFoo, foo(3)).Times(1). // è‡ªå®šä¹‰å‡½æ•°è¿”å›å€¼
                WillOnce(Return(10));
    EXPECT_EQ(mockFoo.foo(3), 10); // return 10
}
</code></pre>
<p>ä½¿ç”¨ GMock æœ‰<strong>ä¸¤ä¸ªå‰æ</strong>ï¼š</p>
<p>(1) è¢« Mock çš„æ–¹æ³•å¿…é¡»æ˜¯è™šå‡½æ•°ï¼›</p>
<p>(2) å¿…é¡»æ›¿æ¢æ‰è¢« mock çš„å¯¹è±¡ï¼Œå°†å…¶èµ‹å€¼ä¸º mock å¯¹è±¡ã€‚</p>
<p>å…¶<strong>ä¸è¶³ä¹‹å¤„</strong>ï¼š</p>
<p>(1) ä½¿ç”¨ GMock æ—¶å¿…é¡»å®šä¹‰ä¸€ä¸ª Mock classï¼›</p>
<p>(2) å¦‚æœæƒ³ mock éè™šå‡½æ•°ï¼Œéœ€è¦å˜æ›´å‡½æ•°ç­¾åï¼Œè¿™å¯èƒ½ä¸å¤ªå®‰å…¨ï¼›</p>
<p>(3) å¯¹äºå‡½æ•°å†…éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œæ— æ³•èµ‹å€¼ï¼Œä¹Ÿå°±æ— æ³• mockã€‚</p>
<h3 id="expect_call">EXPECT_CALL</h3>
<p>è¯­æ³•ï¼š</p>
<pre><code class="language-cpp">EXPECT_CALL(mock_object, method(matchers))
    .Times(cardinality)
    .WillOnce(action)
    .WillRepeatedly(action);
</code></pre>
<p>æ¯”å¦‚ä¸‹é¢ä»£ç çš„å«ä¹‰æ˜¯ï¼šè°ƒç”¨ <code>turtle</code> å¯¹è±¡çš„ <code>GetX(string)</code> æ–¹æ³• 5 æ¬¡ï¼Œæ¯æ¬¡ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯â€helloâ€ï¼Œç¬¬ä¸€æ¬¡è¿”å› 100ï¼Œç¬¬äºŒæ¬¡è¿”å› 150ï¼Œä¹‹åå‡ æ¬¡è¿”å› 200ï¼š</p>
<pre><code class="language-cpp">using ::testing::Return;
...
EXPECT_CALL(turtle, GetX(&quot;hello&quot;))
    .Times(5)
    .WillOnce(Return(100))
    .WillOnce(Return(150))
    .WillRepeatedly(Return(200));
</code></pre>
<h4 id="åŸºæ•°åˆ¤æ–­å‡½æ•°è°ƒç”¨æ¬¡æ•°">åŸºæ•°ï¼šåˆ¤æ–­å‡½æ•°è°ƒç”¨æ¬¡æ•°</h4>
<ul>
<li><code>Times(n)</code>ï¼šè°ƒç”¨ n æ¬¡</li>
<li><code>Times(0)</code>ï¼šä¸è¢«è°ƒç”¨</li>
<li><code>Times(AtLeast(n))</code>ï¼šè‡³å°‘è¢«è°ƒç”¨ n æ¬¡</li>
<li><code>WillOnce(action)</code>ï¼šè¢«è°ƒç”¨ 1 æ¬¡ï¼Œæ‰§è¡Œè‡ªå®šä¹‰è¡Œä¸º</li>
<li><code>WillRepeatedly(action)</code>ï¼šè¢«è°ƒç”¨ä»»æ„æ¬¡ï¼Œæ‰§è¡Œè‡ªå®šä¹‰è¡Œä¸º</li>
</ul>
<h4 id="actionæ§åˆ¶è¢«è°ƒç”¨æ—¶çš„è¡Œä¸º">Actionï¼šæ§åˆ¶è¢«è°ƒç”¨æ—¶çš„è¡Œä¸º</h4>
<p><code>Will</code> å¼€å¤´çš„æ¥å£å¯ä»¥ä¼ å…¥ä¸€ä¸ª Action å‚æ•°ï¼Œè®¾ç½® mock å‡½æ•°è¢«è°ƒç”¨æ—¶çš„è¡Œä¸ºã€‚å¸¸ç”¨çš„ï¼š</p>
<ul>
<li>
<p><code>Return</code>ï¼šè¿”å›æŒ‡å®šå€¼ã€‚æ¯”å¦‚ <code>WillOnce(Return(100))</code>ã€‚</p>
</li>
<li>
<p><code>ReturnRef</code>ã€<code>ByRef</code>ï¼š<code>Return</code> ä¸æ”¯æŒè¿”å›å¼•ç”¨ç±»å‹çš„å˜é‡ï¼Œéœ€è¦ç”¨è¿™ä¸¤ä¸ªå®ã€‚</p>
</li>
<li>
<p><code>SetArgReferee&lt;n&gt;(value)</code>ï¼šä¿®æ”¹ä¼ å…¥çš„ç¬¬ n ä¸ªå¼•ç”¨ç±»å‹çš„å‚æ•°çš„å€¼ï¼Œä¸‹æ ‡ n ä» 0 å¼€å§‹ã€‚</p>
<pre><code class="language-cpp">class MockGetter : public Getter {
    public:
    MOCK_METHOD(int, get, (const string&amp;, string&amp;));
};

TEST(MockGetter, SetArgRefereeTest) {
    const std::string key = &quot;foo_key&quot;;
    std::string value;

    MockGetter getter;
    EXPECT_CALL(getter, get(key, _))
        .WillOnce(SetArgReferee&lt;1&gt;(&quot;bar_value&quot;));

    getter.get(key ,value);
    EXPECT_EQ(sum, &quot;bar_value&quot;);
}
</code></pre>
</li>
<li>
<p><code>DoAll(action1, action2, ...)</code>ï¼šæ‰§è¡Œå¤šä¸ª Actionï¼Œæ¯”å¦‚ä¿®æ”¹å‚æ•°çš„å€¼ + è®¾å®šè¿”å›å€¼ï¼š</p>
<pre><code class="language-cpp">EXPECT_CALL(calc, Add(_, _, _))
  .WillOnce(DoAll(SetArgReferee&lt;2&gt;(8), Return(true)));
</code></pre>
</li>
<li>
<p>ç›´æ¥ä¼ å…¥ä¸€ä¸ª lambda å‡½æ•°ï¼Œæˆ–è€… <code>Invoke(function)</code>ï¼šæ‰§è¡Œè‡ªå®šä¹‰çš„å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-cpp">// ä¼ å…¥ lambda å‡½æ•°
EXPECT_CALL(calc, Add).WillOnce([](int a, int b)) {
    return a + b + 1;
});

// ä¼ å…¥å‡½æ•°æŒ‡é’ˆ
int AddFunc(int a, int b) {
    return a + b + 1;
}
EXPECT_CALL(calc, Add(_, _)).WillOnce(Invoke(AddFunc));

// ä¼ å…¥ç±»æ–¹æ³•
class AddHelper {
    public:
    int Add(int a, int b) {
        return a + b + 1;
    }
};
AddHelper helper;
EXPECT_CALL(calc, Add(_, _)).WillOnce(Invoke(&amp;helper, &amp;AddHelper::Add));
</code></pre>
<ul>
<li>Lambda å‡½æ•°çš„ç­¾åå¿…é¡»å’Œè¢« Mock çš„å‡½æ•°ä¸€è‡´ã€‚</li>
<li>Invoke å‡½æ•°å¯æ¥å—ä»»ä½•å¯è°ƒç”¨å¯¹è±¡ä½œä¸ºå‚æ•°ï¼ŒåŒ…æ‹¬å‡½æ•°æŒ‡é’ˆã€å‡½æ•°å¯¹è±¡ã€Lambda è¡¨è¾¾å¼ç­‰</li>
</ul>
</li>
</ul>
<h4 id="matcheråŒ¹é…ä¼ ç»™å‡½æ•°çš„å‚æ•°">Matcherï¼šåŒ¹é…ä¼ ç»™å‡½æ•°çš„å‚æ•°</h4>
<p>Matcher èƒ½å¤Ÿå®ç°åœ¨å¤æ‚åœºæ™¯ä¸‹è¿›è¡Œæ–­è¨€ï¼Œå¯ä»¥è®©æµ‹è¯•ç”¨ä¾‹æ›´åŠ çµæ´»å’Œå¯è¯»ï¼Œæ˜¯å†™å‡ºä¼˜é›…å•æµ‹çš„å¿…å¤‡å·¥å…·ã€‚</p>
<p>Matcher æä¾›äº†ä¸€ç³»åˆ—å¸¸ç”¨çš„æ¯”è¾ƒå‡½æ•°ï¼Œä¾‹å¦‚ Eqã€Neã€Ltã€Gtã€Leã€Ge ç­‰ï¼Œå¯ä»¥æ»¡è¶³ä¸åŒç±»å‹å˜é‡çš„æ¯”è¾ƒã€‚</p>
<p>Matcher æœ‰ä¸¤ä¸ªä½¿ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>
<p>å’Œ EXPECT_CALL é…åˆä½¿ç”¨ï¼Œç”¨äºæ£€æŸ¥ä¼ é€’ç»™å‡½æ•°çš„å‚æ•°å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ</p>
<pre><code class="language-cpp">// æœŸæœ›ç¬¬ä¸€ä¸ªå‚æ•°å¤§äº 2ï¼Œç¬¬äºŒä¸ªå‚æ•°å°äº 6
EXPECT_CALL(calc, Add(Gt(2), Le(6)));
calc.Add(3, 5);  // å¯ä»¥é€šè¿‡æ£€æµ‹
calc.Add(2, 7);  // ä¸èƒ½é€šè¿‡æ£€æµ‹
</code></pre>
</li>
<li>
<p>å’Œ EXPECT_THAT é…åˆä½¿ç”¨ï¼Œç”¨äºæ£€æŸ¥æŸä¸ªå˜é‡çš„å€¼æ˜¯å¦ç¬¦åˆé¢„æœŸ</p>
<pre><code class="language-cpp">// int_foo &gt; 6
EXPECT_THAT(int_foo, Gt(6));

// åˆ¤æ–­ä¸€ä¸ª vector çš„å…ƒç´ å€¼
std::vector&lt;int&gt; result = {1, 2, 5};
EXPECT_THAT(result, ElementsAre(1, 2, Gt(3)));

// åˆ¤æ–­ä¸€ä¸ª unordered_map çš„å…ƒç´ å€¼
std::unordered_map&lt;string, int&gt; result = {{&quot;idt_a&quot;, 1}, {&quot;idt_b&quot;ï¼Œ 2}};
EXPECT_THAT(result, UnorderedElementsAre(Pair(&quot;idt_a&quot;, 1), Pair(&quot;idt_b&quot;, 2)));

// æœŸæœ› foo åŒ…å«å­ä¸² &quot;hello&quot;
EXPECT_THAT(foo, HasSubStr(&quot;hello&quot;));
</code></pre>
</li>
</ol>
<h5 id="é€šé…ç¬¦_atype">é€šé…ç¬¦ï¼š<code>_</code>ï¼Œ<code>A&lt;type&gt;</code></h5>
<p><code>_</code> å¯ä»¥åŒ¹é…ä»»æ„ç±»å‹çš„ä»»æ„å˜é‡ã€‚å®ƒä½äº <code>::testing</code> å‘½åç©ºé—´ä¸‹ã€‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-cpp">using namespace testing;
EXPECT_CALL(calc, Add(_, _)).Times(1);
EXPECT_CALL(calc, Add).Times(1);  // çœç•¥å‚æ•°åˆ—è¡¨ï¼Œå’Œä¸Šé¢ç­‰ä»·
</code></pre>
<p><code>A&lt;type&gt;()</code> æˆ–è€… <code>An&lt;type&gt;()</code> åŒ¹é…ç±»å‹æ˜¯ <code>type</code> çš„ä»»æ„å˜é‡ã€‚å…¶åº”ç”¨åœºæ™¯ä¸»è¦æ˜¯åŒ¹é…é‡è½½å‡½æ•°ã€‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-cpp">class Foo {
    void DoSomething(int a, int b);
    void DoSomething(int a, string b);
}

EXPECT_CALL(foo, DoSomething(_, A&lt;int&gt;()));  // é¢„æœŸè°ƒç”¨ç¬¬ä¸€ä¸ªå‡½æ•°
</code></pre>
<h5 id="å¸¸ç”¨åŒ¹é…å™¨">å¸¸ç”¨åŒ¹é…å™¨</h5>
<p>å®Œæ•´åˆ—è¡¨è§ 
<a href="http://google.github.io/googletest/reference/matchers.html"  target="_blank" rel="noopener noreferrer" >http://google.github.io/googletest/reference/matchers.html</a>
ï¼Œä¸‹é¢ç½—åˆ—å¸¸ç”¨çš„åŒ¹é…å™¨ï¼š</p>
<ul>
<li>
<p>ä¸€èˆ¬æ¯”è¾ƒ</p>
<ul>
<li>
<p><code>value</code>ï¼šå†™å‡ºå­—é¢é‡çš„å€¼ï¼Œå°±æ˜¯ç²¾ç¡®åŒ¹é…ï¼Œç­‰ä»·äº <code>Eq(value)</code>ã€‚</p>
<pre><code class="language-cpp">EXPECT_CALL(foo, method(100)).Times(1);
EXPECT_CALL(foo, method(Eq(100))).Times(1);  // å’Œä¸Šé¢ç­‰ä»·
</code></pre>
</li>
<li>
<p><code>Ge(value)</code>ã€<code>Gt</code>ã€<code>Le</code>ã€<code>Lt</code>ï¼š&gt;= (greater or equal)ã€&gt; (greater)ã€&lt;= (less or equal)ã€&lt; (less)ã€‚</p>
<pre><code class="language-cpp">EXPECT_THAT(int_foo, Gt(100));  // int_foo &gt; 100
EXPECT_THAT(int_foo, Le(200));  // int_foo &lt;= 200
</code></pre>
</li>
<li>
<p><code>Ne(value)</code>ï¼šä¸ç­‰äºï¼Œnot equalã€‚</p>
</li>
<li>
<p><code>IsFalse()</code>ã€<code>IsTrue()</code>ï¼šè½¬æˆ bool å€¼åæ˜¯ false æˆ– trueã€‚é 0 å€¼ã€éç©ºæŒ‡é’ˆç­‰éƒ½å¯ä»¥è§†ä¸º trueã€‚</p>
</li>
<li>
<p><code>IsNull()</code>ã€<code>NotNull()</code>ï¼šæŒ‡é’ˆæ˜¯å¦ä¸ºç©ºã€‚</p>
</li>
</ul>
</li>
<li>
<p>æµ®ç‚¹æ•°æ¯”è¾ƒ</p>
<ul>
<li>
<p><code>DoubleEq(a_double)</code>ã€<code>FloatEq(a_float)</code>ï¼šæµ®ç‚¹æ•°ç›¸ç­‰ã€‚</p>
<pre><code class="language-cpp">double foo = 0.01 + 0.02;
EXPECT_THAT(foo, Eq(0.03));  // ä¼šå¤±è´¥
EXPECT_THAT(foo, DoubleEq(0.03));  // ä¼šæˆåŠŸ
</code></pre>
</li>
<li>
<p><code>DoubleNear(a_double, max_abs_error)</code>ï¼šæµ®ç‚¹æ•°è¿‘ä¼¼ï¼Œå·®å€¼çš„ç»å¯¹å€¼å°äºç»™å®šçš„ <code>abs_error</code>ã€‚</p>
<pre><code class="language-cpp">double foo = 0.03 + 0.001;
EXPECT_THAT(foo, DoubleNear(0.01));   // ä¼šå¤±è´¥
EXPECT_THAT(foo, DoubleNear(0.001));  // ä¼šæˆåŠŸ
</code></pre>
</li>
<li>
<p><code>FloatNear(a_float, max_abs_error)</code>ï¼šåŒä¸Šã€‚</p>
</li>
</ul>
</li>
<li>
<p>å­—ç¬¦ä¸²æ¯”è¾ƒ</p>
<ul>
<li>
<p><code>StartsWith(prefix)</code>ï¼šæŒ‡å®šå‰ç¼€</p>
</li>
<li>
<p><code>EndsWith(suffix)</code>ï¼šæŒ‡å®šåç¼€</p>
</li>
<li>
<p><code>HasSubstr(string)</code>ï¼šåŒ…å«å­ä¸²</p>
<pre><code class="language-cpp">std::string str = &quot;hello, world&quot;;
EXPECT_THAT(str, StartsWith(&quot;hello&quot;));
EXPECT_THAT(str, EndsWith(&quot;world&quot;));
EXPECT_THAT(str, HasSubstr(&quot;llo&quot;));
</code></pre>
</li>
<li>
<p><code>IsEmpty()</code>ï¼šå­—ç¬¦ä¸²ä¸ºç©º</p>
</li>
<li>
<p><code>StrEq(string)</code>ã€<code>StrNe(string)</code>ï¼šå­—ç¬¦ä¸²ç›¸ç­‰æˆ–ä¸ç­‰</p>
<pre><code class="language-cpp">EXPECT_CALL(m, foo(StrEq(&quot;hello, world&quot;)).Times(1);
m.foo(&quot;hello, world&quot;);  // ç¬¦åˆé¢„æœŸ
</code></pre>
</li>
<li>
<p><code>StrCaseEq(string)</code>ã€<code>StrCaseNe(string)</code>ï¼šå¿½ç•¥å¤§å°å†™ï¼Œå­—ç¬¦ä¸²ç›¸ç­‰æˆ–ä¸ç­‰</p>
<pre><code class="language-cpp">EXPECT_CALL(m, foo(StrCaseEq(&quot;hello, world&quot;)).Times(1);
m.foo(&quot;HELLO, WORLD&quot;);  // ç¬¦åˆé¢„æœŸ
</code></pre>
</li>
<li>
<p><code>ContainsRegex(string)</code>ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</p>
</li>
</ul>
</li>
<li>
<p>å®¹å™¨æ¯”è¾ƒ</p>
<ul>
<li>
<p><code>ElementsAre(e0, e1, ..., en)</code>ï¼šæ¯ä¸ªå…ƒç´ ä¾æ¬¡æ˜¯ä»€ä¹ˆï¼Œç”¨äº vectorã€mapã€set ç­‰ã€‚</p>
<pre><code class="language-cpp">std:vector&lt;int&gt; v = {1, 2, 4};
EXPECT_THAT(v, ElementsAre(1, 2, 4));  // å€¼æ˜¯ {1, 2, 4}
EXPECT_THAT(v, ElementsAre(1, 2, Gt(3)));  // å€¼æ˜¯ {1, 2, å¤§äº 3 çš„ä»»æ„å€¼}

// ä¸‹é¢è¿™æ ·ä¹Ÿå¯ä»¥ï¼Œä½†ä¸å¦‚ä¸Šé¢åªå†™ä¸€è¡Œä¼˜é›…ï¼Œä¸æ¨è
vector&lt;int&gt; expect_vector = {1, 2, 4};
EXPECT_EQ(v, expected_vector);
</code></pre>
</li>
<li>
<p><code>UnorderedElementsAre(e0, e1, ..., en)</code>ï¼šåŒä¸Šï¼Œç”¨äº unordered_setã€unordered_map ç­‰ã€‚</p>
<pre><code class="language-cpp">std:set&lt;int&gt; v = {1, 2, 4};
EXPECT_THAT(v, UnorderedElementsAre(1, 2, 4));  // å€¼åŒ…å« {1, 2, 4}
EXPECT_THAT(v, UnorderedElementsAre(1, 2, Gt(3)));  // å€¼åŒ…å« {1, 2, å¤§äº 3 çš„ä»»æ„å€¼}
</code></pre>
</li>
<li>
<p><code>ContainerEq(container)</code>ï¼šæ•ˆæœåŒä¸Šï¼Œä½†ä¼šæ‰“å°å‡ºå“ªäº›å…ƒç´ ä¸ä¸€è‡´ã€‚</p>
</li>
<li>
<p><code>Contains(e)</code>ï¼šåŒ…å«ä¸€ä¸ªå…ƒç´ å’Œ <code>e</code> åŒ¹é…ï¼Œè¿™é‡Œ <code>e</code> å¯ä»¥æ˜¯ä¸€ä¸ªç²¾ç¡®å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåŒ¹é…å™¨ã€‚</p>
</li>
<li>
<p><code>Contains(e).Times(n)</code>ï¼šæ£€æµ‹ <code>e</code> æŒ‡å®šçš„å…ƒç´ å‡ºç° n æ¬¡ã€‚<code>Times(0)</code> è¡¨ç¤ºä¸èƒ½åŒ…å«è¿™æ ·çš„å…ƒç´ ã€‚</p>
<pre><code class="language-cpp">EXPECT_THAT(v, Contains(5));  // éœ€è¦åŒ…å«ä¸€ä¸ªå€¼ä¸º 5 çš„å…ƒç´ 
EXPECT_THAT(v, Contains(Lt(5)));  // éœ€è¦åŒ…å«ä¸€ä¸ªå€¼ &lt;5 çš„å…ƒç´ 
EXPECT_THAT(v, Contains(Lt(5)).Times(3));  // éœ€è¦åŒ…å« 3 ä¸ªå€¼ &lt;5 çš„å…ƒç´ 
</code></pre>
</li>
<li>
<p><code>Each(e)</code>ï¼šæ¯ä¸ªå…ƒç´ éƒ½è¦åŒ¹é… <code>e</code>ã€‚</p>
<pre><code class="language-cpp">EXPECT_THAT(v, Each(Lt(5)));  // æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦ &lt;5
EXPECT_THAT(v, Each(AllOf(Lt(5), Gt(3)));  // æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦ &gt;3 ä¸” &lt;5
</code></pre>
</li>
<li>
<p><code>IsSubsetOf(array)</code>ã€<code>IsSubsetOf(begin, end)</code>ï¼šå‚æ•°æ˜¯æŒ‡å®šæ•°ç»„çš„å­é›†ï¼Œé¡ºåºå¯ä»¥ä¸ä¸€è‡´ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æˆå‘˜åŒ¹é…</p>
<ul>
<li>
<p><code>Field(&amp;class::field, m)</code>ï¼šåŒ¹é…å­—æ®µå€¼ï¼Œç”¨äºç»“æ„ä½“æ£€æµ‹ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="language-cpp">struct MyStruct {
    int value = 42;
    std::string greeting = &quot;aloha&quot;;
};
MyStruct s;
EXPECT_THAT(s, FieldsAre(42, &quot;aloha&quot;));
</code></pre>
</li>
<li>
<p><code>Pair(m1, m2)</code>ï¼šåŒ¹é…ä¸€ä¸ª <code>std::pair</code>ï¼Œç»å¸¸å’Œ <code>ElementsAre</code> é…åˆä½¿ç”¨ï¼ŒåŒ¹é…ä¸€ä¸ª mapï¼š</p>
<pre><code class="language-cpp">std::map m = {
    {&quot;hello&quot;, 1},
    {&quot;world&quot;, 2},
};
EXPECT_THAT(m, ElementsAre(Pair(&quot;hello&quot;, 1), Pair(&quot;world&quot;, 2)));
</code></pre>
</li>
</ul>
</li>
<li>
<p>æŒ‡é’ˆåŒ¹é…</p>
<ul>
<li>
<p><code>Pointee</code>ï¼šåŒ¹é…ä¸€ä¸ªæŒ‡é’ˆæˆ– shared_ptrï¼Œå¸¸å’Œ <code>Field</code> ä¸€èµ·æ£€æµ‹æŸä¸ªæŒ‡é’ˆçš„å­—æ®µå€¼ï¼š</p>
<pre><code class="language-cpp">struct Item { int id; };
std::shared_ptr&lt;Item&gt; obj = std::make_shared&lt;Item&gt;();
obj-&gt;id = 1;
EXPECT_THAT(obj, Pointee(Field(&amp;Item::id, 1));
</code></pre>
</li>
</ul>
</li>
<li>
<p>å¤åˆåŒ¹é…</p>
<ul>
<li>
<p><code>AllOf(m1, m2, ..., mn)</code>ï¼šåŒ¹é…æ‰€æœ‰ç»™å®šçš„åŒ¹é…å™¨ã€‚</p>
<pre><code class="language-cpp">std:vector&lt;int&gt; v = {4, 5};
EXPECT_THAT(v, Each(AllOf(Le(5), Gt(3)));  // æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦ &gt;3 ä¸” &lt;=5
</code></pre>
</li>
<li>
<p><code>AnyOf(m1, m2, ..., mn)</code>ï¼šåŒ¹é…ä»»ä½•ä¸€ä¸ªç»™å®šçš„åŒ¹é…å™¨ã€‚</p>
<pre><code class="language-cpp">std:vector&lt;int&gt; v = {1, 2, 6, 7};
EXPECT_THAT(v, Each(AnyOf(Lt(3), Gt(5)));  // æ¯ä¸ªå…ƒç´ è¦ä¹ˆ &lt;3ï¼Œè¦ä¹ˆ &gt;5
</code></pre>
</li>
<li>
<p><code>Not(m)</code>ï¼šä¸åŒ¹é…ç»™å®šçš„åŒ¹é…å™¨ï¼Œå¯ä»¥å’Œ <code>AllOf</code>ã€<code>AnyOf</code> é…åˆä½¿ç”¨ã€‚</p>
<pre><code class="language-cpp">EXPECT_THAT(v, Each(AllOf(Gt(3), Lt(5)));  // 3 &lt; each_item &lt; 5
EXPECT_THAT(v, Each(Not(AllOf(Gt(3), Lt(5))));  // each_item &lt;= 3 || each_item &gt;=5
</code></pre>
</li>
<li>
<p><code>Conditional(cond, m1, m2)</code>ï¼šcond ä¸º true æ—¶åŒ¹é… <code>m1</code>ï¼Œå¦åˆ™åŒ¹é… <code>m2</code>ã€‚</p>
<pre><code class="language-cpp">EXPECT_THAT(v, Conditional(is_ad, Gt(5), Lt(3));  // v = is_ad ? v &gt; 5 : v &lt; 3
</code></pre>
</li>
</ul>
</li>
</ul>
<h5 id="åŒ¹é…å™¨çš„ä¼˜å…ˆçº§">åŒ¹é…å™¨çš„ä¼˜å…ˆçº§</h5>
<p>åœ¨ä½¿ç”¨ GMock çš„ EXPECT_CALL å®è¿›è¡Œ mock å‡½æ•°å‚æ•°åŒ¹é…æ—¶ï¼Œä¸€æ¬¡å‡½æ•°è°ƒç”¨å¯èƒ½å‘½ä¸­å¤šä¸ªåŒ¹é…å™¨ï¼š</p>
<pre><code class="language-cpp">EXPECT_CALL(calc, add).Times(1);                // ä»»æ„å‚æ•°
EXPECT_CALL(calc, add(_, _)).Times(1);          // å’Œä¸Šé¢ç­‰ä»·
EXPECT_CALL(calc, add(3, 5)).Times(1);          // å­—é¢é‡ï¼Œç²¾ç¡®åŒ¹é…
EXPECT_CALL(calc, add(Gt(2), Lt(6))).Times(1);  // æ¯”è¾ƒï¼Œæ¨¡ç³ŠåŒ¹é…

calc.add(3, 5);  // è¿™ä¸€è¡Œç†è®ºä¸Šå¯ä»¥åŒ¹é…ä¸Šé¢æ¯ä¸€ä¸ª EXPECT_CALL
</code></pre>
<p>åŒ¹é…çš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š<strong>æ¨¡ç³ŠåŒ¹é…å™¨ &gt; ç²¾ç¡®åŒ¹é…å™¨ &gt;</strong> <strong>é€šé…ç¬¦</strong></p>
<ul>
<li>æ¨¡ç³ŠåŒ¹é…å™¨ï¼šLt (å°äº)ã€Gt (å¤§äº) ç­‰</li>
<li>ç²¾ç¡®åŒ¹é…å™¨ï¼šå­—é¢é‡ã€Eq (ç›¸ç­‰) ç­‰</li>
<li>é€šé…ç¬¦ï¼š_ ç­‰</li>
<li>å½“ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼Œè¶Šè¿‘çš„å£°æ˜ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li>
</ul>
<p>è¿™å¼•å…¥äº†ä¸€äº›ä½¿ç”¨æŠ€å·§ï¼š</p>
<ol>
<li>
<p>åªè®¾ç½®å¿…è¦çš„åŒ¹é…å™¨ã€‚å¦‚æœå¯¹æŸä¸ªå‚æ•°çš„å€¼ä¸æ„Ÿå…´è¶£ï¼Œè¯·å†™ <code>_</code> ä½œä¸ºå‚æ•°ï¼Œè¿™æ„å‘³ç€â€œä¸€åˆ‡çš†æœ‰å¯èƒ½â€ã€‚</p>
<pre><code class="language-cpp">EXPECT_CALL(calc, add(5, _).Times(1);  // å¦‚æœåªå…³å¿ƒç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±å†™æˆ _
EXPECT_CALL(calc, add(5, 3).Times(1);  // å¦‚æœè¿™æ ·å†™ï¼Œä¹‹åä»£ç å˜åŠ¨ï¼Œå•æµ‹å¯èƒ½å°±ä¸é€šè¿‡äº†
</code></pre>
</li>
<li>
<p>å¦‚æœå¯¹æ‰€æœ‰å‚æ•°çš„å€¼éƒ½ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥<strong>çœç•¥å‚æ•°åˆ—è¡¨</strong>ï¼Œè¿™å’ŒæŠŠæ¯ä¸ªå‚æ•°éƒ½å†™æˆ <code>_</code> æ˜¯ä¸€è‡´çš„ã€‚å¥½å¤„æ˜¯åç»­æ”¹äº†å‡½æ•°ç­¾ååï¼Œæ¯”å¦‚æ–°å¢äº†ä¸€ä¸ªå‚æ•°ï¼Œå•æµ‹æ˜¯ä¸éœ€è¦æ”¹åŠ¨çš„ã€‚</p>
<pre><code class="language-cpp">EXPECT_CALL(calc, add).Times(1);       // ä»»æ„å‚æ•°
EXPECT_CALL(calc, add(_, _)).Times(1); // å’Œä¸Šé¢ç­‰ä»·
</code></pre>
</li>
<li>
<p>åˆ©ç”¨åŒ¹é…å™¨çš„ä¼˜å…ˆçº§ï¼Œå¯ä»¥ç»†ç²’åº¦åœ°<strong>æ§åˆ¶å‡½æ•°åœ¨ä¸åŒå‚æ•°ä¸‹çš„è¿”å›å€¼</strong>ã€‚æ¯”å¦‚ mock ä¸€ä¸ª getterï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ key == <code>foo</code> æ—¶è¿”å› <code>bar</code>ã€key == <code>hello</code> æ—¶è¿”å› <code>world</code>ï¼Œå…¶ä»– key é€šé€šè¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="language-cpp">EXPECT_CALL(getter, get).WillRepeatedly(Return(&quot;&quot;));
EXPECT_CALL(getter, get(&quot;foo&quot;)).WillRepeatedly(Return(&quot;bar&quot;));
EXPECT_CALL(getter, get(&quot;hello&quot;)).WillRepeatedly(Return(&quot;world&quot;));

EXPECT_STREQ(getter.get(&quot;foo&quot;), &quot;bar&quot;);
EXPECT_STREQ(getter.get(&quot;hello&quot;), &quot;world&quot;);
EXPECT_STREQ(getter.get(&quot;aaa&quot;), &quot;&quot;);
EXPECT_STREQ(getter.get(&quot;bbb&quot;), &quot;&quot;);
</code></pre>
</li>
</ol>
<h4 id="uninteresting-callå¤„ç†éé¢„æœŸè°ƒç”¨">Uninteresting callï¼šå¤„ç†éé¢„æœŸè°ƒç”¨</h4>
<p><code>éé¢„æœŸè°ƒç”¨</code>æ˜¯æŒ‡æœªè¢« <code>EXPECT_CALL</code> åŒ¹é…çš„è°ƒç”¨ã€‚å½“æœ‰éé¢„æœŸè°ƒç”¨æ—¶ï¼Œä¼šæœ‰ warning æ—¥å¿—è¾“å‡ºï¼š</p>
<pre><code class="language-plaintext">Uninteresting mock function call - returning default value.
    Function call: foo(42)
          Returns: 0
</code></pre>
<p>æœ‰ä¸¤ç§å¤„ç†æ–¹å¼ã€‚</p>
<h5 id="nicemockä¸è¦è¾“å‡º-warning-ä¿¡æ¯">NiceMockï¼šä¸è¦è¾“å‡º warning ä¿¡æ¯</h5>
<p>GMock æœ‰ä¸‰ç§çº§åˆ«ï¼šNice Mockã€Naggy Mockã€Strict Mockã€‚</p>
<p>é»˜è®¤æ˜¯ Naggy Mockï¼Œå½“æœ‰éé¢„æœŸè°ƒç”¨æ—¶ï¼Œè¾“å‡º warning æ—¥å¿—ã€‚</p>
<pre><code class="language-plaintext">Uninteresting mock function call - returning default value.
    Function call: foo(42)
          Returns: 0
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å¸Œæœ›éé¢„æœŸè°ƒç”¨ä¸è¦æœ‰ warningï¼Œå¯ä»¥ç”¨ <code>NiceMock</code>ã€‚<code>NiceMock</code> æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼š</p>
<pre><code class="language-cpp">class MyMockClass : public MyClass {
    MOCK_METHOD(...)
};
MyMockClass mock;  // è¿™éé¢„æœŸè°ƒç”¨ä¼šæœ‰ warning æ—¥å¿—
NiceMock&lt;MyMockClass&gt; mock; // æ”¹æˆè¿™æ ·å°±ä¸ä¼šæœ‰ warning æ—¥å¿—äº†
</code></pre>
<p>ä¹Ÿå¯ä»¥åœ¨ Mock Class å®šä¹‰çš„æ—¶å€™ï¼Œç›´æ¥ç»§æ‰¿ <code>NiceMock</code>ï¼š</p>
<pre><code class="language-cpp">class MyMockClass : public NiceMock&lt;MyClass&gt; {
    MOCK_METHOD(...)
};
MyMockClass mock;  // è¿™é‡Œéé¢„æœŸè°ƒç”¨ä¼šè¿”å›é»˜è®¤å€¼ï¼Œä¸ä¼šæœ‰ warning æ—¥å¿—
</code></pre>
<p>Strict Mock åœ¨æœ‰éé¢„æœŸè°ƒç”¨æ—¶ä¼šç›´æ¥ failã€‚ä¹Ÿæ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œä½¿ç”¨æ–¹æ³•å’Œ <code>NiceMock</code> ç±»ä¼¼ã€‚</p>
<h5 id="æ‰“å°è°ƒç”¨æ ˆæ£€æŸ¥éé¢„æœŸè°ƒç”¨æ¥è‡ªå“ªé‡Œ">æ‰“å°è°ƒç”¨æ ˆï¼šæ£€æŸ¥éé¢„æœŸè°ƒç”¨æ¥è‡ªå“ªé‡Œ</h5>
<p>å½“æœ‰éé¢„æœŸè°ƒç”¨æ—¶ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›æ£€æŸ¥éé¢„æœŸè°ƒç”¨æ¥è‡ªå“ªé‡Œï¼Œå¯ä»¥æ‰“å°è°ƒç”¨æ ˆã€‚æœ‰ä¸¤ç§æ–¹å¼ã€‚</p>
<ul>
<li>
<p>ä¸€ç§æ˜¯é€šè¿‡ EXPECT_CALL æ‰“å°è°ƒç”¨æ ˆï¼š</p>
<pre><code class="language-cpp">#include &lt;boost/stacktrace.hpp&gt;

void print_stack_trace() {
  std::cout &lt;&lt; &quot;call stack:&quot; &lt;&lt; std::endl;
  const auto frames = boost::stacktrace::stacktrace();
  for (const auto&amp; frame : frames) {
    std::cout &lt;&lt; &quot;  &quot; &lt;&lt; frame &lt;&lt; std::endl;
  }
}

EXPECT_CALL(...).WillRepeatedly([](){
  print_stack_trace();
  return xxx;  // è¿”å›é»˜è®¤å€¼
});
</code></pre>
</li>
<li>
<p>å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ GTest æä¾›çš„é€‰é¡¹ <code>--gmock_verbose=info</code>ï¼Œè¯¥é€‰é¡¹ä¼šæ‰“å°æ¯æ¬¡ Mock Method è¢«è°ƒç”¨æ—¶çš„å‚æ•°å’Œè°ƒç”¨æ ˆã€‚éœ€è¦åœ¨å•æµ‹ main å‡½æ•°æ‰§è¡Œ <code>::testing::InitGoogleMock(&amp;</code><em><code>argc</code></em><code>,</code> <em><code>argv)</code>**ã€‚</em></p>
</li>
</ul>
<h3 id="on_call">ON_CALL</h3>
<p>ON_CALL å¯ä»¥å’Œ EXPECT_CALL é…åˆä½¿ç”¨ã€‚ON_CALL è®¾ç½®å‡½æ•°çš„é»˜è®¤è¡Œä¸ºï¼ŒEXPECT_CALL ä¸´æ—¶ä¿®æ”¹å…¶è¡Œä¸ºã€‚</p>
<p>ğŸ’¡ ON_CALL å’Œ EXPECT_CALL çš„è¯­æ³•å¾ˆåƒï¼Œä½†æä¾›äº†ä¸åŒçš„è¯­ä¹‰ã€‚EXPECT_CALL ç›®çš„åœ¨äºå®šä¹‰ä¸€ä¸ªé¢„æœŸï¼Œå³æˆ‘ä»¬æœŸæœ›è¢«æµ‹è¯•å‡½æ•°åœ¨æŸäº›ç‰¹å®šæ¡ä»¶ä¸‹åº”è¯¥è°ƒç”¨å“ªäº›å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰æ»¡è¶³é¢„æœŸçš„è°ƒç”¨ï¼Œåˆ™è®¤ä¸ºæ˜¯ä¸€æ¬¡å¤±è´¥ã€‚ON_CALL åªæ˜¯ä¸ºäº†æŒ‡å®šè¢«æµ‹è¯•å‡½æ•°çš„é»˜è®¤è¡Œä¸ºã€‚</p>
<p>ON_CALL é€šå¸¸ç”¨åœ¨ <strong>Mock ç±»çš„æ„é€ å‡½æ•°</strong>ã€æˆ–è€… TestFixture çš„ <strong><code>SetUp</code></strong> <strong>å‡½æ•°</strong>é‡Œï¼š</p>
<ol>
<li>
<p>ä»¤ mock å‡½æ•°å§‹ç»ˆè¿”å›æŸä¸ªè‡ªå®šä¹‰çš„å€¼</p>
</li>
<li>
<p>å°† mock å‡½æ•°çš„é»˜è®¤æ“ä½œå§”æ‰˜ç»™åŸºç±»æˆ–å…¶ä»–å®ä¾‹è¿›è¡Œã€‚ä¸€ä¸ªå…·ä½“ä½¿ç”¨åœºæ™¯ï¼šå¸Œæœ› Mock æŸä¸ªå‡½æ•°ï¼Œé»˜è®¤è¿˜æ˜¯æ‰§è¡ŒåŸæœ‰æ“ä½œï¼Œä½†å½“æœ‰éœ€è¦çš„æ—¶å€™ï¼Œå¯ä»¥ä¸´æ—¶æ›´æ”¹å…¶è¡Œä¸ºã€‚è¿™æ—¶å°±å¯ä»¥åœ¨ ON_CALL é‡ŒæŠŠé»˜è®¤æ“ä½œå§”æ‰˜ç»™åŸºç±»ï¼Œåç»­å†åœ¨ EXPECT_CALL é‡Œä¸´æ—¶æ§åˆ¶å…¶è¿”å›å€¼ã€‚</p>
<pre><code class="language-cpp"> class MockFoo : public Foo {
 public:
 // Normal mock method definitions using gMock.
 MOCK_METHOD(char, DoThis, (int n), (override));
 MOCK_METHOD(void, DoThat, (const char* s, int* p), (override));

 // æ„é€ å‡½æ•°é‡Œï¼Œå§”æ‰˜ Mock æ¥å£çš„æ“ä½œç»™å…¶ä»–ç±»
 MockFoo() {
 // å§”æ‰˜ç»™åŸºç±»
 ON_CALL(*this, DoThat).WillByDefault([this](const char* s, int* p) {
 Foo::DoThat(s, p);
 });
 // å§”æ‰˜ç»™å¦ä¸€ä¸ªå¯¹è±¡
 ON_CALL(*this, DoThis).WillByDefault([this](int n) {
 return fake_.DoThis(n);
 });
 }

 private:
 FakeFoo fake_;  // Keeps an instance of the fake in the mock.
 };
</code></pre>
</li>
</ol>
<h2 id="äº”tips">äº”ã€Tips</h2>
<h3 id="ç¼–è¯‘å‚æ•°">ç¼–è¯‘å‚æ•°</h3>
<h4 id="è®¿é—®ç§æœ‰å˜é‡">è®¿é—®ç§æœ‰å˜é‡</h4>
<p>é”™è¯¯çš„åšæ³•ï¼š<code>#define private public</code>ï¼Œæˆ–è€…å®šä¹‰ getter å‡½æ•°ã€‚å‰è€…å¯èƒ½å¯¼è‡´ç¼–è¯‘æŠ¥é”™ï¼Œåè€…éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p>
<p>æ­£ç¡®çš„åšæ³•ï¼š<code>-fno-access-control</code>ï¼Œæ”¾åœ¨å•æµ‹çš„ optimize å‚æ•°é‡Œã€‚</p>
<h4 id="ä¿®æ”¹-const-å­—æ®µ">ä¿®æ”¹ Const å­—æ®µ</h4>
<p>é”™è¯¯çš„åšæ³•ï¼šå®šä¹‰ setter å‡½æ•°ã€‚éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p>
<p>è¾ƒå¥½çš„åšæ³•ï¼šä½¿ç”¨ <code>const_cast&lt;Type&amp;&gt;</code> ä¿®æ”¹å¸¸é‡ç±»å‹ã€‚</p>
<h4 id="ä¼˜åŒ–çº§åˆ«æ”¹ä¸º-o0">ä¼˜åŒ–çº§åˆ«æ”¹ä¸º O0</h4>
<p>å¥½å¤„ï¼šå•æµ‹è¦†ç›–ç‡æŠ¥å‘Šæ›´å‡†ã€‚</p>
<h3 id="è¿è¡Œå•æµ‹">è¿è¡Œå•æµ‹</h3>
<h4 id="è¿è¡Œç‰¹å®šå•æµ‹--gtest_filter">è¿è¡Œç‰¹å®šå•æµ‹ï¼š<code>--gtest_filter</code></h4>
<p>ä»€ä¹ˆæ—¶å€™éœ€è¦è¿è¡Œç‰¹å®šå•æµ‹ï¼š</p>
<ul>
<li>è¿è¡Œæ‰€æœ‰å•æµ‹ï¼Œå‘ç°æŸä¸ªå•æµ‹å¤±è´¥äº†ã€‚ä½†è¿™ä¸ªæ—¶å€™å•æµ‹æ—¥å¿—å·²ç»åˆ·å±ï¼Œçœ‹ä¸åˆ°è¿™ä¸ªå•æµ‹çš„å…·ä½“å¤±è´¥åŸå› äº†ã€‚</li>
<li>ä¿®å¤å•æµ‹ bug åé‡æ–°ç¼–è¯‘ï¼Œåªå¸Œæœ›è¿è¡Œä¸Šæ¬¡å¤±è´¥çš„é‚£ä¸ªå•æµ‹ã€‚</li>
</ul>
<p>è¯­æ³•ï¼š<code>--gtest_filter=TestSuite.TestCase</code>ã€‚<strong>æ”¯æŒ****é€šé…ç¬¦</strong> <strong><code>\*</code></strong> <strong>å’Œæ’é™¤ç¬¦</strong> <strong><code>-</code></strong>ã€‚</p>
<ul>
<li><code>--gtest_filter=FooTest.Bar</code>ï¼Œåªè¿è¡Œ <code>FooTest.Bar</code>ã€‚</li>
<li><code>--gtest_filter=*FooTest*</code>ï¼Œè¿è¡Œæ‰€æœ‰åç§°é‡ŒåŒ…å« <code>FooTest</code> çš„å•æµ‹ã€‚</li>
<li><code>--gtest_filter=FooTest.*:BarTest.*</code>ï¼Œè¿è¡Œ FooTest å’Œ BarTest ä¸¤ä¸ª suites ä¸‹çš„æ‰€æœ‰å•æµ‹ã€‚</li>
<li><code>--gtest_filter=FooTest.*-FooTest.Bar</code>ï¼Œè¿è¡Œ FooTest ä¸‹çš„æ‰€æœ‰å•æµ‹ï¼Œä½†ä¸è¿è¡Œ FooTest.Barã€‚</li>
<li><code>--gtest_filter=FooTest.*:BarTest.*-FooTest.Bar:BarTest.Foo</code>ï¼Œè¿è¡Œ FooTest å’Œ BarTest ä¸‹çš„æ‰€æœ‰å•æµ‹ï¼Œä½†ä¸è¿è¡Œ FooTest.Bar å’Œ BarTest.Fooã€‚</li>
<li>è¯¦ç»†çš„åŒ¹é…è§„åˆ™è§
<a href="https://github.com/google/googletest/blob/main/docs/advanced.md#running-a-subset-of-the-tests"  target="_blank" rel="noopener noreferrer" >æ–‡æ¡£</a>
ã€‚</li>
</ul>
<h4 id="é‡å¤è¿è¡Œå•æµ‹å¤šæ¬¡--gtest_repeat--gtest_break_on_failure">é‡å¤è¿è¡Œå•æµ‹å¤šæ¬¡ï¼š<code>--gtest_repeat</code>ã€<code>--gtest_break_on_failure</code></h4>
<p>æœ‰äº›å•å…ƒæµ‹è¯•æ¶‰åŠåˆ°å¤šçº¿ç¨‹ï¼Œå¯èƒ½ä¼šå¶å‘æ€§çš„ä¸é€šè¿‡ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>--gtest_repeat=-1</code>ã€<code>--gtest_break_on_failure</code>è¿è¡Œå¤šæ¬¡æ¥å¤ç°ã€‚</p>
<h4 id="ä¸´æ—¶ç¦ç”¨æŸä¸ªå•æµ‹disabled_">ä¸´æ—¶ç¦ç”¨æŸä¸ªå•æµ‹ï¼š<code>DISABLED_</code></h4>
<p>å¯ä»¥ä½¿ç”¨<code>DISABLED_</code>å‰ç¼€æ¥è·³è¿‡æŸé¡¹æµ‹è¯•ï¼š</p>
<pre><code class="language-cpp">TEST_F(DISABLED_BarTest, DoesXyz) { ... }
TEST_F(BarTest, DISABLED_DoesXyz) { ... }
</code></pre>
<p>DISABLED ä¹‹åï¼Œå•æµ‹æ—¥å¿—ä¼šè¾“å‡º DISABLED çš„å•æµ‹æ•°é‡ï¼š</p>
<p>
<div class="img-no-link">
  <img class="common-markdown-diagram" src="https://imageslr.com/media/gtest/disable.png" alt="img" />
</div>
</p>
<p>ä¹‹ååœ¨ä¿®ç†å•æµ‹è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ <code>--gtest_also_run_disabled_tests</code> æˆ–è€… <code>--gtest_filter</code> æ¥æ‰§è¡Œè¢« DISABLED çš„å•æµ‹ã€‚</p>
<p>ç›¸æ¯”äºæŠŠæ•´æ®µå•æµ‹ä»£ç å…¨éƒ¨æ³¨é‡Šæ‰ï¼ŒåŠ ä¸€ä¸ª DISABLED_ å‰ç¼€çš„ diff æ›´å°‘ï¼Œè€Œä¸”åç»­å¯ä»¥ç›´æ¥è¿è¡Œã€‚</p>
<h3 id="è¾“å‡ºæ—¥å¿—">è¾“å‡ºæ—¥å¿—</h3>
<p>std::cout è¾“å‡ºçš„æ—¥å¿—ä¼šç›´æ¥å±•ç¤ºåœ¨ç»ˆç«¯ã€‚</p>
<p>ğŸ’¡ å»ºè®®ï¼š<strong>èƒ½ç”¨ EXPECT å°±ä¸è¦å†™ std::cout</strong></p>
<ul>
<li>å¦‚æœ cout çš„æ—¥å¿—æ˜¯ç¡®å®šæ€§çš„ï¼Œé‚£ä¹ˆåº”è¯¥å†™æˆæ–­è¨€ã€‚</li>
<li>å¦‚æœæ˜¯ debug ç”¨çš„ï¼Œé‚£ä¹ˆåœ¨å†™å®Œå•æµ‹ååº”è¯¥åˆ é™¤ã€‚</li>
<li>å¦‚æœæœŸæœ›å•æµ‹å¤±è´¥æ—¶æ‰“å°ï¼Œé‚£ä¹ˆåº”è¯¥æ”¾åœ¨ <code>EXPECT_CALL()... &lt;&lt; ...</code> åé¢ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œè¿™äº›æ—¥å¿—æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œåªä¼šåˆ·å±ï¼Œæ²¡æœ‰ä¿ç•™çš„å¿…è¦ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨-gdb-è¿è¡Œå’Œè°ƒè¯•ç¨‹åº">ä½¿ç”¨ GDB è¿è¡Œå’Œè°ƒè¯•ç¨‹åº</h3>
<p>ğŸ”— <strong>GDB</strong> <strong>å¿«é€Ÿå…¥é—¨ / é€ŸæŸ¥æ‰‹å†Œ</strong>ï¼š
<a href="https://imageslr.com/2023/gdb"  target="_blank" rel="noopener noreferrer" >https://imageslr.com/2023/gdb.html</a>
</p>
<p>GDB ä¹Ÿæ˜¯ç ”å‘åŸºæœ¬åŠŸä¹‹ä¸€ã€‚ä½¿ç”¨ GDB æ–­ç‚¹è°ƒè¯•çš„æ•ˆç‡è¿œé«˜äº<code>åŠ æ—¥å¿—+é‡æ–°ç¼–è¯‘å•æµ‹</code>ï¼Œä½†å¤§éƒ¨åˆ†äººä¾ç„¶ä½¿ç”¨åé¢è¿™ç§è°ƒè¯•æ–¹å¼ï¼ŒåŸå› å¯èƒ½æ˜¯è®¤ä¸º GDB çš„ä¸Šæ‰‹æˆæœ¬å¤ªé«˜ã€‚ä½†å®é™…ä¸Šï¼ŒGDB å…¥é—¨åªéœ€è¦ 3 åˆ†é’Ÿã€‚è¿™é‡Œç½—åˆ— GDB çš„åŸºæœ¬ä½¿ç”¨å§¿åŠ¿ï¼Œè¶³å¤Ÿè¦†ç›–å¤§éƒ¨åˆ†å•æµ‹åœºæ™¯ã€‚ä¸Šé¢é«˜äº®å—é‡Œä¹Ÿæä¾›äº†ä¸€ä¸ªé€ŸæŸ¥æ‰‹å†Œã€‚</p>
<ol>
<li>
<p>è¿›å…¥ GDBï¼ŒåŒæ—¶åŠ è½½å•æµ‹ç¨‹åºï¼š</p>
<pre><code class="language-Shell">  gdb ./path/to/unit_test
</code></pre>
</li>
<li>
<p>åŠ è½½åŠ¨æ€é“¾æ¥åº“ï¼š</p>
<pre><code class="language-Shell">  set env LD_LIBRARY_PATH=...
</code></pre>
</li>
<li>
<p>è¿è¡Œå•æµ‹ï¼š<code>r</code>ã€‚å¦‚æœè¦è¿è¡ŒæŒ‡å®šå•æµ‹ï¼ŒåŠ  <code>--gtest_filter</code> å‚æ•°ï¼š</p>
<pre><code class="language-Shell">  r --gtest_filter=FooTest.bar_method
</code></pre>
</li>
<li>
<p>æ‰“æ–­ç‚¹ï¼š<code>b</code>ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-Shell">  b æ–‡ä»¶å:è¡Œå·
  b prime/src/auction/validator/frame/validator.cpp:52
</code></pre>
</li>
<li>
<p>ä»æ–­ç‚¹å¤„ç»§ç»­è¿è¡Œï¼š<code>c</code></p>
</li>
<li>
<p>é€è¡Œæ‰§è¡Œï¼š<code>n</code></p>
</li>
<li>
<p>æ‰“å°å˜é‡ï¼š<code>p å˜é‡å</code></p>
</li>
<li>
<p>æŸ¥çœ‹ core æ ˆï¼š<code>bt</code></p>
</li>
</ol>
<h2 id="å…­å•æµ‹ç¼–å†™è§„èŒƒ">å…­ã€å•æµ‹ç¼–å†™è§„èŒƒ</h2>
<p>ğŸ’¡ å•æµ‹ä»£ç ä¹Ÿéœ€è¦ç»è¿‡ Code Reviewã€‚å•æµ‹ä»£ç å’Œçº¿ä¸Šä»£ç åŒç­‰é‡è¦ã€‚</p>
<h3 id="ç›®å½•ç»“æ„æ–‡ä»¶ä¸å‘½åè§„èŒƒ">ç›®å½•ç»“æ„ã€æ–‡ä»¶ä¸å‘½åè§„èŒƒ</h3>
<h4 id="å•æµ‹çš„ç›®å½•ç»“æ„è¦å’Œæºç çš„ç›®å½•ç»“æ„ä¸€è‡´-å¼ºåˆ¶">å•æµ‹çš„ç›®å½•ç»“æ„ï¼Œè¦å’Œæºç çš„ç›®å½•ç»“æ„ä¸€è‡´ <code>[å¼ºåˆ¶]</code></h4>
<p>å•æµ‹æ–‡ä»¶çš„è·¯å¾„åï¼Œç­‰ä»·äºæºç çš„æ–‡ä»¶ååŠ ä¸Š <code>_test</code> åç¼€ã€‚</p>
<p>ç›®çš„åœ¨äºï¼šè®©å†™å•æµ‹çš„äººèƒ½å¾ˆå¿«å®šä½æ˜¯å¦å·²ç»æœ‰è¿™ä¸ªæ–‡ä»¶æˆ–è¿™ä¸ªç±»çš„å•æµ‹ï¼Œè®©æ–°å¢ä»£ç æ›´èšåˆï¼Œé¿å…å†™é‡å¤å•æµ‹ã€‚</p>
<pre><code class="language-JSON">// bad
src/
  common/
    item_data.cpp
  frame/
    request_context.cpp
unittest/
  item_data_test.cpp // è¿™é‡Œç›´æ¥å¹³é“ºåœ¨ unittest ç›®å½•ä¸‹äº†ï¼Œå’Œ src ç›®å½•å±‚çº§ä¸ä¸€è‡´
  request_context_test.cpp

// good
src/
  common/
    item_data.cpp
  frame/
    request_context.cpp
unittest/
  common/
    item_data_test.cpp
  frame/
    request_context_test.cpp
</code></pre>
<h4 id="testsuitetestcase-å‘½åè§„èŒƒ-å»ºè®®">TestSuiteã€TestCase å‘½åè§„èŒƒ <code>[å»ºè®®]</code></h4>
<p>TestSuite å»ºè®®å‘½åä¸ºè¢«æµ‹è¯•çš„ç±»ååŠ ä¸Š <code>Test</code> åç¼€ï¼š</p>
<pre><code class="language-cpp">// bad
TEST(MyTest, foo) {...}

// good
TEST(RequestContextTest, foo) {...}
</code></pre>
<p>TestCase å»ºè®®å‘½åä¸ºè¢«æµ‹è¯•çš„å‡½æ•°åï¼Œä¸è¦éšæ„èµ·åï¼Œä¹Ÿä¸éœ€è¦å¢åŠ ä¸å¿…è¦çš„å‰ç¼€ï¼š</p>
<pre><code class="language-JSON">// bad
TEST(RequestContextTest, test_uav) {
    ASSERT_EQ(ctx-&gt;init_uav_to_group_bid(), 1);
}

// good
TEST(RequestContextTest, init_uav_to_group_bid) { // ä¸éœ€è¦åŠ  test_ å‰ç¼€
    ASSERT_EQ(ctx-&gt;init_uav_to_group_bid(), 1);
}
</code></pre>
<p>GTest ç”Ÿæˆçš„ç±»åæ˜¯å¸¦ä¸‹åˆ’çº¿çš„ï¼Œæ‰€ä»¥ä¸Šé¢è¿™äº›åå­—å»ºè®®ç”¨é©¼å³°å½¢å¼ã€‚</p>
<h3 id="å†™æœ‰ç”¨çš„å•æµ‹è€Œä¸åªæ˜¯é€šè¿‡å•æµ‹è¦†ç›–ç‡å¡ç‚¹">å†™æœ‰ç”¨çš„å•æµ‹ï¼Œè€Œä¸åªæ˜¯é€šè¿‡å•æµ‹è¦†ç›–ç‡å¡ç‚¹</h3>
<h4 id="ç¦æ­¢å†™æ— ç”¨å•æµ‹-å¼ºåˆ¶">ç¦æ­¢å†™æ— ç”¨å•æµ‹ <code>[å¼ºåˆ¶]</code></h4>
<p>ç»å…¸é—®é¢˜ï¼šâ€œ<strong>å‡å•æµ‹</strong>â€ã€‚ä¸ºäº†é€šè¿‡å•æµ‹è¦†ç›–ç‡å¡ç‚¹ã€ä¾¿åªæ˜¯åœ¨å•æµ‹é‡Œæ‰§è¡Œäº†ä¸€ä¸‹æ–°å¢å‡½æ•°ï¼Œä½†<strong>ä¸æ£€æµ‹å…¶è¿”å›å€¼ï¼Œæ²¡æœ‰ä»»ä½•æ–­è¨€é€»è¾‘</strong>ã€‚ä¹‹å‰é‡åˆ°è¿‡æœ‰åŒå­¦å†™äº†å‡ ç™¾è¡Œå•æµ‹ï¼Œreviewer ä»å¤´çœ‹åˆ°å°¾ï¼Œå±…ç„¶ä¸€è¡Œ EXPECT éƒ½æ²¡æœ‰ï¼Œï¼ˆâ•¯â€µâ–¡â€²ï¼‰â•¯ã€‚</p>
<p>è¿˜æœ‰ä¸€ç§åœºæ™¯æ˜¯â€œ<strong>è¹­****å•æµ‹</strong>â€ï¼šæ–°å¢äº†ä¸€ä¸ªåˆ†æ”¯é€»è¾‘ï¼Œå¼•å…¥äº†ä¸€å¨é€»è¾‘ï¼Œä½†åªæ˜¯åœ¨æŸä¸ªå·²æœ‰å•æµ‹é‡Œï¼ŒæŠŠè¿™åˆ†æ”¯çš„æ§åˆ¶å‚æ•°æ‰“å¼€äº†ï¼Œå®Œå…¨æ²¡æœ‰è‡ªå·±æ„é€ è¾“å…¥å»è¦†ç›–æ–°å¢é€»è¾‘ã€‚è¿™æ ·å³ä½¿è¦†ç›–ç‡ä¹Ÿèƒ½è¾¾æ ‡ï¼Œä¹Ÿå±äºæ— ç”¨å•æµ‹ã€‚</p>
<h4 id="æµ‹è¯•ä¸ç¬¦åˆé¢„æœŸçš„è¾¹ç•Œæƒ…å†µè€Œä¸æ˜¯åªæµ‹è¯•ç¬¦åˆé¢„æœŸçš„æƒ…å†µ-å»ºè®®">æµ‹è¯•ä¸ç¬¦åˆé¢„æœŸçš„è¾¹ç•Œæƒ…å†µï¼Œè€Œä¸æ˜¯åªæµ‹è¯•ç¬¦åˆé¢„æœŸçš„æƒ…å†µ <code>[å»ºè®®]</code></h4>
<p>å•æµ‹çš„ç›®çš„ä¹‹ä¸€åœ¨äºæµ‹è¯•ç¨‹åºçš„é²æ£’æ€§ï¼Œå³å½“è¾“å…¥ä¸ç¬¦åˆé¢„æœŸæ—¶ï¼Œæ˜¯å¦èƒ½æ­£ç¡®å¤„ç†ã€‚æ¯”å¦‚ä¸€ä¸ª <code>stoi</code> å‡½æ•° â€”â€” å°†å­—ç¬¦ä¸²è½¬æˆæ•´æ•°ã€‚åœ¨æ„é€ è¾“å…¥æ—¶ï¼Œæœ€åŸºæœ¬çš„æ˜¯ <code>123</code> è¿™ç§åˆæ³•å­—ç¬¦ä¸²ï¼Œæ­¤å¤–è¿˜åº”å½“æ„é€  <code>0.9999</code> (å°æ•°)ã€<code>123abc</code> (å«éæ³•å­—ç¬¦) ç­‰éæ³•è¾“å…¥ï¼Œä»¥åŠ <code>1781234123412341234</code> è¿™ç§åˆæ³•ä½†è¶Šç•Œçš„è¾“å…¥ã€‚</p>
<h3 id="å†™ä¼˜é›…çš„å¯ç†è§£çš„æ˜“äºç»´æŠ¤çš„å•æµ‹ä»£ç é£æ ¼ä¸æ³¨é‡Š">å†™ä¼˜é›…çš„ã€å¯ç†è§£çš„ã€æ˜“äºç»´æŠ¤çš„å•æµ‹ï¼šä»£ç é£æ ¼ä¸æ³¨é‡Š</h3>
<h4 id="ä¸è¦ç”¨-stdcout-è¾“å‡ºå˜é‡å€¼æ”¹ä¸ºç”¨-assert--expect-æ£€æŸ¥-å¼ºåˆ¶">ä¸è¦ç”¨ std::cout è¾“å‡ºå˜é‡å€¼ï¼Œæ”¹ä¸ºç”¨ <code>ASSERT</code> / <code>EXPECT</code> æ£€æŸ¥ <code>[å¼ºåˆ¶]</code></h4>
<p>èƒ½ç”¨ EXPECT å°±ä¸è¦å†™ std::coutï¼š</p>
<ul>
<li>å¦‚æœ cout çš„æ—¥å¿—æ˜¯ç¡®å®šæ€§çš„ï¼Œé‚£ä¹ˆåº”è¯¥å†™æˆæ–­è¨€ã€‚</li>
<li>å¦‚æœæ˜¯ debug ç”¨çš„ï¼Œé‚£ä¹ˆåœ¨å†™å®Œå•æµ‹ååº”è¯¥åˆ é™¤ã€‚</li>
<li>å¦‚æœæœŸæœ›å•æµ‹å¤±è´¥æ—¶æ‰“å°ï¼Œé‚£ä¹ˆåº”è¯¥æ”¾åœ¨ <code>EXPECT_CALL()... &lt;&lt; ...</code> åé¢ï¼Œè€Œä¸æ˜¯ç›´æ¥è¾“å‡ºã€‚</li>
<li>é™¤æ­¤ä¹‹å¤–ï¼Œ<strong>è¿™äº›æ—¥å¿—æ²¡æœ‰ä»»ä½•æ„ä¹‰</strong>ï¼Œåªä¼šåˆ·å±ï¼Œæ²¡æœ‰ä¿ç•™çš„å¿…è¦ã€‚</li>
</ul>
<pre><code class="language-cpp">// bad
std::cout &lt;&lt; &quot;ads_size = &quot; &lt;&lt; rsp.ads.size() &lt;&lt; std::endl; // è¿™ä¸€è¡Œå¤šæ­¤ä¸€ä¸¾
EXPECT_EQ(rsp.ads.size(), 1);

// good
EXPECT_EQ(rsp.size(), 1); // è¿™ä¸€è¡Œåœ¨æ£€æµ‹å¤±è´¥æ—¶ï¼Œä¼šæ‰“å° rsp.size() çš„å€¼
EXPECT_EQ(rsp.size(), 1) &lt;&lt; rsp.ads.debug_string() &lt;&lt; std::endl;  // å¯ä»¥åœ¨æ£€æµ‹å¤±è´¥æ—¶ï¼Œæ‰“å°æ›´å¤š debug æ—¥å¿—
</code></pre>
<h4 id="ä¸è¦ç›´æ¥å†™æ•°å€¼è¦å†™æ¸…æ¥šè¿™ä¸ªæ•°å­—æ˜¯æ€ä¹ˆç®—çš„-å»ºè®®">ä¸è¦ç›´æ¥å†™æ•°å€¼ï¼Œè¦å†™æ¸…æ¥šè¿™ä¸ªæ•°å­—æ˜¯æ€ä¹ˆç®—çš„ <code>[å»ºè®®]</code></h4>
<p>ç›´æ¥å†™ä¸€ä¸ªæ•°å­— <code>2965</code>ï¼Œå…¶ä»–äººå¹¶ä¸çŸ¥é“è¿™ä¸ªæ•°å­—æ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Œåç»­æœ‰é—®é¢˜ä¹Ÿä¸å¥½æ’æŸ¥ã€‚</p>
<p>å†™å‡ºè¿™ä¸ªæ•°å­—çš„è®¡ç®—è¿‡ç¨‹ï¼Œ<strong>æ˜ å°„åˆ°ä»£ç åˆ†æ”¯ä¸Š</strong>ï¼Œå…¶ä»–äººå¥½çœ‹æ‡‚ã€‚è¿™ä¹Ÿæ˜¯ç™½ç›’åŒ–å•æµ‹çš„è¡¨ç°ä¹‹ä¸€ã€‚</p>
<pre><code class="language-cpp">// bad
params.alpha = 2;
params.beta = 2.5;
ASSERT_EQ(params.get_score(), 2965); // è¿™ 2965 å’‹ç®—çš„ï¼Ÿ

// good
params.alpha = 2;
params.beta = 2.5;
ASSERT_EQ(params.get_score(), 2 * 2.5 * 593); // alpha * beta * ctx.bid

// good: æŠŠå˜é‡åç›´æ¥æ³¨é‡Šåœ¨å­—é¢é‡åé¢
ASSERT_EQ(params.get_score(), 2 /* alpha */ * 2.5 /* beta */ * 593 /* ctx.bid */);
</code></pre>
<h4 id="ä½¿ç”¨å¤§æ‹¬å·åˆ†éš”ç¼©è¿›ä¸åŒçš„-test-case-å»ºè®®">ä½¿ç”¨å¤§æ‹¬å·åˆ†éš”ã€ç¼©è¿›ä¸åŒçš„ Test Case <code>[å»ºè®®]</code></h4>
<p>ä¸€ä¸ª <code>TEST(Foo, Bar){...}</code> å°±æ˜¯ä¸€ä¸ª Test Caseã€‚è€ƒè™‘åˆ°æ„é€ è¾“å…¥æœ‰æˆæœ¬ï¼Œé€šå¸¸ä¸€ä¸ª <code>TEST(Foo, Bar)</code> é‡Œä¼šåå¤ä¿®æ”¹è¾“å…¥ï¼Œæ„é€ å¤šä¸ª caseï¼Œæµ‹è¯•ä¸åŒçš„æ‰§è¡Œæµç¨‹ã€‚è¿™é‡Œå»ºè®®<strong>ç”¨å¤§æ‹¬å·åˆ†éš”ä¸åŒçš„ case</strong>ï¼Œæ•´ä½“æ›´æ¡ç†ã€‚å¦ä¸€ä¸ªå¥½å¤„åœ¨äºï¼š<strong>æ¯ä¸ªå˜é‡çš„ç”Ÿå‘½å‘¨æœŸä»…é™äºå¤§æ‹¬å·å†…</strong>ã€‚è¿™æ ·å°±å¯ä»¥åå¤ä½¿ç”¨ç›¸åŒçš„å˜é‡åï¼Œè€Œä¸ç”¨ç»™å˜é‡åç¼–å·ã€‚</p>
<pre><code class="language-cpp">// bad
TEST(Foo, bar) {
    Context ctx1;
    params.enable_refresh = true;
    ASSERT_EQ(ctx1-&gt;is_enable_fresh(), true);

    Context ctx2;
    params.enable_refresh = false;
    ASSERT_EQ(ctx2-&gt;is_enable_fresh(), false);
}

// good
TEST(Foo, bar) {
    // case 1: enable = true
    {
        Context ctx;
        params.enable_refresh = true;
        ASSERT_EQ(ctx-&gt;is_enable_fresh(), true);
    }

    // case 2: enable = false
    {
        Context ctx;
        params.enable_refresh = false;
        ASSERT_EQ(ctx-&gt;is_enable_fresh(), false);
    }
}
</code></pre>
<p>æ­¤å¤–ï¼Œå¦‚æœå¾…æµ‹å‡½æ•°ååˆ†å¤æ‚ï¼Œå»ºè®®æ‹†åˆ†å¤šä¸ª <code>TEST(Foo, Bar){...}</code>ï¼Œé¿å… Test Case ä»£ç è†¨èƒ€ã€‚æ¯”å¦‚ï¼š</p>
<pre><code class="language-cpp">// å¾…æµ‹å‡½æ•°
int foo(Ad ad) {
    if (!ad)
        return -1;
    switch(ad.pricing) {
        case CPT:
            ...
        case GD:
            ...
    }
}
// è¾“å…¥ä¸ºç©º
TEST(Foo, IsNil) {
    ...
}

// è¾“å…¥æ˜¯ CPT å¹¿å‘Š
TEST(Foo, IsCpt) {
    ...
}

// è¾“å…¥æ˜¯ GD å¹¿å‘Š
TEST(Foo, IsGd) {
    ...
}
</code></pre>
<h4 id="æ­£ç¡®ä½¿ç”¨-assert-å’Œ-expect-å‰ç¼€-å»ºè®®">æ­£ç¡®ä½¿ç”¨ <code>ASSERT</code> å’Œ <code>EXPECT</code> å‰ç¼€ <code>[å»ºè®®]</code></h4>
<ul>
<li>
<p>å‰è€…åœ¨æ ¡éªŒå¤±è´¥æ—¶ä¼šç›´æ¥ç»ˆæ­¢ï¼Œåè€…åˆ™ä¼šç»§ç»­è¿è¡Œã€‚</p>
</li>
<li>
<p>å¦‚æœæŸä¸ªåˆ¤æ–­ä¸é€šè¿‡æ—¶ä¼šå½±å“åç»­æ­¥éª¤ ï¼Œéœ€è¦ä½¿ç”¨ <code>ASSERT</code>ã€‚å¸¸è§çš„æ˜¯ç©ºæŒ‡é’ˆï¼Œæˆ–è€…æ•°ç»„è®¿é—®è¶Šç•Œã€‚</p>
<blockquote>
<p>å¦‚æœæŸä¸ª EXPECT å¤±è´¥ä¼šå¯¼è‡´åç»­ä¸€è¿ä¸² EXPECT å¤±è´¥ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ª EXPECT åº”è¯¥æ¢æˆ ASSERTã€‚è¿™å°±åƒç¼–è¯‘æ—¶çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¾€å¾€åªæœ‰ç¬¬ä¸€ä¸ªæ˜¯æœ‰ç”¨çš„ï¼Œå…¶ä»–é”™è¯¯éƒ½åªæ˜¯åˆ·å±ã€‚</p></blockquote>
</li>
<li>
<p>å…¶ä»–æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ <code>EXPECT</code>ï¼Œå°½å¯èƒ½å¤šæµ‹è¯•å‡ ä¸ªç”¨ä¾‹ã€‚</p>
</li>
<li>
<p>æ­¤å¤–ï¼Œå¦‚æœä¿®æ”¹äº†æŸä¸ªå­—æ®µçš„<strong>ç›®çš„æ˜¯å½±å“æŸä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œé‚£ä¹ˆæœ€å¥½è¡¥ä¸€è¡Œ</strong> <strong><code>ASSERT</code></strong>ã€‚å¥½å¤„æ˜¾è€Œæ˜“è§ï¼šä»£ç å³æ³¨é‡Šï¼›ä¸”åœ¨æŸ¥å•æµ‹ bug çš„æ—¶å€™ï¼Œè¿™äº›æ–­è¨€èƒ½å¤Ÿé¢„å…ˆæ’é™¤ä¸€äº›é—®é¢˜ã€‚</p>
<pre><code class="language-cpp">// bad
req.type = Type::foo;  // å…¶ä»–äººçœ‹ä¸æ‡‚è¿™ä¸€è¡Œçš„ç›®çš„æ˜¯ä»€ä¹ˆ
EXPECT_EQ(req.get_value(), 1);

// good
req.type = Type::foo;
ASSERT_TRUE(context.is_foo());  // è¿™é‡Œè¡¨æ˜ï¼Œä¸Šä¸€è¡Œæ˜¯ä¸ºäº†å½±å“ä»£ç é‡Œè¿™ä¸ªåˆ¤æ–­å‡½æ•°çš„ç»“æœ
EXPECT_EQ(req.get_value(), 1);
</code></pre>
</li>
</ul>
<h4 id="è§£é™¤å¯¹å¤–éƒ¨é€»è¾‘çš„ä¾èµ–--è€¦åˆ-å»ºè®®">è§£é™¤å¯¹å¤–éƒ¨é€»è¾‘çš„ä¾èµ– / è€¦åˆ <code>[å»ºè®®]</code></h4>
<ul>
<li>å¦‚æœè¢«æµ‹ä»£ç é‡Œç”¨åˆ°äº†æŸä¸ªå…¨å±€å˜é‡ï¼š
<ul>
<li>Badï¼šä»è¯·æ±‚å…¥å£å¼€å§‹æ‰§è¡Œå…¨éƒ¨ä»£ç ã€é—´æ¥æ„é€ è¯¥å˜é‡ã€‚è¿™æ ·å¤ªé»‘ç›’äº†ã€‚</li>
<li>Goodï¼šç›´æ¥å°±åœ°æ„é€ å˜é‡ï¼Œç„¶åèµ‹å€¼åˆ°å…¨å±€å­—æ®µä¸Šã€‚</li>
</ul>
</li>
<li>å¦‚æœè¢«æµ‹ä»£ç é‡Œè°ƒç”¨äº†æŸä¸ªå‡½æ•°ï¼š
<ul>
<li>Badï¼šæƒ³åŠæ³•æ„é€ å¤–éƒ¨å‡½æ•°çš„è¾“å…¥ï¼Œä»¥æ­¤æ¥å½±å“å…¶è¿”å›ç»“æœã€‚è¿™æ ·ä¼šå¯¼è‡´è¢«æµ‹å‡½æ•°ä¸å¤–éƒ¨å‡½æ•°è€¦åˆ â€”â€” éœ€è¦çœ‹å¤–éƒ¨å‡½æ•°çš„å®ç°é€»è¾‘ï¼Œä¸”å¦‚æœåç»­å¤–éƒ¨å‡½æ•°æ”¹åŠ¨äº†ï¼Œå½“å‰å‡½æ•°çš„å•æµ‹å¯èƒ½ä¼šä¸é€šè¿‡ã€‚</li>
<li>Goodï¼šä½¿ç”¨ GMock åŠ«æŒè¯¥å‡½æ•°ï¼Œåœ¨å•æµ‹é‡Œæ§åˆ¶å…¶è¿”å›ç»“æœã€‚å®Œå…¨ä¸éœ€è¦å…³å¿ƒå¤–éƒ¨å‡½æ•°çš„å®ç°ã€‚</li>
</ul>
</li>
</ul>
<h4 id="ä¸ºå•æµ‹è¡¥å……è¯¦ç»†çš„æ³¨é‡Š-å»ºè®®">ä¸ºå•æµ‹è¡¥å……è¯¦ç»†çš„æ³¨é‡Š <code>[å»ºè®®]</code></h4>
<p>å•æµ‹å†™å‡ºæ¥å¿…é¡»çš„ç™½ç›’çš„ã€å¯ç†è§£çš„ã€å¯ç»´æŠ¤çš„ã€‚å¦‚æœä¸è¡¥å……æ³¨é‡Šï¼Œå…¶ä»–äººæ ¹æœ¬çœ‹ä¸æ‡‚è¿™äº›å•æµ‹åœ¨æµ‹è¯•ä»€ä¹ˆé€»è¾‘ï¼Œä¹Ÿæ— æ³•ç¡®ä¿å…¶æœ‰æ•ˆï¼Œåç»­ä¿®å•æµ‹ä¹Ÿå¾ˆç—›è‹¦ã€‚</p>
<p>ä¸ºå•æµ‹è¡¥å……æ³¨é‡Šæ—¶ï¼Œé‡ç‚¹è¦è¯´æ˜ã€Œè¿™äº›èµ‹å€¼å¯¹åº”äº†å“ªä¸ªåˆ†æ”¯æ¡ä»¶ã€ï¼Œç›®æ ‡æ˜¯è®©å…¶ä»–äººæ‰«ä¸€çœ¼æºç å°±èƒ½çŸ¥é“è¿™äº›å•æµ‹åœ¨æµ‹è¯•å“ªäº›é€»è¾‘ã€‚</p>
<pre><code class="language-cpp">// bad
req.type = Type::foo;
req.from = &quot;localhost&quot;;
EXPECT_EQ(ctx.get_value(), 5);

// goodï¼šè¡¥å……æ³¨é‡Š
req.type = Type::foo;  // is_foo()
req.from = &quot;localhost&quot;;  // is_local_req()
EXPECT_EQ(ctx.get_value(), 5);  // æœ¬åœ°è¯·æ±‚ï¼Œé»˜è®¤å€¼æ˜¯ 5

// bestï¼šä»£ç å³æ³¨é‡Š
req.type = Type::foo;
ASSERT_TRUE(ctx-&gt;is_foo());
req.from = &quot;localhost&quot;;
ASSERT_TRUE(ctx-&gt;is_local_req());
EXPECT_EQ(ctx.get_value(), 5);  // æœ¬åœ°è¯·æ±‚ï¼Œé»˜è®¤å€¼æ˜¯ 5
</code></pre>
<h3 id="å†™ç¨³å®šçš„å•æµ‹">å†™ç¨³å®šçš„å•æµ‹</h3>
<h4 id="mock-æ‰€æœ‰-ioä¸è¦ä¾èµ–å¤–éƒ¨æ•°æ®-å¼ºåˆ¶">Mock æ‰€æœ‰ IOï¼Œä¸è¦ä¾èµ–å¤–éƒ¨æ•°æ® <code>[å¼ºåˆ¶]</code></h4>
<p>å•æµ‹é‡Œ<strong>ç¦æ­¢è®¿é—®å¤–éƒ¨æœåŠ¡</strong>ï¼Œæœ€å¥½æ˜¯æ•´ä¸ªå•æµ‹èƒ½å¤Ÿæ–­ç½‘ã€‚</p>
<p>ä¹‹å‰é‡åˆ°çš„å®é™… caseï¼š</p>
<ul>
<li>å•æµ‹ä¾èµ–çº¿ä¸ŠæœåŠ¡ï¼Œå¯¼è‡´å¿…é¡»åœ¨ä¸€å°çº¿ä¸Šç¯å¢ƒçš„å®¹å™¨é‡Œæ‰èƒ½å¯åŠ¨å•æµ‹ã€‚</li>
<li>å•æµ‹ä¾èµ–äº†çº¿ä¸Š redis é‡Œçš„æµ‹è¯•æ•°æ®ï¼Œè¿‡äº†åŠå¹´åæ•°æ®è¿‡æœŸäº†ï¼Œçº¿ä¸Šå•æµ‹çªç„¶æŒ‚äº†ã€‚</li>
</ul>
<h2 id="å‚è€ƒæ–‡æ¡£">å‚è€ƒæ–‡æ¡£</h2>
<p>
<a href="http://google.github.io/googletest/primer.html"  target="_blank" rel="noopener noreferrer" >Gtest å®˜æ–¹æ‰‹å†Œ (Google Test Primer)</a>
 ï¼Œä»¥åŠéƒ¨é—¨å†…çš„åˆ†äº«ã€‚</p>

</main>

<style>
    

    

    body {
        margin-right: 280px;
    }

    @media (max-width: 768px) {
        body {
            margin-right: 0;
        }
    }

    

     
    .article-meta {
        text-align: center;
        text-decoration: none;
        background: #efefef;
        padding: 1px;
        border-radius: 5px;
    }

    .article-meta-title {
        font-size: 2.2rem;
    }

    .article-meta-info {
        color: #666;
        font-size: 1.1rem;
        margin: -0.6rem 0 0.2rem 10px;
        text-align: left;
    }

    .article-meta-info a {
        color: inherit;
        text-decoration: none;
        transition: color 0.3s ease;
    }
</style>



<h1 style="font-size: 1.2rem; margin: 2.5rem 0 0.1rem 0;">Comment</h1>
<div class="cusdis-comments">
  <div id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id=697d528d-b618-4ee1-a6fe-403c81a646ac
    data-page-id="e46121929941386cdcd2c7785bf6fcc5"
    data-page-url="https://kaikaixixi.xyz/%E8%BD%AC%E8%BD%BD/2025/04/16/gtest_gmock-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5%E6%89%8B%E5%86%8C/"
    data-page-title="GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ | [è½¬è½½](https://imageslr.com/2023/gtest.html)"
  ></div>
  <script async defer src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/cusdis/cusdis.es.min.js"></script>
</div>

<style>
.cusdis-comments {
  border-top: 2px dashed #cfcfcf;
  padding-top: 1.3rem;
}

#cusdis_thread iframe {
  min-height: 500px !important;
  overflow: visible !important;
}
</style>


<footer>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/auto-render.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/math-code.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/render-katex.min.js"></script>

  <script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/js/center-img.min.js"></script>

  

<div id="menuBtnContainer">
    
    <button id="menuBtn"><i class="fa-solid fa-screwdriver-wrench"></i></button>

    
    <button id="backToBottomBtn" class="menu-popup-btn top-btn"><i class="fa-solid fa-square-caret-down"></i></button>
    <button id="backToTopBtn" class="menu-popup-btn top-btn"><i class="fa-solid fa-square-caret-up"></i></button>

    
    <div class="menu-popup-btn edit-btn">
        <a href='https://github.com/captainwc/captainwc.github.io/edit/main/content/%e7%bd%91%e9%a1%b5%e5%89%aa%e8%97%8f/GTest_GMock%20%e5%8d%95%e5%85%83%e6%b5%8b%e8%af%95%e5%ae%9e%e8%b7%b5%e6%89%8b%e5%86%8c.md'
            target="_blank" rel="noopener">
            <i class="fa-solid fa-square-pen"></i>
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var menuBtn = document.getElementById('menuBtn');
        var menuBtnContainer = document.getElementById('menuBtnContainer');
        var backToTopBtn = document.getElementById('backToTopBtn');
        var backToBottomBtn = document.getElementById('backToBottomBtn');
        var popupBtns = document.querySelectorAll('.menu-popup-btn');
        var hoverTimeout;

        
        menuBtnContainer.classList.add('visible');

        
        function showPopupBtns() {
            clearTimeout(hoverTimeout);
            menuBtnContainer.classList.add('active');
        }

        
        function hidePopupBtns() {
            hoverTimeout = setTimeout(function() {
                menuBtnContainer.classList.remove('active');
            }, 300);
        }

        
        menuBtnContainer.addEventListener('mouseenter', showPopupBtns);
        menuBtnContainer.addEventListener('mouseleave', hidePopupBtns);

        
        menuBtn.addEventListener('click', function() {
            if (menuBtnContainer.classList.contains('active')) {
                menuBtnContainer.classList.remove('active');
            } else {
                showPopupBtns();
            }
        });

        
        backToTopBtn.addEventListener('click', function() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });

        
        backToBottomBtn.addEventListener('click', function() {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth'
            });
        });
    });
</script>

<style>
     
    #menuBtnContainer {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 999;
        opacity: 0.6;
        visibility: visible;
        transition: opacity 0.3s;
    }

    #menuBtnContainer:hover {
        opacity: 1;
    }

     
    #menuBtn {
        border-radius: 8px;
        border: none;
        color: #aaa;
        font-family: "Maple Mono NF CN";
        font-size: 1.2rem;
        transition: background 0.3s;
        cursor: pointer;
        background: #EFEFEF;
        z-index: 1000;
        position: relative;
    }

    #menuBtn:hover {
        background: #BEC2B3;
        color: #666;
    }

     
    .menu-popup-btn {
        position: absolute;
        opacity: 0;
        visibility: hidden;
        border-radius: 8px;
        border: none;
        color: #aaa;
        font-family: "Maple Mono NF CN";
        font-size: 1.3rem;
        transition: all 0.3s ease;
        background: #EFEFEF;
        cursor: pointer;
        z-index: 999;
    }

     
    .menu-popup-btn.top-btn {
        right: 0;
        transform: translateY(0) scale(0.8);
    }

     
    .menu-popup-btn.edit-btn {
        bottom: 0;
        transform: translateX(0) scale(0.8);
        padding: 1px 6.6px 0px 6.6px;
    }

    .menu-popup-btn.edit-btn a {
        color: #ccc;
        text-decoration: none;
        background: none !important;
        transition: opacity 0.2s;
        padding: 0;
        margin: 0;
    }

     
    #menuBtnContainer.active .menu-popup-btn {
        opacity: 1;
        visibility: visible;
    }

     
    #menuBtnContainer.active #backToBottomBtn {
        transform: translateY(-60px) scale(1);
    }

     
    #menuBtnContainer.active #backToTopBtn {
        transform: translateY(-110px) scale(1);
    }

     
    #menuBtnContainer.active .edit-btn {
        transform: translateX(-60px) scale(1);
    }

     
    .menu-popup-btn:hover,
    .menu-popup-btn.edit-btn:hover {
        background: #BEC2B3;
        color: #666;
    }

    .menu-popup-btn.edit-btn:hover a {
        color: #666;
    }

     
    @media (max-width: 768px) {
        #menuBtnContainer {
            right: 15px;
            bottom: 15px;
        }

        #menuBtnContainer.active #backToBottomBtn {
            transform: translateY(-50px) scale(1);
        }

        #menuBtnContainer.active #backToTopBtn {
            transform: translateY(-90px) scale(1);
        }

        #menuBtnContainer.active .edit-btn {
            transform: translateX(-50px) scale(1);
        }
    }
</style>



  <script>
  document.addEventListener('DOMContentLoaded', function() {
    
    document.querySelectorAll('ul').forEach(ul => {
      
      const isTodoList = Array.from(ul.children).some(li => {
        return li.innerHTML.includes('type="checkbox"')
      });

      if (isTodoList) {
        
        const todolistContainer = document.createElement('div');
        todolistContainer.className = 'todolist';

        

        
        ul.querySelectorAll('li').forEach(li => {
          const todoItemDiv = document.createElement('div');
          todoItemDiv.className = 'todo-item';

          
          const isChecked = li.innerHTML.includes('checked');
          const content = li.innerHTML
            .replace(/<input[^>]+>/g, '') 
            .trim();

          
          const checkedIcon = `<svg t="1742522457277" class="todo-item-checked-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12342"><path d="M512 938.688A426.624 426.624 0 1 1 512 85.376a426.624 426.624 0 0 1 0 853.312z m0-85.312A341.312 341.312 0 1 0 512 170.688a341.312 341.312 0 0 0 0 682.688z m-42.56-170.688L288.448 501.632l60.288-60.288L469.44 561.92l241.28-241.28 60.416 60.288-301.696 301.696z" p-id="12343"></path></svg>`;
          const uncheckedIcon = `<svg t="1742522354856" class="todo-item-unchecked-icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11882"><path d="M512 938.666667C276.352 938.666667 85.333333 747.648 85.333333 512S276.352 85.333333 512 85.333333s426.666667 191.018667 426.666667 426.666667-191.018667 426.666667-426.666667 426.666667z m0-85.333334a341.333333 341.333333 0 1 0 0-682.709333A341.333333 341.333333 0 0 0 512 853.333333z" p-id="11883"></path></svg>`;

          
          todoItemDiv.innerHTML = `
            <span class="todo-item-checkbox">
              ${isChecked ? checkedIcon : uncheckedIcon}
            </span>
            <span class="todo-item-content">
              ${isChecked ? `<del>${content}</del>` : content}
            </span>
          `;

          
          todolistContainer.appendChild(todoItemDiv);
        });

        
        ul.parentNode.replaceChild(todolistContainer, ul);
      }
    });

    function addTaskProgressBar(ul, todolistContainer) {
      
      const totalTasks = ul.children.length;
      const finishedTasks = Array.from(ul.children).filter(li => li.innerHTML.includes('checked')).length;

      
      const progressContainer = document.createElement('div');
      progressContainer.className = 'todo-progress';

      
      const counterSpan = document.createElement('span');
      counterSpan.className = 'todo-progress-counter';
      counterSpan.textContent = `${finishedTasks}/${totalTasks}`;

      
      const progressTrack = document.createElement('div');
      progressTrack.className = 'todo-progress-bar';

      
      const progressFill = document.createElement('div');
      progressFill.className = 'todo-progress-bar-fill';
      progressFill.style.width = `${(finishedTasks / totalTasks) * 100}%`;

      
      const flagSpan = document.createElement('span');
      flagSpan.className = 'todo-progress-flag';
      flagSpan.innerHTML = `${finishedTasks === totalTasks ? 'ğŸŒŸ' : 'ğŸš§'}`;

      
      progressTrack.appendChild(progressFill);
      progressContainer.append(flagSpan, progressTrack, counterSpan);
      todolistContainer.appendChild(progressContainer);
    }
  });
</script>

<style>
   
  .todolist {
    padding-left: 0.6rem;
  }

  .todo-item {
    padding: 0.2rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    margin: -0.5rem 0 -0.5rem -0.7rem;
    line-height: 1.3;
  }

  .todo-item-checkbox {
    flex-shrink: 0;
    font-size: 1.2em;

    svg {
      margin-top: 0.46rem;
      width: 16px !important;
      height: 16px !important;
    }
  }

  .todo-item-checked-icon {
    fill: #707070;
  }

  .todo-item-unchecked-icon {
    fill: #1A61CC;
  }

  .todo-item-unchecked-icon:hover {
    fill: red;
    width: 20px !important;
    height: 20px !important;
  }

  .todo-item-content {
    flex: 1;
    word-break: break-all;

    p {
      margin: 0;
      padding: 0;
    }
  }

   
  .todo-progress {
    display: flex;
     
    align-items: center;
    gap: 0.3rem;
     
    margin: 0.1rem 0 0 0.7rem;
  }

  .todo-progress-counter {
     
    font-family: "LXGW WenKai";
    font-size: 0.8rem;
    color: #707070;
  }

  .todo-progress-bar {
    flex: 1;
    height: 2px;
    background: #a64036;
    border-radius: 10px;
    position: relative;
    overflow: hidden;
    max-width: 20%;
  }

  .todo-progress-bar-fill {
    height: 100%;
    background: #84a729;
    transition: width 0.3s ease;
  }

  .todo-progress-flag {
    display: none;
    position: relative;
    font-size: 0.9rem;
  }
</style>


  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.11.1/build/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/gh/captainwc/cdn-release/website/highlight/highlight.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', () => hljs.highlightAll())</script>



  <script>
    const langToNerdFontMap = {
        asm: '\ue6ab',
        bash: '\ue760',
        bazel: '\ue63a',
        c: '\ue61e',
        cmake: '\ue794',
        cmd: '\uebc4',
        cpp: '\ue61d',
        'c++': '\ue61d',
        csharp: '\ue7b2',
        css: '\ue749',
        diff: '\ueae1',
        dockerfile: '\uf21f',
        go: '\udb81\udfd3',
        gradle: '\ue7f2',
        html: '\ue736',
        java: '\uedaf',
        javascript: '\ue781',
        json: '\ueb0f',
        latex: '\ue81f',
        llvm: '\ue823',
        lua: '\ue826',
        makefile: '\ue673',
        markdown: '\uf48a',
        maven: '\ue82c',
        plaintext: '\udb80\udd4d',
        plantuml: '\ue8cb',
        powershell: '\ue86c',
        python: '\ued1b',
        rust: '\udb85\ude17',
        shell: '\ue760',
        sql: '\udb82\udc66',
        text: '\udb80\udd4d',
        toml: '\ue6b2',
        txt: '\udb80\udd4d',
        typescript: '\ue8ca',
        uml: '\ue8cb',
        vim: '\ue7c5',
        wasm: '\ue8e0',
        xml: '\ue8ea',
        yaml: '\ue8eb',
    };

    document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('pre > code').forEach(codeBlock => {
            const parentElement = codeBlock.parentElement;

            
            const tools = document.createElement('div');
            tools.className = 'code-tools';

            
            const foldBtn = document.createElement('button');
            foldBtn.className = 'fold-btn';
            foldBtn.innerHTML = '\uf48c';
            foldBtn.style.display = 'none';

            
            const langLabel = document.createElement('div');
            langLabel.className = 'lang-label';
            const lang = [...codeBlock.classList].find(c => c.startsWith('language-'))?.split('-')[1] || 'text';
            const icon = langToNerdFontMap[lang.toLowerCase()];
            langLabel.textContent = icon || lang.toUpperCase();
            if (!icon) langLabel.style.fontSize = '0.8rem';

            
            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn';
            copyBtn.textContent = '\uf4bb COPY';

            
            const scale_height = 600;       
            const collapsed_height = 500;   
            const checkHeight = () => {
                const originalDisplay = parentElement.style.display;
                parentElement.style.display = 'block';
                const fullHeight = parentElement.scrollHeight;
                parentElement.style.display = originalDisplay;
                return fullHeight > scale_height;
            };

            
            if (checkHeight()) {
                foldBtn.style.display = 'flex';
                parentElement.dataset.fullHeight = `${parentElement.scrollHeight}px`;

                
                parentElement.classList.add('collapsed');
                parentElement.style.maxHeight = `${collapsed_height}px`;
                foldBtn.innerHTML = '\uf4d9';

                parentElement.style.overflowY = 'auto'; 

                foldBtn.addEventListener('click', () => {
                    const isCollapsed = parentElement.classList.toggle('collapsed');
                    foldBtn.innerHTML = isCollapsed ? '\uf4d9' : '\uf48c';

                    if (isCollapsed) {
                        parentElement.style.maxHeight = `${collapsed_height}px`;
                        parentElement.style.overflowX = 'auto';
                    } else {
                        parentElement.style.maxHeight = 'none';
                        void parentElement.offsetHeight;
                        parentElement.dataset.fullHeight = `${parentElement.scrollHeight}px`;
                    }
                });
            }

            
            copyBtn.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(codeBlock.textContent);
                    copyBtn.textContent = '\uf00c COPIED!';
                    setTimeout(() => copyBtn.textContent = '\uf4bb COPY', 2000);
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
            });

            
            tools.append(langLabel, foldBtn, copyBtn);
            parentElement.prepend(tools);
        });
    });
</script>

<style>
 
.code-tools {
    position: absolute;
    right: 10px;
    top: 20px;
    display: flex;
    align-items: center;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.2s ease;
    pointer-events: none;
    font-family: "Maple Mono NF CN";
}

.fold-btn {
    cursor: pointer;
    border: none;
    color: #666;
    background: none;
    font-family: "Maple Mono NF CN";
    font-size: 0.9rem;
    line-height: 1.2;
    margin: 0 0 0 0.45rem;
    transition: all 0.2s ease;
}

 
.lang-label {
     
    color: #666;
    font-size: 1.2rem;
    line-height: 1.2;
}

 
.copy-btn {
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 0 0.3rem;
    margin: 0 0 0 0.6rem;
    color: #333;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    font-size: 0.6rem;
    line-height: 1.8;
    cursor: pointer;
    font-family: "Maple Mono NF CN";
}

 
pre:hover .code-tools {
    opacity: 1;
    pointer-events: auto;
}
</style>


  
<script>
    
    window.diagramRenderUtils = {
        
        getOrCreateFullscreenOverlay: function() {
            let overlay = document.querySelector('.fullscreen-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'fullscreen-overlay';
                document.body.appendChild(overlay);

                
                overlay.addEventListener('dblclick', (e) => {
                    if (e.target === overlay) {
                        overlay.classList.remove('active');
                    }
                });

                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && overlay.classList.contains('active')) {
                        overlay.classList.remove('active');
                    }
                });
            }
            return overlay;
        },

        
        createDiagramContainer: function() {
            const container = document.createElement('div');
            container.className = 'code-rendered-diagram';
            return container;
        },

        
        createCopyButton: function() {
            const copyButton = document.createElement('button');
            copyButton.className = 'code-rendered-diagram-copy-button';
            copyButton.innerHTML = '&#xf4bb; COPY-SRC';
            return copyButton;
        },

        
        createFullscreenButton: function() {
            const fullscreenButton = document.createElement('button');
            fullscreenButton.className = 'code-rendered-diagram-fullscreen-button';
            fullscreenButton.innerHTML = '&#xf065; FULL';
            return fullscreenButton;
        },

        
        makeSVGTransparent: function(svgText) {
            const doc = new DOMParser().parseFromString(svgText, 'image/svg+xml');
            doc.querySelectorAll('[fill="#ffffff"],[fill="white"],[style*="fill: white"]')
                .forEach(el => {
                    if (el.tagName !== 'svg') {
                        el.setAttribute('fill', 'transparent');
                    }
                });
            doc.documentElement.style.backgroundColor = 'transparent';
            return new XMLSerializer().serializeToString(doc);
        },

        
        setupCopyButton: function(copyButton, codeContent) {
            copyButton.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(codeContent);
                    copyButton.textContent = '\uf00c COPIED!';
                    setTimeout(() => copyButton.innerHTML = '&#xf4bb; COPY-SRC', 2000);
                } catch (err) {
                    copyButton.textContent = 'FAILED';
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
            });
        },

        
        setupShowSourceCode: function(imageElem, sourceCode) {
            
            imageElem.addEventListener('contextmenu', function(e) {
                e.preventDefault();

                
                const pre = document.createElement('pre');
                const codeElem = document.createElement('code');
                codeElem.textContent = sourceCode;
                pre.appendChild(codeElem);

                
                window.diagramRenderUtils.popupWindowUtils.create({
                    title: 'Source Code',
                    content: pre,
                    x: e.clientX,
                    y: e.clientY,
                    minWidth: 300,
                    maxWidth: '60%',
                    maxHeight: '60%',
                    closeOnClickOutside: true,
                    closeOnEsc: true,
                    className: 'source-code-viewer'
                });
            });
        },

        
        setupFullscreenButton: function(fullscreenButton, contentElement, isImage = false) {
            fullscreenButton.addEventListener('click', () => {
                const overlay = this.getOrCreateFullscreenOverlay();
                let clonedContent;

                if (isImage) {
                    
                    clonedContent = contentElement.cloneNode(true);
                } else {
                    
                    const svgElement = contentElement.querySelector('svg');
                    if (!svgElement) return;
                    clonedContent = svgElement.cloneNode(true);
                }

                overlay.innerHTML = '';

                
                const exitButton = document.createElement('button');
                exitButton.className = 'fullscreen-exit-button';
                exitButton.innerHTML = 'ESC';
                exitButton.onclick = () => overlay.classList.remove('active');

                overlay.appendChild(exitButton);
                overlay.appendChild(clonedContent);
                overlay.classList.add('active');

                
                this.setupZoomAndDrag(overlay, isImage ? 'img' : 'svg');
            });
        },

        
        setupZoomAndDrag: function(overlay, selector) {
            let scale = 1;
            let posX = 0;
            let posY = 0;
            let isDragging = false;
            let startX = 0;
            let startY = 0;

            const element = overlay.querySelector(selector);

            
            overlay.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY * -0.002;
                const newScale = Math.min(Math.max(scale + delta, 0.1), 10);

                
                const rect = element.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                
                posX += mouseX * (1 - newScale / scale);
                posY += mouseY * (1 - newScale / scale);

                scale = newScale;
                updateTransform();
            });

            
            overlay.addEventListener('mousedown', (e) => {
                if (e.target === overlay) return;
                isDragging = true;
                startX = e.clientX - posX;
                startY = e.clientY - posY;
                overlay.classList.add('dragging');
            });

            window.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                posX = e.clientX - startX;
                posY = e.clientY - startY;
                updateTransform();
            });

            window.addEventListener('mouseup', () => {
                isDragging = false;
                overlay.classList.remove('dragging');
            });

            function updateTransform() {
                element.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
            }
        },

        
        popupWindowUtils: {
            
            create: function(options) {
                
                const config = {
                    title: 'Popup Window',
                    content: '',         
                    x: 100,              
                    y: 100,              
                    minWidth: 300,       
                    maxWidth: '80%',     
                    maxHeight: '80%',    
                    closeOnClickOutside: true,
                    closeOnEsc: true,
                    onClose: null,       
                    className: ''        
                };

                
                Object.assign(config, options);

                
                if (config.className) {
                    const existingPopup = document.querySelector(`.popup-window.${config.className}`);
                    if (existingPopup) {
                        document.body.removeChild(existingPopup);
                    }
                }

                
                const popup = document.createElement('div');
                popup.className = `popup-window ${config.className}`.trim();

                
                const titleBar = document.createElement('div');
                titleBar.className = 'popup-window-title';
                titleBar.textContent = config.title;

                
                const closeButton = document.createElement('button');
                closeButton.className = 'popup-window-close';
                closeButton.innerHTML = '&times;';

                
                titleBar.appendChild(closeButton);

                
                const contentContainer = document.createElement('div');
                contentContainer.className = 'popup-window-content';

                
                if (typeof config.content === 'string') {
                    contentContainer.innerHTML = config.content;
                } else if (config.content instanceof Element) {
                    contentContainer.appendChild(config.content);
                }

                
                popup.appendChild(titleBar);
                popup.appendChild(contentContainer);

                
                popup.style.minWidth = typeof config.minWidth === 'number' ? `${config.minWidth}px` : config.minWidth;
                popup.style.maxWidth = typeof config.maxWidth === 'number' ? `${config.maxWidth}px` : config.maxWidth;
                popup.style.maxHeight = typeof config.maxHeight === 'number' ? `${config.maxHeight}px` : config.maxHeight;

                
                document.body.appendChild(popup);

                
                const popupRect = popup.getBoundingClientRect();
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;

                
                let left = Math.min(Math.max(config.x, 20), windowWidth - popupRect.width - 20);
                let top = Math.min(Math.max(config.y, 20), windowHeight - popupRect.height - 20);

                popup.style.left = `${left}px`;
                popup.style.top = `${top}px`;

                
                const closePopup = () => {
                    if (document.body.contains(popup)) {
                        document.body.removeChild(popup);
                        if (typeof config.onClose === 'function') {
                            config.onClose();
                        }
                    }
                };

                closeButton.addEventListener('click', closePopup);

                
                if (config.closeOnEsc) {
                    const escHandler = (e) => {
                        if (e.key === 'Escape' && document.body.contains(popup)) {
                            closePopup();
                            document.removeEventListener('keydown', escHandler);
                        }
                    };
                    document.addEventListener('keydown', escHandler);
                }

                
                if (config.closeOnClickOutside) {
                    const outsideClickHandler = (e) => {
                        if (popup && !popup.contains(e.target) && document.body.contains(popup)) {
                            closePopup();
                            document.removeEventListener('mousedown', outsideClickHandler);
                        }
                    };

                    
                    setTimeout(() => {
                        document.addEventListener('mousedown', outsideClickHandler);
                    }, 100);
                }

                
                let isDragging = false;
                let offsetX = 0;
                let offsetY = 0;

                titleBar.addEventListener('mousedown', (e) => {
                    
                    if (e.target !== closeButton) {
                        isDragging = true;
                        offsetX = e.clientX - popup.getBoundingClientRect().left;
                        offsetY = e.clientY - popup.getBoundingClientRect().top;
                        popup.classList.add('dragging');
                    }
                });

                const mouseMoveHandler = (e) => {
                    if (isDragging) {
                        let newLeft = e.clientX - offsetX;
                        let newTop = e.clientY - offsetY;

                        
                        newLeft = Math.max(0, Math.min(windowWidth - popupRect.width, newLeft));
                        newTop = Math.max(0, Math.min(windowHeight - popupRect.height, newTop));

                        popup.style.left = `${newLeft}px`;
                        popup.style.top = `${newTop}px`;
                    }
                };

                const mouseUpHandler = () => {
                    if (isDragging) {
                        isDragging = false;
                        popup.classList.remove('dragging');
                    }
                };

                document.addEventListener('mousemove', mouseMoveHandler);
                document.addEventListener('mouseup', mouseUpHandler);

                
                return {
                    element: popup,
                    contentElement: contentContainer,
                    close: closePopup,
                    setTitle: (title) => {
                        titleBar.textContent = title;
                        titleBar.appendChild(closeButton); 
                    },
                    setContent: (content) => {
                        contentContainer.innerHTML = '';
                        if (typeof content === 'string') {
                            contentContainer.innerHTML = content;
                        } else if (content instanceof Element) {
                            contentContainer.appendChild(content);
                        }
                    },
                    setPosition: (x, y) => {
                        let newLeft = Math.min(Math.max(x, 0), windowWidth - popupRect.width);
                        let newTop = Math.min(Math.max(y, 0), windowHeight - popupRect.height);
                        popup.style.left = `${newLeft}px`;
                        popup.style.top = `${newTop}px`;
                    },
                    
                    destroy: () => {
                        document.removeEventListener('mousemove', mouseMoveHandler);
                        document.removeEventListener('mouseup', mouseUpHandler);
                        if (document.body.contains(popup)) {
                            document.body.removeChild(popup);
                        }
                    }
                };
            }
        }
    };
</script>
<style>
     
    .code-rendered-diagram {
        max-width: 80% !important;
        height: auto;
        position: relative;

        svg {
            max-width: 100%;
            height: auto;
        }
    }

    .code-rendered-diagram-copy-button,
    .code-rendered-diagram-fullscreen-button {
        position: absolute;
        top: 20px;
        transform: translateY(-10px);
        transition: all 0.2s ease;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 5px;
        padding: 0 0.3rem;
        margin: 0 0 0 0.6rem;
        color: #333;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-size: 0.6rem;
        line-height: 1.8;
        cursor: pointer;
        font-family: "Maple Mono NF CN";
        opacity: 0;
    }

    .code-rendered-diagram-copy-button {
        right: 10px;
    }

    .code-rendered-diagram-fullscreen-button {
        right: 100px;
    }

    .code-rendered-diagram:hover .code-rendered-diagram-copy-button,
    .code-rendered-diagram:hover .code-rendered-diagram-fullscreen-button {
        opacity: 1;
    }

    .fullscreen-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #FBFBFB;
         
        z-index: 99999;
        justify-content: center;
        align-items: center;
    }

    .fullscreen-overlay.active {
        display: flex;
    }

    .fullscreen-overlay img,
    .fullscreen-overlay svg {
        max-width: 90%;
        max-height: 90%;
        object-fit: contain;
        cursor: move;
        transition: transform 0.1s ease-out;
        transform-origin: center center;
    }

    .fullscreen-overlay svg {
        user-select: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }

    .fullscreen-overlay.dragging {
        cursor: move;
    }

    .fullscreen-exit-button {
        position: fixed;
        top: 20px;
        left: 20px;
        background-color: #f0f0f0;
        border: 1px solid #ccc;
        border-radius: 6px;
        color: #666;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        font-size: 0.8rem;
        line-height: 1.8;
        cursor: pointer;
        font-family: "Maple Mono NF CN";
        transition: all 0.2s ease;
        z-index: 100000;
    }

    .fullscreen-exit-button:hover {
        background-color: #e0e0e0;
        color: #333;
    }

     
    .popup-window {
        position: fixed;
        z-index: 10000;
        background-color: #f8f8f8;
        border: 1px solid #ccc;
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transition: box-shadow 0.3s ease;
    }

    .popup-window.dragging {
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
        opacity: 0.95;
    }

    .popup-window-title {
        background-color: #e8e8e8;
        padding: 8px 12px;
        font-weight: bold;
        border-bottom: 1px solid #ddd;
        cursor: move;
        user-select: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        color: #333;
        font-family: "Maple Mono NF CN", monospace;
        font-size: 0.9rem;
    }

    .popup-window-close {
        background: none;
        border: none;
        font-size: 1.2rem;
        line-height: 1;
        cursor: pointer;
        color: #666;
        padding: 0 4px;
        margin: -4px -4px 0 0;
        transition: color 0.2s ease;
    }

    .popup-window-close:hover {
        color: #333;
    }

    .popup-window-content {
        overflow: auto;
        padding: 10px;
        font-size: 0.9rem;
    }

     
    .popup-window.source-code-viewer .popup-window-content {
        font-family: "Maple Mono NF CN", monospace;
    }

    .popup-window.source-code-viewer .popup-window-content pre {
        margin: 0;
        white-space: pre-wrap;
    }

    .popup-window.source-code-viewer .popup-window-content code {
        font-family: "Maple Mono NF CN", monospace;
        color: #333;
    }
</style>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const plantumlBlocks = document.querySelectorAll('pre code.language-plantuml');
        if (!plantumlBlocks.length) return;

        
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/plantuml-encoder@1.4.0/dist/plantuml-encoder.min.js';

        
        script.onload = () => {
            const plantuml_theme = parsePlantumlUserConfig();

            plantumlBlocks.forEach(codeBlock => {
                
                const container = window.diagramRenderUtils.createDiagramContainer();

                
                const img = document.createElement('img');
                img.className = 'code-rendered-diagram-img';
                img.style.display = 'block';
                img.alt = 'PlantUML Diagram';

                
                const fullCode = `${plantuml_theme}\n\n${codeBlock.textContent}`;
                img.src = 'https://www.plantuml.com/plantuml/svg/' + plantumlEncoder.encode(fullCode);

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, fullCode);

                
                window.diagramRenderUtils.setupShowSourceCode(img, fullCode);

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, img, true);

                
                

                
                container.appendChild(img);
                container.appendChild(fullscreenButton);
                container.appendChild(copyButton);
                codeBlock.parentElement.replaceWith(container);
            });
        };

        
        document.head.appendChild(script);
    });

    function parsePlantumlUserConfig() {
        let configItems = [];

        
            configItems.push(`scale 5`);
        

        
            configItems.push(`skin rose`);
        

        
            configItems.push(`skinparam BackgroundColor transparent`);
        

        
        
            
                configItems.push(`skinparam shadowing false`);
            
        

        

        
            configItems.push(`skinparam BackgroundColor transparent`);
        

        return configItems.join("\n").trim();
    }
</script>

  
<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const mermaidBlocks = document.querySelectorAll('pre code.language-mermaid');
        if (!mermaidBlocks.length) return;

        
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js';

        
        script.onload = () => {
            
            mermaid.initialize({
                startOnLoad: false,
                securityLevel: 'loose',
                fontFamily: 'Maple Mono NF CN',
                
                look: 'handDrawn',
                
                theme: 'neutral',
                
                
            });

            
            mermaidBlocks.forEach((codeBlock, index) => {
                
                const container = window.diagramRenderUtils.createDiagramContainer();

                
                const renderDiv = document.createElement('div');
                renderDiv.id = `mermaid-diagram-${index}`;
                renderDiv.style.background = 'transparent';

                
                const code = codeBlock.textContent.trim();

                try {
                    
                    mermaid.render(`mermaid-svg-${index}`, code).then(result => {
                        renderDiv.innerHTML = result.svg;

                        
                        const svg = renderDiv.querySelector('svg');
                        if (svg) {
                            svg.style.backgroundColor = 'transparent';
                            
                            svg.querySelectorAll('[fill="#ffffff"],[fill="white"],[style*="fill: white"]')
                                .forEach(el => {
                                    if (el.tagName !== 'svg') {
                                        el.setAttribute('fill', 'transparent');
                                    }
                                });
                        }
                    });
                } catch (error) {
                    console.error('Mermaidæ¸²æŸ“é”™è¯¯:', error);
                    renderDiv.innerHTML = `<div style="color:red;border:1px solid red;padding:10px;">
                        Mermaidæ¸²æŸ“é”™è¯¯: ${error.message}
                    </div>`;
                }

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, code);

                
                window.diagramRenderUtils.setupShowSourceCode(renderDiv, code);

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, renderDiv, false);

                
                container.appendChild(renderDiv);
                container.appendChild(fullscreenButton);
                container.appendChild(copyButton);

                
                const pre = codeBlock.closest('pre');
                pre.insertAdjacentElement('afterend', container);
                pre.remove();
            });
        };

        
        document.head.appendChild(script);
    });
</script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const markmapBlocks = document.querySelectorAll('pre code.language-map, pre code.language-mindmap');
        if (!markmapBlocks.length) return;

        
        function loadScript(url) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = url;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        
        Promise.all([
            loadScript('https://cdn.jsdelivr.net/npm/d3@latest'),
            loadScript('https://cdn.jsdelivr.net/npm/markmap-view@latest'),
            loadScript('https://cdn.jsdelivr.net/npm/markmap-lib@latest')
        ]).then(() => {
            
            markmapBlocks.forEach((codeBlock, index) => {
                
                const container = window.diagramRenderUtils.createDiagramContainer();

                
                const markmapContainer = document.createElement('div');
                markmapContainer.className = 'markmap';
                markmapContainer.id = `markmap-${index}`;
                markmapContainer.style.minHeight = '300px';
                markmapContainer.style.width = '100%';
                markmapContainer.style.position = 'relative';

                
                const code = codeBlock.textContent.trim();

                
                const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svgElement.style.width = '100%';
                svgElement.style.height = '400px';
                markmapContainer.appendChild(svgElement);

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, code);

                
                window.diagramRenderUtils.setupShowSourceCode(markmapContainer, code);

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, markmapContainer, false);

                
                container.appendChild(markmapContainer);
                container.appendChild(fullscreenButton);
                container.appendChild(copyButton);

                
                const pre = codeBlock.closest('pre');
                pre.insertAdjacentElement('afterend', container);
                pre.remove();

                
                renderMarkmapWithRetry(svgElement, markmapContainer, code);
            });
        }).catch(error => {
            console.error('åŠ è½½markmapåº“å¤±è´¥:', error);
        });

        

        function renderMarkmapWithRetry(svgElement, markmapContainer, code, maxRetries = 5, delay = 200) {
            let attempt = 0;

            function tryRender() {
                attempt++;
                try {
                    
                    if (!window.markmap || typeof window.markmap.Markmap !== 'function') {
                        throw new Error('Markmap constructor not available yet.');
                    }

                    
                    const { Transformer } = window.markmap;
                    const transformer = new Transformer();

                    
                    const { root, features } = transformer.transform(code);

                    
                    const { Markmap } = window.markmap;
                    const mm = new Markmap(svgElement, {
                        autoFit: true,
                        duration: 500,
                        zoom: true,
                    });

                    
                    mm.setData(root, features);
                    mm.fit();

                    
                    markmapContainer.dataset.markmapData = JSON.stringify({
                        root: root,
                        features: features
                    });

                    
                    setTimeout(() => {
                        const links = svgElement.querySelectorAll('a');
                        links.forEach(link => {
                            link.setAttribute('target', '_blank');
                            link.setAttribute('rel', 'noopener noreferrer');
                        });
                    }, 100);

                } catch (error) {
                    console.error(`Markmapæ¸²æŸ“å°è¯•ç¬¬ ${attempt} æ¬¡å¤±è´¥:`, error.message);
                    if (attempt < maxRetries) {
                        
                        setTimeout(tryRender, delay);
                    } else {
                        
                        console.error('Markmapæ¸²æŸ“åœ¨å¤šæ¬¡é‡è¯•åä»ç„¶å¤±è´¥ã€‚');
                        markmapContainer.innerHTML = `<div style="color:red;border:1px solid red;padding:10px;">
                            Markmapæ¸²æŸ“é”™è¯¯: ${error.message} (è¯·å°è¯•æ‰‹åŠ¨åˆ·æ–°ç½‘é¡µ)
                        </div>`;
                    }
                }
            }

            
            tryRender();
        }
    });
</script>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        
        if (!window.diagramRenderUtils) return;

        
        const originalSetupFullscreenButton = window.diagramRenderUtils.setupFullscreenButton;
        window.diagramRenderUtils.setupFullscreenButton = function(fullscreenButton, contentElement, isImage = false) {
            
            const isMarkmap = contentElement.classList.contains('markmap');

            if (isMarkmap) {
                fullscreenButton.addEventListener('click', () => {
                    const overlay = this.getOrCreateFullscreenOverlay();
                    overlay.innerHTML = '';

                    
                    const exitButton = document.createElement('button');
                    exitButton.className = 'fullscreen-exit-button';
                    exitButton.innerHTML = 'ESC';
                    exitButton.onclick = () => overlay.classList.remove('active');
                    overlay.appendChild(exitButton);

                    
                    const fullscreenContainer = document.createElement('div');
                    fullscreenContainer.className = 'markmap';
                    fullscreenContainer.style.width = '100%';
                    fullscreenContainer.style.height = '100%';

                    
                    const svgElement = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svgElement.style.width = '100%';
                    svgElement.style.height = '100%';
                    fullscreenContainer.appendChild(svgElement);

                    overlay.appendChild(fullscreenContainer);
                    overlay.classList.add('active');

                    
                    try {
                        const markmapData = JSON.parse(contentElement.dataset.markmapData || '{}');
                        if (markmapData.root) {
                            
                            const { Markmap } = window.markmap;
                            const mm = new Markmap(svgElement, {
                                autoFit: true,
                                duration: 500,
                                zoom: true,
                            });

                            
                            mm.setData(markmapData.root, markmapData.features);
                            mm.fit();

                            
                            setTimeout(() => {
                                const links = svgElement.querySelectorAll('a');
                                links.forEach(link => {
                                    link.setAttribute('target', '_blank');
                                    link.setAttribute('rel', 'noopener noreferrer');
                                });
                            }, 100);
                        }
                    } catch (error) {
                        console.error('å…¨å±æ¨¡å¼ä¸‹æ¸²æŸ“markmapå¤±è´¥:', error);
                    }

                    
                    this.setupZoomAndDrag(overlay, 'svg');
                });
            } else {
                
                originalSetupFullscreenButton.call(this, fullscreenButton, contentElement, isImage);
            }
        };
    });
</script>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const xmindBlocks = document.querySelectorAll('pre code.language-xmind');
        if (xmindBlocks.length === 0) {
            return;
        }

        
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/xmind-embed-viewer/dist/umd/xmind-embed-viewer.js';
        document.head.appendChild(script);

        
        script.onload = function() {
            xmindBlocks.forEach((codeBlock, index) => {
                const xmindUrl = codeBlock.textContent.trim();
                if (!xmindUrl) {
                    console.error('XMind code block is empty.');
                    return;
                }

                
                const mountId = `xmind-mount-${index}`;
                const mountDiv = document.createElement('div');
                mountDiv.id = mountId;

                
                const preElement = codeBlock.parentElement;
                preElement.parentElement.replaceChild(mountDiv, preElement);

                renderXmindFile(mountId, xmindUrl);
            });

            async function renderXmindFile(elementId, fileUrl) {
                const mountEl = document.getElementById(elementId);

                
                
                mountEl.className = 'xmind-container';
                
                mountEl.innerHTML = `
                <div class="xmind-loader-wrapper">
                    <div class="xmind-loader"></div>
                    <div class="xmind-loader-text">xmind loading</div>
                </div>
            `;

                try {
                    
                    const isExternal = fileUrl.startsWith('http');
                    const fetchUrl = isExternal ? `https://api.allorigins.win/raw?url=${encodeURIComponent(fileUrl)}` : fileUrl;
                    const res = await fetch(fetchUrl, {
                        mode: 'cors'
                    });

                    
                    if (!res.ok) {
                        mountEl.innerHTML = `
                        <div class="xmind-error">
                            <span class="xmind-error-icon">âš ï¸</span>
                            <div class="xmind-error-content">
                                <strong>åŠ è½½ XMind æ–‡ä»¶å¤±è´¥</strong>
                                <p>æ— æ³•ä» <code>${fileUrl}</code> è·å–æ–‡ä»¶ (HTTP ${res.status})</p>
                            </div>
                        </div>
                    `;
                        console.error(`Failed to fetch XMind file: ${res.statusText}`);
                        return;
                    }
                    const fileBuffer = await res.arrayBuffer();

                    
                    mountEl.className = ''; 
                    mountEl.innerHTML = ''; 

                    new XMindEmbedViewer({
                        el: `#${elementId}`,
                        file: fileBuffer,
                        styles: {
                            'height': '500px',
                            'width': '100%'
                        }
                    });
                } catch (error) {
                    
                    mountEl.innerHTML = `
                    <div class="xmind-error">
                        <span class="xmind-error-icon">âš ï¸</span>
                        <div class="xmind-error-content">
                            <strong>æ¸²æŸ“ XMind æ–‡ä»¶æ—¶å‡ºé”™</strong>
                            <p>${error.message}</p>
                        </div>
                    </div>
                `;
                    console.error('Error rendering XMind file:', error);
                }
            }
        }
    });
</script>

<style>
     
    .xmind-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 200px;
        background-color: #f9f9f9;
        border: 1px dashed #ddd;
        border-radius: 6px;
        margin: 1.5rem 0;
        padding: 20px;
    }

     
    .xmind-loader-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }

     
    .xmind-loader {
        border: 3px solid #f0f0f0;
        border-top: 3px solid #999;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
    }

     
    .xmind-loader-text {
        color: #888;
        font-size: 0.9rem;
        font-family: "LXGW WenKai", "Maple Mono NF CN", sans-serif;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

     
    .xmind-error {
        display: flex;
        align-items: flex-start;
        text-align: left;
        color: #c0392b;
        width: 100%;
    }

    .xmind-error-icon {
        font-size: 1.5rem;
        margin-right: 15px;
        line-height: 1.2;
    }

    .xmind-error-content {
        flex: 1;
    }

    .xmind-error strong {
        font-size: 1.1rem;
        color: #a93226;
    }

    .xmind-error p {
        margin: 5px 0 0;
        font-size: 0.9rem;
        color: #7b241c;
        word-break: break-all;
    }

    .xmind-error code {
        background-color: #fbeae5;
        padding: 2px 5px;
        border-radius: 4px;
        font-size: 0.85rem;
    }
</style>

  
<script>
    document.addEventListener('DOMContentLoaded', () => {
        
        const DIAGRAM_MAP = new Map([
            ['plantuml_kroki', 'plantuml'],
            ['mermaid_kroki', 'mermaid'],
            ['graphviz', 'graphviz'],
            ['blockdiag', 'blockdiag'],
            ['seqdiag', 'seqdiag'],
            ['actdiag', 'actdiag'],
            ['packetdiag', 'packetdiag'],
            ['database', 'dbml'],
            ['dbml', 'dbml'],
            ['vega', 'vega']
        ]);

        
        const blocks = [];
        document.querySelectorAll('pre code[class]').forEach(block => {
            if (block.dataset.kroki) return;
            const lang = [...block.classList].find(c => DIAGRAM_MAP.has(c.split('-')[1]));
            if (lang) {
                block.dataset.kroki = 'processed';
                blocks.push({ block, api: DIAGRAM_MAP.get(lang.split('-')[1]) });
            }
        });

        if (!blocks.length) return;

        
        const CONCURRENCY = 6;
        const queue = blocks.slice();

        (async function processQueue() {
            const workers = Array(Math.min(CONCURRENCY, queue.length))
                .fill()
                .map(async () => {
                    while (queue.length) {
                        const { block, api } = queue.pop();
                        await renderBlock(block, api);
                    }
                });
            await Promise.all(workers);
        })();

        async function renderBlock(block, api) {
            const pre = block.closest('pre');
            try {
                const code = block.textContent.trim();
                if (!code) {
                    pre.style.border = '2px solid orange';
                    return;
                }

                const res = await fetch(`https://kroki.io/${api}/svg`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: code
                });

                if (!res.ok) throw new Error(`${await res.text()} (HTTP ${res.status})`);

                
                const svg = window.diagramRenderUtils.createDiagramContainer();
                svg.innerHTML = window.diagramRenderUtils.makeSVGTransparent(await res.text());

                
                const fullscreenButton = window.diagramRenderUtils.createFullscreenButton();
                window.diagramRenderUtils.setupFullscreenButton(fullscreenButton, svg, false);
                svg.appendChild(fullscreenButton);

                
                const copyButton = window.diagramRenderUtils.createCopyButton();
                window.diagramRenderUtils.setupCopyButton(copyButton, code);
                svg.appendChild(copyButton);

                
                window.diagramRenderUtils.setupShowSourceCode(svg, code);

                pre.insertAdjacentElement('afterend', svg);

                
                pre.remove();
            } catch (err) {
                console.error(`[Kroki] æ¸²æŸ“å¤±è´¥: ${err.message}`);
                pre.style.border = '2px solid red';
                pre.title = err.message;
            }
        }
    });
</script>


  <div id="search-modal">
  <input type="text" id="modal-search-input" placeholder="è¾“å…¥å…³é”®è¯æœç´¢..." aria-label="æœç´¢æ¡†" autocomplete="off">
  <div id="modal-search-debug" style="margin-bottom: 10px; color: #999;"></div>
  <div id="modal-search-results"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<script>
  function debug(text) {
      document.getElementById('modal-search-debug').textContent = text;
  }
  function showpages() {
    debug("å½“å‰æœ¬ç«™å…±æœ‰ " + searchIndex.length + " ç¯‡æ–‡ç« ");
  }

  let searchIndex = [];
  
  
    
  

  
    searchIndex.push({
      title: "\"é¢å‘æ¨¡å¼çš„è½¯ä»¶æ¶æ„ å·1 æ¨¡å¼ç³»ç»Ÿ è¯»ä¹¦ç¬”è®°\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/%E9%9D%A2%E5%90%91%E6%A8%A1%E5%BC%8F%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E5%8D%B71%E6%A8%A1%E5%BC%8F%E7%B3%BB%E7%BB%9F%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/\"",
      
      categories: "[\"è¯»ä¹¦ç¬”è®°\",\"è½¯ä»¶å·¥ç¨‹\"]",
      tags: "[\"è®¾è®¡æ¨¡å¼\"]",
      series: "[\"è½¯ä»¶æ¶æ„ä¹‹é“\"]",
      date: "\"2025-12-04\""
    });
  
    searchIndex.push({
      title: "\"é“¾æ¥ç¬¦å·ä¸ç¬¦å·å¯¼å…¥å¯¼å‡ºå®â€”â€”è®°ä¸€æ¬¡å› clangdè¡¥å…¨å¤´æ–‡ä»¶äº§ç”Ÿçš„é“¾æ¥é”™è¯¯\"",
      permalink: "\"/cpp/%E9%93%BE%E6%8E%A5%E7%AC%A6%E5%8F%B7%E5%AF%BC%E5%87%BA%E4%B8%8E%E7%AC%A6%E5%8F%B7%E5%8F%AF%E8%A7%81%E5%AE%8F/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"C++\"]",
      series: "[\"C++è¸©å‘\"]",
      date: "\"2025-11-17\""
    });
  
    searchIndex.push({
      title: "\"Qtä»é›¶å¼€å§‹ï¼ˆ0ï¼‰â€”â€”ç¯å¢ƒé…ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/qt%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: "[\"Qtä¸“æ \"]",
      date: "\"2025-08-30\""
    });
  
    searchIndex.push({
      title: "\"ubuntué…ç½®coredumpæ–‡ä»¶ç”Ÿæˆä½ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ubuntu%E7%94%9F%E6%88%90coredump%E6%96%87%E4%BB%B6/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2025-08-01\""
    });
  
    searchIndex.push({
      title: "\"ubuntuå®‰è£…ä¸­æ–‡è¾“å…¥æ³•ï¼ˆfcitx5-rimeï¼‰\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ubuntu%E5%AE%89%E8%A3%85rime%E8%BE%93%E5%85%A5%E6%B3%95/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2025-07-10\""
    });
  
    searchIndex.push({
      title: "\"SSHåå‘éš§é“ä¸­è½¬æœº-è¿œç¨‹è¿æ¥æœ¬åœ°æœåŠ¡å™¨\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/ssh%E5%8F%8D%E5%90%91%E9%9A%A7%E9%81%93%E4%B8%AD%E8%BD%AC%E6%9C%BA%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E5%99%A8/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"ssh\"]",
      series: [],
      date: "\"2025-06-16\""
    });
  
    searchIndex.push({
      title: "\"C++ é«˜å¹¶å‘æœåŠ¡å™¨æ¨¡å‹å®ç° | [è½¬è½½](https://github.com/linkxzhou/mylib/blob/master/c%2B%2B/concurrency_server/README.md)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/06/10/22%E7%A7%8Dc-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"ç½‘ç»œç¼–ç¨‹\",\"C++\"]",
      series: [],
      date: "\"2025-06-10\""
    });
  
    searchIndex.push({
      title: "\"libclang-pyä½¿ç”¨ä»‹ç»\"",
      permalink: "\"/cpp/libclang-py%E4%BD%BF%E7%94%A8/\"",
      
      categories: [],
      tags: "[\"C++\",\"ç¼–è¯‘åŸç†\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-06-10\""
    });
  
    searchIndex.push({
      title: "\"å‚æ•°åŒ…ä¸æŠ˜å è¡¨è¾¾å¼å‚»å‚»åˆ†ä¸æ¸…\"",
      permalink: "\"/cpp/%E5%8F%82%E6%95%B0%E5%8C%85%E4%B8%8E%E6%8A%98%E5%8F%A0%E8%A1%A8%E8%BE%BE%E5%BC%8F/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"C++\"]",
      series: "[\"modern c++\"]",
      date: "\"2025-06-05\""
    });
  
    searchIndex.push({
      title: "\"åç¨‹å¿«é€Ÿå…¥é—¨\"",
      permalink: "\"/cpp/%E5%8D%8F%E7%A8%8B%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"coroutine\",\"C++\"]",
      series: "[\"modern c++\"]",
      date: "\"2025-05-21\""
    });
  
    searchIndex.push({
      title: "\"åˆç­‰æ•°å­¦å›å¿†å½•\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/%E5%88%9D%E7%AD%89%E6%95%B0%E5%AD%A6%E5%9B%9E%E5%BF%86%E5%BD%95/\"",
      
      categories: "[\"æ•°å­¦\"]",
      tags: "[\"æ•°å­¦\",\"ä¸‰è§’å‡½æ•°\",\"æåæ ‡\",\"å®šç§¯åˆ†\"]",
      series: [],
      date: "\"2025-05-16\""
    });
  
    searchIndex.push({
      title: "\"Epollè¯¦ç»†ä»‹ç» | [è½¬è½½](https://mp.weixin.qq.com/s/pahk8ay5MvkvONeg1-M82w)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/05/04/epoll%E8%AF%A6%E8%A7%A3/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"ç½‘ç»œç¼–ç¨‹\",\"epoll\"]",
      series: [],
      date: "\"2025-05-04\""
    });
  
    searchIndex.push({
      title: "\"å…±äº«å†…å­˜è¯¦è§£ | [è½¬è½½](https://mp.weixin.qq.com/s/wOySn0oi0xXREpFRBXCMmQ)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/05/04/%E5%85%B1%E4%BA%AB%E5%86%85%E5%AD%98%E8%AF%A6%E8%A7%A3/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"ç½‘ç»œç¼–ç¨‹\"]",
      series: [],
      date: "\"2025-05-04\""
    });
  
    searchIndex.push({
      title: "\"Asio åŸºæœ¬ä½¿ç”¨ä¸æ ¸å¿ƒè®¾è®¡æ€æƒ³ | [è½¬è½½](https://blog.csdn.net/gma999/article/details/143983035)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/17/asio-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%A0%B8%E5%BF%83%E8%AE%BE%E8%AE%A1%E6%80%9D%E6%83%B3/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"asio\"]",
      series: "[\"ç½‘ç»œç¼–ç¨‹\"]",
      date: "\"2025-04-17\""
    });
  
    searchIndex.push({
      title: "\"GoogleTestä¸gMockè¿›é˜¶æŒ‡å— | [è½¬è½½](https://www.cnblogs.com/jinyunshaobing/p/16804309.html)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/16/googletest%E4%B8%8Egmock%E8%BF%9B%E9%98%B6%E6%8C%87%E5%8D%97/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"GoogleTest\"]",
      series: [],
      date: "\"2025-04-16\""
    });
  
    searchIndex.push({
      title: "\"GTest / GMock å•å…ƒæµ‹è¯•å®è·µæ‰‹å†Œ | [è½¬è½½](https://imageslr.com/2023/gtest.html)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/16/gtest_gmock-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E5%AE%9E%E8%B7%B5%E6%89%8B%E5%86%8C/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"GoogleTest\"]",
      series: [],
      date: "\"2025-04-16\""
    });
  
    searchIndex.push({
      title: "\"Docker ç½‘ç»œæ¨¡å¼è¯¦è§£åŠå®¹å™¨é—´ç½‘ç»œé€šä¿¡ | [è½¬è½½](https://www.cnblogs.com/mrhelloworld/p/docker11.html)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/15/docker-%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F%E8%AF%A6%E8%A7%A3%E5%8F%8A%E5%AE%B9%E5%99%A8%E9%97%B4%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"Docker\"]",
      series: [],
      date: "\"2025-04-15\""
    });
  
    searchIndex.push({
      title: "\"ä¸‡å­—é•¿æ–‡ç®€è¿°Apolloä¸­CyberRTæ¡†æ¶åŸºç¡€æ¦‚å¿µ | [è½¬è½½](https://zhuanlan.zhihu.com/p/479518561#CTZ_DEFAULT)\"",
      permalink: "\"/%E8%BD%AC%E8%BD%BD/2025/04/15/%E4%B8%87%E5%AD%97%E9%95%BF%E6%96%87%E7%AE%80%E8%BF%B0apollo%E4%B8%ADcyberrt%E6%A1%86%E6%9E%B6%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/\"",
      
      categories: "[\"åšå®¢å‰ªè—\"]",
      tags: "[\"CyberRT\"]",
      series: [],
      date: "\"2025-04-15\""
    });
  
    searchIndex.push({
      title: "\"C++å°æŠ€å·§\"",
      permalink: "\"/cpp/c++%E5%B0%8F%E6%8A%80%E5%B7%A7/\"",
      
      categories: "[\"C++ç¬”è®°\"]",
      tags: "[\"C++\"]",
      series: "[\"modern c++\"]",
      date: "\"2025-04-14\""
    });
  
    searchIndex.push({
      title: "\"tmux å¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/tmux%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"tmux\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-04-08\""
    });
  
    searchIndex.push({
      title: "\"Valgrindå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/valgrind%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"valgrind\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-04-08\""
    });
  
    searchIndex.push({
      title: "\"Mermaidå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/mermaid%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"mermaid\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2025-04-07\""
    });
  
    searchIndex.push({
      title: "\"CyberRTæ¡†æ¶æ€»è§ˆ\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/cyberrt%E6%A1%86%E6%9E%B6%E6%80%BB%E8%A7%88/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: "[\"CyberRT\"]",
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-04-02\""
    });
  
    searchIndex.push({
      title: "\"é€šä¿¡ä¸­é—´ä»¶æœ¯è¯­è¡¨\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/%E6%9C%AF%E8%AF%AD%E8%A1%A8/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: [],
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-03-27\""
    });
  
    searchIndex.push({
      title: "\"ç°ä»£C++å¼€å‘ç¯å¢ƒé…ç½®æŒ‡å—\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/c++%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"c++\"]",
      series: [],
      date: "\"2025-03-26\""
    });
  
    searchIndex.push({
      title: "\"å¸¦ç€ç›®çš„å­¦ï¼šCyberRT\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/%E5%B8%A6%E7%9D%80%E9%97%AE%E9%A2%98%E5%AD%A6cyberrt/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: "[\"CyberRT\"]",
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-03-25\""
    });
  
    searchIndex.push({
      title: "\"Linuxç¯å¢ƒå˜é‡åŠ è½½é¡ºåºåˆ†æ\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/linux%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F%E5%88%86%E6%9E%90/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"linux\"]",
      series: [],
      date: "\"2025-03-14\""
    });
  
    searchIndex.push({
      title: "\"æ‰‹å†Œé€ŸæŸ¥æ–¹æ¡ˆï¼ˆå¦‚cppreferenceï¼‰\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/zeal-dataset%E4%B8%AD%E6%96%87cppreference%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"cppreference\"]",
      series: [],
      date: "\"2025-03-12\""
    });
  
    searchIndex.push({
      title: "\"CyberRTä¸­çš„ä»£ç å’Œå·¥ç¨‹æŠ€å·§\"",
      permalink: "\"/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/cyberrt/cyberrt%E4%B8%AD%E7%9A%84%E5%B7%A5%E7%A8%8B%E5%92%8C%E4%BB%A3%E7%A0%81%E6%8A%80%E5%B7%A7/\"",
      
      categories: "[\"è‡ªåŠ¨é©¾é©¶\"]",
      tags: "[\"CyberRT\",\"C++\"]",
      series: "[\"CyberRTä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-03-01\""
    });
  
    searchIndex.push({
      title: "\"è®¾è®¡æ¨¡å¼\"",
      permalink: "\"/%E8%BD%AF%E4%BB%B6%E5%B7%A5%E7%A8%8B/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/\"",
      
      categories: "[\"è½¯ä»¶å·¥ç¨‹\"]",
      tags: "[\"SE\"]",
      series: "[\"è®¾è®¡æ¨¡å¼ä¸“é¡¹æ€»ç»“\"]",
      date: "\"2025-02-28\""
    });
  
    searchIndex.push({
      title: "\"ä¸€ç«™å¼ç¯å¢ƒé…ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/%E4%B8%80%E7%AB%99%E5%BC%8F%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2025-02-24\""
    });
  
    searchIndex.push({
      title: "\"leetcodeè°ƒè¯•æŒ‡å—\"",
      permalink: "\"/%E7%AE%97%E6%B3%95/leetcode%E8%B0%83%E8%AF%95%E6%8C%87%E5%8D%97/\"",
      
      categories: [],
      tags: "[\"leetcode\"]",
      series: [],
      date: "\"2024-03-14\""
    });
  
    searchIndex.push({
      title: "\"linuxå‘½ä»¤è¡Œå¤§è®°å¿†æ¢å¤æœ¯\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/linux%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7%E7%94%A8%E6%B3%95/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"linux\",\"cmdline\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2023-11-25\""
    });
  
    searchIndex.push({
      title: "\"ç•ªèŒ„é¸¡è›‹é¢\"",
      permalink: "\"/%E8%A1%A3%E9%A3%9F%E4%BD%8F%E8%A1%8C/%E8%8F%9C%E8%B0%B1/%E7%95%AA%E8%8C%84%E9%B8%A1%E8%9B%8B%E9%9D%A2/\"",
      
      categories: "[\"è¡£é£Ÿä½è¡Œ\"]",
      tags: [],
      series: "[\"å¿«é€Ÿåšé¥­\"]",
      date: "\"2023-10-22\""
    });
  
    searchIndex.push({
      title: "\"PlantUMLå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/plantuml%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"uml\",\"plantuml\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2023-10-11\""
    });
  
    searchIndex.push({
      title: "\"WSLå®‰è£…ä¸é…ç½®\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/wsl%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2023-09-12\""
    });
  
    searchIndex.push({
      title: "\"C++ç½‘ç»œç¼–ç¨‹å…¥é—¨æ¦‚å¿µåŠapiæ€»ç»“\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/linux%E7%B3%BB%E7%BB%9F%E7%BC%96%E7%A8%8B/\"",
      
      categories: [],
      tags: "[\"linux\",\"ç½‘ç»œç¼–ç¨‹\"]",
      series: "[\"é¢ç­‹\",\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2023-04-02\""
    });
  
    searchIndex.push({
      title: "\"è‹å·æ—…è¡Œè®¡åˆ’\"",
      permalink: "\"/%E8%A1%A3%E9%A3%9F%E4%BD%8F%E8%A1%8C/%E6%97%85%E8%A1%8C%E6%94%BB%E7%95%A5/%E8%8B%8F%E5%B7%9E/\"",
      
      categories: "[\"è¡£é£Ÿä½è¡Œ\"]",
      tags: "[\"æ—…è¡Œ\"]",
      series: [],
      date: "\"2023-04-01\""
    });
  
    searchIndex.push({
      title: "\"gdbå¿«é€Ÿä¸Šæ‰‹\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/gdb%E6%95%99%E7%A8%8B/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"gdb\",\"cmdline\"]",
      series: "[\"å¿«é€Ÿä¸Šæ‰‹\"]",
      date: "\"2022-11-25\""
    });
  
    searchIndex.push({
      title: "\"Ubuntu22.04å®‰è£…Hadoopå®Œå…¨åˆ†å¸ƒå¼é›†ç¾¤\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/ubuntu%E9%85%8D%E7%BD%AEhadoop%E5%AE%8C%E5%85%A8%E5%88%86%E5%B8%83%E5%BC%8F/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: "[\"hadoop\"]",
      series: [],
      date: "\"2022-11-21\""
    });
  
    searchIndex.push({
      title: "\"C++è¿æ¥mysql\"",
      permalink: "\"/%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/c++%E8%BF%9E%E6%8E%A5mysql/\"",
      
      categories: "[\"ç¯å¢ƒé…ç½®\"]",
      tags: [],
      series: [],
      date: "\"2022-11-20\""
    });
  
    searchIndex.push({
      title: "\"å¾æœCæŒ‡é’ˆç¬”è®°\"",
      permalink: "\"/%E7%AC%94%E8%AE%B0/%E5%BE%81%E6%9C%8Dc%E6%8C%87%E9%92%88/\"",
      
      categories: [],
      tags: [],
      series: [],
      date: "\"2022-10-04\""
    });
  
    searchIndex.push({
      title: "\"Leetcodeåˆ·é¢˜æŒ‡å—\"",
      permalink: "\"/%E7%AE%97%E6%B3%95/leetcode%E5%88%B7%E9%A2%98%E6%8C%87%E5%8D%97/\"",
      
      categories: "[\"ç®—æ³•\"]",
      tags: "[\"leetcode\"]",
      series: "[\"leetcodeåˆ·é¢˜æŒ‡å—\"]",
      date: "\"2022-09-11\""
    });
  
    searchIndex.push({
      title: "\"word é¡µçœ‰é¡µè„šè®¾ç½®\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/word%E9%A1%B5%E7%9C%89%E9%A1%B5%E8%84%9A%E9%85%8D%E7%BD%AE/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: [],
      series: [],
      date: "\"2021-04-03\""
    });
  
    searchIndex.push({
      title: "\"Markdown Demo\"",
      permalink: "\"/%E6%B5%8B%E8%AF%95/markdown-demo/\"",
      
      categories: [],
      tags: "[\"markdown\"]",
      series: [],
      date: "\"2021-02-15\""
    });
  
    searchIndex.push({
      title: "\"å¸¸ç”¨æ•°å­¦ç¬¦å·çš„latexè¡¨ç¤º\"",
      permalink: "\"/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/%E5%B8%B8%E7%94%A8%E6%95%B0%E5%AD%A6%E7%AC%A6%E5%8F%B7%E7%9A%84latex%E8%A1%A8%E7%A4%BA/\"",
      
      categories: "[\"å·¥å…·ä½¿ç”¨\"]",
      tags: "[\"latex\",\"markdown\"]",
      series: [],
      date: "\"2021-02-15\""
    });
  

  showpages()

  const options = {
    includeScore: true,
    threshold: 0.6,
    keys: [
      { name: 'title', weight: 0.7 },
      { name: 'content', weight: 0.3 },
      { name: 'tags', weight: 0.5 },
      { name: 'categories', weight: 0.5 },
      { name: 'series', weight: 0.5 }
    ]
  };

  const fuse = new Fuse(searchIndex, options);

  document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && event.key === 'k') {
      event.preventDefault();
      toggleSearchModal();
    } else if (event.key === 'Escape') {
      document.getElementById('modal-search-input').value = "";
      closeSearchModal();
      var res = document.getElementById('modal-search-results');
      while (res.firstChild) {
        res.removeChild(res.firstChild);
      }
      showpages();
    }
  });

  function toggleSearchModal() {
    const modal = document.getElementById('search-modal');
    if (modal.style.display === 'none') {
      modal.style.display = 'block';
      document.getElementById('modal-search-input').focus();
    } else {
      modal.style.display = 'none';
    }
  }

  function closeSearchModal() {
    const modal = document.getElementById('search-modal');
    modal.style.display = 'none';
  }

  document.getElementById('modal-search-input').addEventListener('input', function(e) {
    const searchTerm = e.target.value.trim();
    const resultsContainer = document.getElementById('modal-search-results');
    resultsContainer.innerHTML = '';

    if (searchTerm === '') {
      showpages()
      return;
    }

    const results = fuse.search(searchTerm);

    results.sort((a, b) => new Date(b.item.date) - new Date(a.item.date));

    if (results.length === 0) {
      showpages()
      resultsContainer.innerHTML = '<p>æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡ç« </p>';
      return;
    } else {
      debug("å…±æ‰¾åˆ° " + results.length + " ç¯‡åŒ¹é…çš„æ–‡ç« ")
    }

    results.forEach(result => {
      const item = result.item;
      const resultItem = document.createElement('div');
      resultItem.className = 'modal-search-result-item';

      const date = document.createElement('span');
      date.textContent = item.date.replace(/^"|"$/g, '') + '   ';
      date.className = 'modal-search-result-date';

      const link = document.createElement('a');
      link.href = item.permalink.replace(/^"|"$/g, '');
      link.textContent = item.title.replace(/^"|"$/g, '');
      link.className = 'modal-search-result-title';

      resultItem.appendChild(date);
      resultItem.appendChild(link);
      resultsContainer.appendChild(resultItem);
    });
  });
</script>

<style>
 
#search-modal {
    display: none;
    position: fixed;
    top: 6%;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 20px;
    box-shadow: 0 0 6px rgba(45, 45, 45, 0.5);
    border-radius: 6px;
    z-index: 1000;
    width: 80%;
    max-width: 600px;
    text-align: left;
}

#modal-search-input {
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
    font-size: 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 1rem;
}

#modal-search-results {
    margin-top: 10px;
    max-height: 60vh;
    overflow-y: auto;
}

.modal-search-result-item {
    padding: 0.7rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #eee;
    display: flex;
    align-items: center;
}

.modal-search-result-date {
    color: #666;
    font-size: 1.1rem;
    margin-right: 0.5rem;
    text-wrap: nowrap;
}

.modal-search-result-title {
    font-weight: bold;
    color: #1a73e8;
    text-decoration: none;
}

.modal-search-result-title:hover {
    text-decoration: underline;
}
</style>


  

  
  <hr />
  Â© 
<a href="https://kaikaixixi.xyz"  target="_blank" rel="noopener noreferrer" >SHUAIKAI</a>
 2021 &ndash; 2025 | ğŸ¨
<a href="https://github.com/captainwc/ksimple"  target="_blank" rel="noopener noreferrer" >KSimple</a>
  

</footer>
</body>

</html>
